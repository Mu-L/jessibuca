!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["jessibuca-audio-demo"]=t()}(this,(function(){"use strict";class t{on(e,t,s){const i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:s}),this}once(e,t,s){const i=this;function r(){i.off(e,r);for(var o=arguments.length,A=new Array(o),a=0;a<o;a++)A[a]=arguments[a];t.apply(s,A)}return r._=t,this.on(e,r,s)}emit(e){const t=((this.e||(this.e={}))[e]||[]).slice();for(var s=arguments.length,i=new Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];for(let e=0;e<t.length;e+=1)t[e].fn.apply(t[e].ctx,i);return this}off(e,t){const s=this.e||(this.e={});if(!e)return Object.keys(s).forEach((e=>{delete s[e]})),void delete this.e;const i=s[e],r=[];if(i&&t)for(let e=0,s=i.length;e<s;e+=1)i[e].fn!==t&&i[e].fn._!==t&&r.push(i[e]);return r.length?s[e]=r:delete s[e],this}}const s=1,i=2,r=3,o=4,A=5,a=6,n=["","websocket","fetch","hls","webrtc","webTransport","aliyunRtc","ts"],h="fetch",l="hls",u="websocket",d="webrtc",c="webTransport",p="worker",g="aliyunRtc",m="mp4",y="player",f="playerAudio",b="playbackTF",w="playVod",k="flv",E="m7s",C="webrtc",S="debug",B="warn",_=1e4,T="init",v="playAudio",I="initAudio",R="audioCode",P="workerFetch",L="workerEnd",W="closeEnd",M="init",N="close",D="updateConfig",G="fetchStream",O="sendWsMessage",x="fetch",Q="destroy",H="destroyEnd",j="buffer",F="fetchError",V="fetchClose",U="fetchSuccess",$="fetch",Y="sendMessage",z="destroy",q="destroyEnd",J="buffer",Z="websocketError",X="websocketClose",K="websocketOpen",ee={fullscreen:"fullscreen$2",webFullscreen:"webFullscreen",decoderWorkerInit:"decoderWorkerInit",play:"play",playing:"playing",pause:"pause",playVodEnded:"playVodEnded",mute:"mute",load:"load",loading:"loading",zooming:"zooming",drawingRect:"drawingRect",drawingRectInfo:"drawingRectInfo",videoInfo:"videoInfo",timeUpdate:"timeUpdate",audioInfo:"audioInfo",log:"log",error:"error",kBps:"kBps",timeout:"timeout",delayTimeout:"delayTimeout",delayTimeoutRetryEnd:"delayTimeoutRetryEnd",loadingTimeout:"loadingTimeout",loadingTimeoutRetryEnd:"loadingTimeoutRetryEnd",stats:"stats",performance:"performance",videoSmooth:"videoSmooth",faceDetectActive:"faceDetectActive",objectDetectActive:"objectDetectActive",occlusionDetectActive:"occlusionDetectActive",imageDetectActive:"imageDetectActive",record:"record",recording:"recording",recordingTimestamp:"recordingTimestamp",recordStart:"recordStart",recordEnd:"recordEnd",recordCreateError:"recordCreateError",recordBlob:"recordBlob",recordCancel:"recordCancel",buffer:"buffer",videoFrame:"videoFrame",videoSEI:"videoSEI",videoSEISyncPts:"videoSEISyncPts",start:"start",metadata:"metadata",resize:"resize",volumechange:"volumechange",volume:"volume",destroy:"destroy",beforeDestroy:"beforeDestroy",streamEnd:"streamEnd",streamRate:"streamRate",streamAbps:"streamAbps",streamVbps:"streamVbps",streamDts:"streamDts",streamSuccess:"streamSuccess",streamMessage:"streamMessage",streamError:"streamError",streamStats:"streamStats",streamEndInner:"streamEndInner",mseSourceOpen:"mseSourceOpen",mseSourceClose:"mseSourceClose",mseSourceended:"mseSourceended",mseSourceStartStreaming:"mseSourceStartStreaming",mseSourceEndStreaming:"mseSourceEndStreaming",mseSourceBufferError:"mseSourceBufferError",mseAddSourceBufferError:"mseAddSourceBufferError",mseWorkerAddSourceBufferError:"mseWorkerAddSourceBufferError",mseSourceBufferBusy:"mseSourceBufferBusy",mseSourceBufferFull:"mseSourceBufferFull",videoWaiting:"videoWaiting",videoTimeUpdate:"videoTimeUpdate",videoSyncAudio:"videoSyncAudio",playToRenderTimes:"playToRenderTimes",playbackTime:"playbackTime",playbackTimestamp:"playbackTimestamp",playbackTimeScroll:"playbackTimeScroll",playbackPrecision:"playbackPrecision",playbackShowPrecisionChange:"playbackShowPrecisionChange",playbackJustTime:"playbackJustTime",playbackStats:"playbackStats",playbackSeek:"playbackSeek",playbackPause:"playbackPause",playbackPauseOrResume:"playbackPauseOrResume",playbackRateChange:"playbackRateChange",playbackPreRateChange:"playbackPreRateChange",playbackEnd:"playbackEnd",playVodStats:"playVodStats",playVodPause:"playVodPause",playVodPauseOrResume:"playVodPauseOrResume",playVodRateChange:"playVodRateChange",playVodTime:"playVodTime",playVodTimeCache:"playVodTimeCache",playVodTimestamp:"playVodTimestamp",playVodSeek:"playVodSeek",playVodSeekEnd:"playVodSeekEnd",playVodVideoSeekingByMse:"playVodVideoSeekingByMse",playVodVideoSeekedByMse:"playVodVideoSeekedByMse",playVodCanplay:"playVodCanplay",playVodWaiting:"playVodWaiting",playVodEndedAndReplay:"playVodEndedAndReplay",ptz:"ptz",streamQualityChange:"streamQualityChange",visibilityChange:"visibilityChange",netBuf:"netBuf",close:"close",networkDelayTimeout:"networkDelayTimeout",togglePerformancePanel:"togglePerformancePanel",viewResizeChange:"viewResizeChange",flvDemuxBufferSizeTooLarge:"flvDemuxBufferSizeTooLarge",talkGetUserMediaSuccess:"talkGetUserMediaSuccess",talkGetUserMediaFail:"talkGetUserMediaFail",talkGetUserMediaTimeout:"talkGetUserMediaTimeout",talkStreamStart:"talkStreamStart",talkStreamOpen:"talkStreamOpen",talkStreamClose:"talkStreamClose",talkStreamError:"talkStreamError",talkStreamInactive:"talkStreamInactive",talkStreamMsg:"talkStreamMsg",webrtcDisconnect:"webrtcDisconnect",webrtcFailed:"webrtcFailed",webrtcClosed:"webrtcClosed",webrtcChecking:"webrtcChecking",webrtcConnected:"webrtcConnected",webrtcCompleted:"webrtcCompleted",webrtcOnConnectionStateChange:"webrtcOnConnectionStateChange",webrtcOnIceConnectionStateChange:"webrtcOnIceConnectionStateChange",crashLog:"crashLog",focus:"focus",blur:"blur",inView:"inView",visibilityHiddenTimeout:"visibilityHiddenTimeout",websocketOpen:"websocketOpen",websocketClose:"websocketClose",websocketError:"websocketError",websocketMessage:"websocketMessage",aiObjectDetectorInfo:"aiObjectDetectorInfo",aiFaceDetectorInfo:"aiFaceDetectorInfo",aiOcclusionDetectResult:"aiOcclusionDetectResult",aiImageDetectResult:"aiImageDetectResult",playFailedAndPaused:"playFailedAndPaused",audioResumeState:"audioResumeState",webrtcStreamH265:"webrtcStreamH265",flvMetaData:"flvMetaData",talkFailedAndStop:"talkFailedAndStop",removeLoadingBgImage:"removeLoadingBgImage",memoryLog:"memoryLog",downloadMemoryLog:"downloadMemoryLog",pressureObserverCpu:"pressureObserverCpu",currentPts:"currentPts",online:"online",offline:"offline",networkState:"networkState",clickInitPlayer:"clickInitPlayer"},te={load:ee.load,timeUpdate:ee.timeUpdate,audioInfo:ee.audioInfo,error:ee.error,kBps:ee.kBps,start:ee.start,timeout:ee.timeout,loadingTimeout:ee.loadingTimeout,loadingTimeoutRetryEnd:ee.loadingTimeoutRetryEnd,delayTimeout:ee.delayTimeout,delayTimeoutRetryEnd:ee.delayTimeoutRetryEnd,play:ee.play,pause:ee.pause,mute:ee.mute,stats:ee.stats,playToRenderTimes:ee.playToRenderTimes,crashLog:ee.crashLog,websocketOpen:ee.websocketOpen,websocketClose:ee.websocketClose,playFailedAndPaused:ee.playFailedAndPaused,audioResumeState:ee.audioResumeState},se={playError:"playIsNotPauseOrUrlIsNull",fetchError:"fetchError",websocketError:"websocketError",webcodecsH265NotSupport:"webcodecsH265NotSupport",webcodecsDecodeError:"webcodecsDecodeError",webcodecsUnsupportedConfigurationError:"webcodecsUnsupportedConfigurationError",webcodecsDecodeConfigureError:"webcodecsDecodeConfigureError",webcodecsAudioInitTimeout:"webcodecsAudioInitTimeout",webcodecsAudioNoDataTimeout:"webcodecsAudioNoDataTimeout",mediaSourceH265NotSupport:"mediaSourceH265NotSupport",mediaSourceAudioG711NotSupport:"mediaSourceAudioG711NotSupport",mediaSourceAudioInitTimeout:"mediaSourceAudioInitTimeout",mediaSourceAudioNoDataTimeout:"mediaSourceAudioNoDataTimeout",mediaSourceDecoderConfigurationError:"mediaSourceDecoderConfigurationError",mediaSourceFull:ee.mseSourceBufferFull,mseSourceBufferError:ee.mseSourceBufferError,mseAddSourceBufferError:ee.mseAddSourceBufferError,mseWorkerAddSourceBufferError:ee.mseWorkerAddSourceBufferError,mediaSourceAppendBufferError:"mediaSourceAppendBufferError",mediaSourceTsIsMaxDiff:"mediaSourceTsIsMaxDiff",mediaSourceUseCanvasRenderPlayFailed:"mediaSourceUseCanvasRenderPlayFailed",mediaSourceBufferedIsZeroError:"mediaSourceBufferedIsZeroError",wasmDecodeError:"wasmDecodeError",wasmUseVideoRenderError:"wasmUseVideoRenderError",simdH264DecodeVideoWidthIsTooLarge:"simdH264DecodeVideoWidthIsTooLarge",simdDecodeError:"simdDecodeError",hlsError:"hlsError",webrtcError:"webrtcError",webrtcClosed:ee.webrtcClosed,webrtcIceCandidateError:"webrtcIceCandidateError",webglAlignmentError:"webglAlignmentError",wasmWidthOrHeightChange:"wasmWidthOrHeightChange",mseWidthOrHeightChange:"mseWidthOrHeightChange",wcsWidthOrHeightChange:"wcsWidthOrHeightChange",widthOrHeightChange:"widthOrHeightChange",tallWebsocketClosedByError:"tallWebsocketClosedByError",flvDemuxBufferSizeTooLarge:ee.flvDemuxBufferSizeTooLarge,audioChannelError:"audioChannelError",webglContextLostError:"webglContextLostError",videoElementPlayingFailed:"videoElementPlayingFailed",videoElementPlayingFailedForWebrtc:"videoElementPlayingFailedForWebrtc",decoderWorkerInitError:"decoderWorkerInitError",decoderWorkerWasmError:"decoderWorkerWasmError",videoInfoError:"videoInfoError",streamEnd:ee.streamEnd,websocket1006Error:"websocket1006Error",delayTimeout:ee.delayTimeout,loadingTimeout:ee.loadingTimeout,networkDelayTimeout:ee.networkDelayTimeout,fullscreenError:"fullscreenError",aliyunRtcError:"aliyunRtcError",mseWaitVideoCanplayTimeout:"mseWaitVideoCanplayTimeout",initDecoderWorkerTimeout:"initDecoderWorkerTimeout",notSupportNewWasm:"notSupportNewWasm",playVodMp4Error:"playVodMp4Error",mp4Error:"mp4Error",...{talkStreamError:ee.talkStreamError,talkStreamClose:ee.talkStreamClose}},ie="notConnect",re="open",oe="close",Ae="error",ae={10:"AAC",7:"ALAW",8:"MULAW",2:"MP3"},ne="The user aborted a request",he="AbortError",le="AbortError",ue="worklet",de="script",ce="active",pe={playType:f,timeout:10,loadingTimeout:10,heartTimeout:10,debug:!1,debugLevel:B,protocol:i,demuxType:k,isFlv:!1,isG711a:!1,isG711u:!1,isNotMute:!1,muted:!0,videoBuffer:1e3,videoBufferDelay:1e3,videoBufferMax:5e3,loadingTimeoutReplay:!0,heartTimeoutReplay:!0,loadingTimeoutReplayTimes:3,heartTimeoutReplayTimes:3,decoder:"decoder-pro-audio-player.js",isDecoderUseCDN:!1,weiXinInAndroidAudioBufferSize:4800,audioEngine:null,supportLockScreenPlayAudio:!0},ge="idle",me="buffering",ye="complete",fe="memory access out of bounds",be="inbound-rtp";class we{constructor(e){this.log=function(t){if(e._opt.debugLevel==S){const o=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"";for(var s=arguments.length,i=new Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];console.log(`JbPro${o}[✅✅✅][${t}]`,...i)}},this.warn=function(t){if(e._opt.debugLevel==S||e._opt.debugLevel==B){const o=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"";for(var s=arguments.length,i=new Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];console.log(`JbPro${o}[❗❗❗][${t}]`,...i)}},this.error=function(t){const s=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"";for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];console.error(`JbPro${s}[❌❌❌][${t}]`,...r)}}}function ke(){}function Ee(){return(new Date).getTime()}function Ce(e,t,s){return Math.max(Math.min(e,Math.max(t,s)),Math.min(t,s))}function Se(){return performance&&"function"==typeof performance.now?performance.now():Date.now()}function Be(e){let t=0,s=Se();return i=>{if(r=i,"[object Number]"!==Object.prototype.toString.call(r))return;var r;t+=i;const o=Se(),A=o-s;A>=1e3&&(e(t/A*1e3),s=o,t=0)}}(function(e,t){return e(t={exports:{}},t.exports),t.exports})((function(e){!function(){var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},s=e.exports,i=function(){for(var e,s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,r=s.length,o={};i<r;i++)if((e=s[i])&&e[1]in t){for(i=0;i<e.length;i++)o[s[0][i]]=e[i];return o}return!1}(),r={change:i.fullscreenchange,error:i.fullscreenerror},o={request:function(e,s){return new Promise(function(r,o){var A=function(){this.off("change",A),r()}.bind(this);this.on("change",A);var a=(e=e||t.documentElement)[i.requestFullscreen](s);a instanceof Promise&&a.then(A).catch(o)}.bind(this))},exit:function(){return new Promise(function(e,s){if(this.isFullscreen){var r=function(){this.off("change",r),e()}.bind(this);this.on("change",r);var o=t[i.exitFullscreen]();o instanceof Promise&&o.then(r).catch(s)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,s){var i=r[e];i&&t.addEventListener(i,s,!1)},off:function(e,s){var i=r[e];i&&t.removeEventListener(i,s,!1)},raw:i};i?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(t[i.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[i.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[i.fullscreenEnabled])}}}),s?e.exports=o:window.screenfull=o):s?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()})).isEnabled,(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}})();const _e='"9-13-2024"';function Te(){const e=window.navigator.userAgent.toLowerCase();return e&&/iphone|ipad|ipod|ios/.test(e)}function ve(e){return null==e}function Ie(e){return!ve(e)}const Re=()=>{const e=window.navigator.userAgent;return/MicroMessenger/i.test(e)},Pe=()=>{const e=window.navigator.userAgent;return/Chrome/i.test(e)},Le=()=>Re()&&function(){const e=window.navigator.userAgent.toLowerCase();return/android/i.test(e)}();function We(e){let t=xe(e.hasAudio)&&(e.useMSE||e.useWCS&&!e.useOffscreen)&&xe(e.demuxUseWorker);return!!(xe(t)&&e.useMSE&&e.mseDecodeAudio&&xe(e.demuxUseWorker))||(!!(xe(t)&&e.useWCS&&e.wcsDecodeAudio)||t)}function Me(e){e.close()}function Ne(){return"https:"===window.location.protocol||"localhost"===window.location.hostname}function De(e){const t=Object.prototype.toString;return function(e){switch(t.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:try{return e instanceof Error}catch(e){return!1}}}(e)?e.message:null==e?"":"object"==typeof e?JSON.stringify(e,null,2):String(e)}function Ge(){return function(e){let t="";if("object"==typeof e)try{t=JSON.stringify(e),t=JSON.parse(t)}catch(s){t=e}else t=e;return t}(pe)}function Oe(e){return!0===e||"true"===e}function xe(e){return!0!==e&&"true"!==e}function Qe(e){return e.trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1]}class He{constructor(e){this.destroys=[],this.proxy=this.proxy.bind(this),this.master=e}proxy(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)return;if(Array.isArray(t))return t.map((t=>this.proxy(e,t,s,i)));e.addEventListener(t,s,i);const r=()=>{"function"==typeof e.removeEventListener&&e.removeEventListener(t,s,i)};return this.destroys.push(r),r}destroy(){this.master.debugLog("Events","destroy"),this.destroys.forEach((e=>e())),this.destroys=[]}}var je=e=>{e.on(ee.decoderWorkerInit,(()=>{e.debugLog("audioPlayer","listen decoderWorkerInit and set loaded true"),e.loaded=!0})),e.on(ee.play,(()=>{e.loading=!1})),e._opt.debug&&(Object.keys(ee).forEach((t=>{e.on(ee[t],(s=>{e.debugLog("audioPlayer events",ee[t],s)}))})),Object.keys(se).forEach((t=>{e.on(se[t],(s=>{e.debugLog("audioPlayer event error",se[t],s)}))})))};class Fe extends t{constructor(e){super(),this.player=e,this.playing=!1,this._requestAbort=!1,this._status=ge,this.writableStream=null,this.abortController=new AbortController,this.streamRate=Be((t=>{e.emit(ee.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,e.debugLog("FetchStream","init")}async destroy(){return this.abort(),await this._closeWritableStream(),this.off(),this._status=ge,this.streamRate=null,this.stopStreamRateInterval(),this.player.debugLog("FetchStream","destroy"),!0}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}async _closeWritableStream(){if(this.writableStream&&xe(this.writableStream.locked))try{await this.writableStream.close(),this.writableStream=null,this.player.debugLog("FetchStream","close writableStream success")}catch(e){this.player.debugLog("FetchStream","destroy and writableStream.close()",e)}}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{demux:s}=this.player;this.player._times.streamStart=Ee();const i=Object.assign({signal:this.abortController.signal},{headers:t.headers||{}});fetch(e,i).then((e=>{if(this._requestAbort)return this._status=ge,void e.body.cancel();if(!function(e){return e.ok&&e.status>=200&&e.status<=299}(e))return this.player.debugError("FetchStream",`fetch response status is ${e.status} and ok is ${e.ok} and emit error and next abort()`),this.abort(),void this.emit(se.fetchError,`fetch response status is ${e.status} and ok is ${e.ok}`);if(this.emit(ee.streamSuccess),this.startStreamRateInterval(),"undefined"!=typeof WritableStream)this.player.debugLog("FetchStream","use WritableStream() to read stream"),this.writableStream=new WritableStream({write:e=>this.abortController&&this.abortController.signal&&this.abortController.signal.aborted?(this.player.debugLog("FetchStream","writableStream.write() and this.abortController.signal.aborted so return"),void(this._status=ye)):Oe(this._requestAbort)?(this.player.debugLog("FetchStream","writableStream.write() and this._requestAbort is true so return"),this._status=ye,void this.abort()):"string"!=typeof e?(this._status=me,this.streamRate&&this.streamRate(e.byteLength),s.dispatch(e)):void this.player.debugWarn("FetchStream",`writableStream.write() and value is "${e}" string so return`),close:()=>{this._status=ye,s.close(),this.emit(ee.streamEnd,"fetch done")},abort:e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return this.player.debugLog("FetchStream","writableStream.abort() and this.abortController.signal.aborted so return"),void(this._status=ye);s.close();const t=e.toString();-1===t.indexOf(ne)&&-1===t.indexOf(he)&&e.name!==le&&(this.abort(),this.emit(se.fetchError,e))}}),e.body.pipeTo(this.writableStream).catch((e=>{"AbortError"!==e.name&&this.player.debugLog("FetchStream","res.body.pipeTo() error",e.name,e.toString())}));else{this.player.debugLog("FetchStream","not support WritableStream and use getReader() to read stream");const t=e.body.getReader(),i=()=>{t.read().then((e=>{let{done:t,value:r}=e;return t?(this._status=ye,s.close(),void this.emit(ee.streamEnd,"fetch done")):this.abortController&&this.abortController.signal&&this.abortController.signal.aborted?(this.player.debugLog("FetchStream","reader.read() and this.abortController.signal.aborted so return"),void(this._status=ye)):Oe(this._requestAbort)?(this.player.debugLog("FetchStream","reader.read() and this._requestAbort is true so return"),this._status=ye,void this.abort()):void("string"!=typeof r?(this._status=me,this.streamRate&&this.streamRate(r.byteLength),s.dispatch(r),i()):this.player.debugWarn("FetchStream",`reader.read() and value is "${r}" string so return`))})).catch((e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return this.player.debugLog("FetchStream","reader.read().catch() and this.abortController.signal.aborted so return"),void(this._status=ye);s.close();const t=e.toString();-1===t.indexOf(ne)&&-1===t.indexOf(he)&&e.name!==le&&(this.abort(),this.emit(se.fetchError,e))}))};i()}})).catch((e=>{this.abortController&&this.abortController.signal&&this.abortController.signal.aborted||"AbortError"!==e.name&&(s.close(),this.abort(),this.emit(se.fetchError,e))}))}abort(){if(this._requestAbort=!0,this.abortController)try{this.abortController.abort(),this.abortController=null,this.player.debugLog("FetchStream","abortController.abort() success")}catch(e){this.abortController=null,this.player.debugLog("FetchStream","abortController.abort() error",e)}}getStreamType(){return h}}class Ve extends t{constructor(e){super(),this.TAG_NAME="FetchWorkerLoader",this.player=e,this.playing=!1,this.fetchWorker=null,this.workerClearTimeout=null,this.workerUrl=null,this.destroyResolve=null,this.decoderWorkerCloseTimeout=null,this.streamRate=Be((t=>{e.emit(ee.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,this._initFetchWorker(),e.debugLog(this.TAG_NAME,"init")}destroy(){return new Promise(((e,t)=>{this.fetchWorker?(this.player.debugLog(this.TAG_NAME,"send destroy"),this.fetchWorker.postMessage({cmd:Q}),this.destroyResolve=e,this.decoderWorkerCloseTimeout=setTimeout((()=>{this.player.debugWarn(this.TAG_NAME,"send close but not response and destroy directly"),this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this._destroy(),setTimeout((()=>{e()}),0)}),2e3)):(this._destroy(),setTimeout((()=>{e()}),0))}))}_destroy(){this.off(),this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this.workerUrl&&(window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.workerClearTimeout&&(clearTimeout(this.workerClearTimeout),this.workerClearTimeout=null),this._stopStreamRateInterval(),this.streamRate=null,this.fetchWorker&&(this.fetchWorker.terminate(),this.fetchWorker.onmessage=null,this.fetchWorker=null),this.destroyResolve&&(this.destroyResolve(),this.destroyResolve=null),this.player.debugLog(this.TAG_NAME,"destroy")}_initFetchWorker(){const e=Qe(function(){function e(e){return!0===e||"true"===e}const t="The user aborted a request",s="AbortError",i="AbortError",r="fetch",o="destroy",A="destroyEnd",a="buffer",n="fetchError",h="fetchClose",l="fetchSuccess",u="idle",d="buffering",c="complete";let p=new class{constructor(){this._requestAbort=!1,this._status=u,this.writableStream=null,this.isChrome=!1,this.abortController=new AbortController}destroy(){var e;this.abort(),this.writableStream&&(!1===(e=this.writableStream.locked)||"false"===e)&&this.writableStream.close().catch((e=>{})),this.writableStream=null,this._status=u}fetchStream(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=Object.assign({signal:this.abortController.signal},{headers:o.headers||{}});fetch(r,A).then((r=>{if(this._requestAbort)return this._status=u,void r.body.cancel();if(!function(e){return e.ok&&e.status>=200&&e.status<=299}(r))return this.abort(),void postMessage({cmd:n,message:`fetch response status is ${r.status} and ok is ${r.ok}`});if(postMessage({cmd:l}),"undefined"!=typeof WritableStream)this.writableStream=new WritableStream({write:t=>{if(!(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted))return e(this._requestAbort)?(this._status=c,void this.abort()):void("string"!=typeof t&&(this._status=d,postMessage({cmd:a,buffer:t},[t.buffer])));this._status=c},close:()=>{this._status=c,postMessage({cmd:h})},abort:e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return void(this._status=c);const r=e.toString();-1===r.indexOf(t)&&-1===r.indexOf(s)&&e.name!==i&&(this.abort(),postMessage({cmd:n,message:e.toString()}))}}),r.body.pipeTo(this.writableStream).catch((e=>{}));else{const o=r.body.getReader(),A=()=>{o.read().then((t=>{let{done:s,value:i}=t;return s?(this._status=c,void postMessage({cmd:h})):this.abortController&&this.abortController.signal&&this.abortController.signal.aborted?void(this._status=c):e(this._requestAbort)?(this._status=c,void this.abort()):void("string"!=typeof i&&(this._status=d,postMessage({cmd:a,buffer:i},[i.buffer]),A()))})).catch((e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return void(this._status=c);const r=e.toString();-1===r.indexOf(t)&&-1===r.indexOf(s)&&e.name!==i&&(this.abort(),postMessage({cmd:n,message:e.toString()}))}))};A()}})).catch((e=>{this.abortController&&this.abortController.signal&&this.abortController.signal.aborted||"AbortError"!==e.name&&(this.abort(),postMessage({cmd:n,message:e.toString()}))}))}abort(){if(this._requestAbort=!0,this.abortController)try{this.abortController.abort(),this.abortController=null}catch(e){this.abortController=null}}};self.onmessage=t=>{const s=t.data;switch(s.cmd){case r:p.isChrome=e(s.isChrome),p.fetchStream(s.url,JSON.parse(s.options));break;case o:p.destroy(),p=null,postMessage({cmd:A})}}}.toString()),t=new Blob([e],{type:"text/javascript"});let s=URL.createObjectURL(t);const i=new Worker(s);this.workerUrl=s,this.workerClearTimeout=setTimeout((()=>{window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null,this.workerClearTimeout=null}),_),i.onmessage=e=>{const{demux:t}=this.player,s=e.data;switch(s.cmd){case j:this.streamRate&&this.streamRate(s.buffer.byteLength),t.dispatch(s.buffer);break;case U:this.emit(ee.streamSuccess),this._startStreamRateInterval();break;case V:t.close(),this.emit(ee.streamEnd,"fetch done");break;case F:t.close(),this.emit(se.fetchError,s.message);break;case H:this._destroy()}},this.fetchWorker=i}_startStreamRateInterval(){this._stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}_stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.player._times.streamStart=Ee(),this.fetchWorker.postMessage({cmd:x,url:e,isChrome:Pe(),options:JSON.stringify(t)})}getStreamType(){return h}}class Ue extends t{constructor(e){super(),this.player=e,this.socket=null,this.socketStatus=ie,this.wsUrl=null,this.requestAbort=!1,this.socketDestroyFnList=[],this.streamRate=Be((t=>{e.emit(ee.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,e.debugLog("WebsocketStream","init")}async destroy(){this._closeWebSocket(),this.stopStreamRateInterval(),this.wsUrl=null,this.off(),this.player.debugLog("WebsocketStream","destroy")}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_createWebSocket(e){const t=this.player,{events:{proxy:s},demux:i}=t,r=e.protocols||[];this.socket=new WebSocket(this.wsUrl,r),this.socket.binaryType="arraybuffer";const o=s(this.socket,"open",(()=>{this.player.debugLog("WebsocketStream","socket open"),this.socketStatus=re,this.emit(ee.streamSuccess),this.player.emit(ee.websocketOpen),this.startStreamRateInterval()})),A=s(this.socket,"message",(e=>{"string"!=typeof e.data?(this.streamRate&&this.streamRate(e.data.byteLength),this._handleMessage(e.data)):this.player.debugWarn("WebsocketStream",`websocket handle message message is "${e.data}" string so return`)})),a=s(this.socket,"close",(e=>{if(!this.player.isDestroyedOrClosed())return Oe(this.requestAbort)?(this.requestAbort=!1,void this.player.debugLog("WebsocketStream","socket close and requestAbort is true")):void(this.socketStatus!==Ae?(this.player.debugLog("WebsocketStream",`socket close and code is ${e.code}`),1006===e.code&&this.player.debugError("WebsocketStream",`socket close abnormally and code is ${e.code}`),i.close(),this.socketStatus=oe,this.player.emit(ee.websocketClose,e.code),this.emit(ee.streamEnd,e.code)):this.player.debugLog("WebsocketStream","socket close and status is error, so return"))})),n=s(this.socket,"error",(e=>{if(this.player.isDestroyedOrClosed())return;if(Oe(this.requestAbort))return this.requestAbort=!1,void this.player.debugLog("WebsocketStream","socket close and requestAbort is true");this.player.debugError("WebsocketStream","socket error",e),this.socketStatus=Ae;const t=e.isTrusted?"websocket user aborted":"websocket error";this.emit(se.websocketError,t),i.close(),this.player.debugLog("WebsocketStream","socket error:",t)}));this.socketDestroyFnList.push(o,A,a,n)}_closeWebSocket(){!this.socket||0!==this.socket.readyState&&1!==this.socket.readyState?this.socket&&this.player.debugLog("WebsocketStream",`_closeWebSocket() socket is null or socket status is ${this.socket&&this.socket.readyState}`):(this.requestAbort=!0,this.socket.close(1e3,"Client disconnecting")),this.socketDestroyFnList.forEach((e=>e())),this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket.onerror=null,this.socket=null,this.socketStatus=ie,this.streamRate=null}_handleMessage(e){const{demux:t}=this.player;t?t.dispatch(e):this.player.debugWarn("WebsocketStream","websocket handle message demux is null so return")}fetchStream(e,t){this.player._times.streamStart=Ee(),this.wsUrl=e,this._createWebSocket(t)}sendMessage(e){this.socket?this.socketStatus===re?this.socket.send(e):this.player.debugError("WebsocketStream",`websocket send message error and  socket status is ${this.socketStatus}`):this.player.debugError("WebsocketStream","websocket send message socket is null")}getStreamType(){return u}}class $e extends t{constructor(e){super(),this.player=e,this.TAG_NAME="WebsocketWorkerLoader",this.wsUrl=null,this.socketStatus=ie,this.websocketWorker=null,this.workerClearTimeout=null,this.workerUrl=null,this.destroyResolve=null,this.decoderWorkerCloseTimeout=null,this.streamRate=Be((t=>{e.emit(ee.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,this._initWebsocketWorker(),this.player.debugLog(this.TAG_NAME,"init")}destroy(){return new Promise(((e,t)=>{this.websocketWorker?(this.player.debugLog(this.TAG_NAME,"send destroy"),this._closeWebSocket(),this.destroyResolve=e,this.decoderWorkerCloseTimeout=setTimeout((()=>{this.player.debugWarn(this.TAG_NAME,"send close but not response and destroy directly"),this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this._destroy(),e()}),2e3)):(this._destroy(),e())}))}_destroy(){this.off(),this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this.workerUrl&&(window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.workerClearTimeout&&(clearTimeout(this.workerClearTimeout),this.workerClearTimeout=null),this._stopStreamRateInterval(),this.streamRate=null,this.websocketWorker&&(this.websocketWorker.terminate(),this.websocketWorker.onmessage=null,this.websocketWorker=null),this.destroyResolve&&(this.destroyResolve(),this.destroyResolve=null),this.wsUrl=null,this.player.debugLog(this.TAG_NAME,"destroy")}_initWebsocketWorker(){const e=Qe(function(){function e(e){return!0===e||"true"===e}const t={fetch:"fetch",sendMessage:"sendMessage",destroy:"destroy",destroyEnd:"destroyEnd",buffer:"buffer",websocketError:"websocketError",websocketClose:"websocketClose",websocketOpen:"websocketOpen"};let s=new class{constructor(){this.socket=null,this.wsUrl=null,this.requestAbort=!1}destroy(){!this.socket||0!==this.socket.readyState&&1!==this.socket.readyState||(this.requestAbort=!0,this.socket.close(1e3,"Client disconnecting")),this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket=null}fetchStream(e,t){this.wsUrl=e,this._createWebSocket(t)}sendMessage(e){this.socket&&1===this.socket.readyState&&this.socket.send(e)}_createWebSocket(e){const t=e.protocols||[];this.socket=new WebSocket(this.wsUrl,t),this.socket.binaryType="arraybuffer",this.socket.onopen=this._handleWebsocketOpen.bind(this),this.socket.onclose=this._handleWebsocketClose.bind(this),this.socket.onerror=this._handleWebsocketError.bind(this),this.socket.onmessage=this._handleWebsocketMessage.bind(this)}_handleWebsocketOpen(){postMessage({cmd:t.websocketOpen})}_handleWebsocketClose(s){e(this.requestAbort)?this.requestAbort=!1:postMessage({cmd:t.websocketClose,code:s.code})}_handleWebsocketError(s){e(this.requestAbort)?this.requestAbort=!1:postMessage({cmd:t.websocketError,isTrusted:s.isTrusted})}_handleWebsocketMessage(e){if("string"==typeof e.data)return;const s=new Uint8Array(e.data);postMessage({cmd:t.buffer,buffer:s},[s.buffer])}};self.onmessage=e=>{const i=e.data;switch(i.cmd){case t.fetch:s.fetchStream(i.url,i.options);break;case t.destroy:s.destroy(),s=null,postMessage({cmd:t.destroyEnd});break;case t.send:s.sendMessage(i.message)}}}.toString()),t=new Blob([e],{type:"text/javascript"});let s=URL.createObjectURL(t);const i=new Worker(s);this.workerUrl=s,this.workerClearTimeout=setTimeout((()=>{window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null,this.workerClearTimeout=null}),_),i.onmessage=e=>{const{demux:t}=this.player,s=e.data;switch(s.cmd){case J:this.streamRate&&this.streamRate(s.buffer.byteLength),t.dispatch(s.buffer);break;case K:this.player.debugLog(this.TAG_NAME,"socket open"),this.socketStatus=re,this.emit(ee.streamSuccess),this.player.emit(ee.websocketOpen),this._startStreamRateInterval();break;case X:if(this.player.isDestroyedOrClosed())return;if(this.socketStatus===Ae)return void this.player.debugLog(this.TAG_NAME,"socket close and status is error, so return");this.player.debugLog(this.TAG_NAME,`socket close and code is ${s.code}`),1006===s.code&&this.player.debugError(this.TAG_NAME,`socket close abnormally and code is ${s.code}`),t.close(),this.socketStatus=oe,this.player.emit(ee.websocketClose,s.code),this.emit(ee.streamEnd,s.code);break;case Z:if(this.player.isDestroyedOrClosed())return;this.player.debugError(this.TAG_NAME,"socket error"),this.socketStatus=Ae;const e=s.isTrusted?"websocket user aborted":"websocket error";this.emit(se.websocketError,e),t.close(),this.player.debugLog(this.TAG_NAME,"socket error:",e);break;case q:this._destroy()}},this.websocketWorker=i}_startStreamRateInterval(){this._stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}_stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_closeWebSocket(){this.websocketWorker&&this.websocketWorker.postMessage({cmd:z})}fetchStream(e,t){this.player._times.streamStart=Ee(),this.wsUrl=e,this.websocketWorker&&this.websocketWorker.postMessage({cmd:$,url:e,options:t})}sendMessage(e){this.websocketWorker&&this.websocketWorker.postMessage({cmd:Y,message:e})}getStreamType(){return u}}class Ye extends t{constructor(e){super(),this.player=e,e.debugLog("HlsStream","init")}async destroy(){return this.off(),this.player.debugLog("HlsStream","destroy"),!0}fetchStream(e){const{hlsDecoder:t,debug:s}=this.player;this.player._times.streamStart=Ee(),t.loadSource(e).then((()=>{this.player.debugLog("HlsStream","loadSource success"),this.emit(ee.streamSuccess)})).catch((e=>{this.emit(se.hlsError,e)}))}getStreamType(){return l}}class ze extends t{constructor(e){super(),this.player=e,this.webrctUrl=null,e.debugLog("WebrtcStream","init")}async destroy(){return this.webrctUrl=null,this.off(),this.player.debugLog("WebrtcStream","destroy"),!0}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{webrtc:s,debug:i}=this.player;if(this.player._times.streamStart=Ee(),this.webrctUrl=e.replace("webrtc:",window.location.protocol),this.player.isWebrtcForM7S()&&-1===this.webrctUrl.indexOf("/webrtc/play")){const t=new URL(this.webrctUrl),s="/webrtc/play"+t.pathname;this.webrctUrl=t.origin+s+t.search,this.player.debugLog("WebrtcStream",`original url is ${e}, and new url is: ${this.webrctUrl}`)}s.loadSource(this.webrctUrl,t).then((()=>{this.player.debugLog("WebrtcStream","loadSource success"),this.emit(ee.streamSuccess)})).catch((e=>{this.player.debugError("WebrtcStream","loadSource error",e),this.emit(se.webrtcError,e)}))}getStreamType(){return d}}class qe extends t{constructor(e){super(),this.player=e,this.transport=null,this.wtUrl=null,this.streamRate=Be((t=>{e.emit(ee.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,e.debugLog("WebTransportLoader","init")}async destroy(){return this.abort(),this.off(),this.player.debugLog("WebTransportLoader","destroy"),!0}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_createWebTransport(){const e=this.player,{debug:t,events:{proxy:s},demux:i}=e;try{this.transport=new WebTransport(this.wtUrl),this.transport.ready.then((()=>{this.emit(ee.streamSuccess),this.startStreamRateInterval(),this.transport.createBidirectionalStream().then((e=>{e.readable.pipeTo(new WritableStream(i.input))}))})).catch((e=>{this.player.debugWarn("WebTransportLoader","_createWebTransport-ready",e)}))}catch(e){this.player.debugWarn("WebTransportLoader","_createWebTransport",e)}}fetchStream(e){this.player._times.streamStart=Ee(),this.wtUrl=e.replace(/^wt:/,"https:"),this._createWebTransport()}abort(){if(this.transport)try{this.transport.close(),this.transport=null}catch(e){this.transport=null}}getStreamType(){return c}}class Je extends t{constructor(e){super(),this.player=e,this.workUrl=null,e.debugLog("WorkerStream","init")}async destroy(){return this.workUrl=null,this.off(),this.player.debugLog("WorkerStream","destroy"),!0}sendMessage(e){this.player.decoderWorker.workerSendMessage(e)}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.workUrl=e,this.player._times.streamStart=Ee(),this.player.decoderWorker.workerFetchStream(e,t)}getStreamType(){const e=this.player._opt.protocol;return p+" "+(e===i?h:u)}}class Ze extends t{constructor(e){super(),this.TAG_NAME="AliyunRtcLoader",this.player=e,e.debugLog(this.TAG_NAME,"init")}async destroy(){return this.off(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}fetchStream(e){const{aliyunRtcDecoder:t}=this.player;this.player._times.streamStart=Ee(),t.loadSource(e).then((()=>{this.player.debugLog(this.TAG_NAME,"loadSource success"),this.emit(ee.streamSuccess)})).catch((e=>{this.player.debugError(this.TAG_NAME,"loadSource error",e),this.emit(se.aliyunRtcError,e)}))}getStreamType(){return g}}class Xe extends t{constructor(e){super(),this.TAG_NAME="Mp4StreamLoader",this.player=e,e.debug.log(this.TAG_NAME,"init")}destroy(){this.off(),this.player.debug.log(this.TAG_NAME,"destroy")}fetchStream(e){const{mp4Decoder:t}=this.player;this.player._times.streamStart=Ee(),t.loadSource(e).then((()=>{this.player.debugLog(this.TAG_NAME,"loadSource success"),this.emit(ee.streamSuccess)})).catch((e=>{this.emit(se.playVodMp4Error,e)}))}getStreamType(){return m}}class Ke{constructor(e){return new(Ke.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){const{protocol:t,useWasm:n,playType:h,useWCS:l,useMSE:u,demuxUseWorker:d,mainThreadFetchUseWorker:c,isFmp4:p}=e;return h===w&&p?Xe:t===r?Ye:t===o?ze:t===A?qe:t===a?Ze:t===i?h===f?Je:h===y?n&&!We(e)||d?Je:c?Ve:Fe:l||u?d?Je:c?Ve:Fe:Je:t===s?h===f?Je:h===y?n&&!We(e)||d?Je:c?$e:Ue:l||u?d?Je:c?$e:Ue:Je:void 0}}class et extends t{constructor(e){super(),this.bufferList=[],this.player=e,this.$audio=null,this.scriptNode=null,this.workletProcessorNode=null,this.workletWorkerCloseTimeout=null,this.hasInitScriptNode=!1,this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3}),this.gainNode=this.audioContext.createGain();const t=this.audioContext.createBufferSource();t.buffer=this.audioContext.createBuffer(1,1,22050),t.connect(this.audioContext.destination),t.noteOn?t.noteOn(0):t.start(0),this.audioBufferSourceNode=t,this.mediaStreamAudioDestinationNode=this.audioContext.createMediaStreamDestination(),this.gainNode.gain.value=0,this._prevVolume=null,this.playing=!1,this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""},this.init=!1,this.hasAudio=!1,this.audioResumeStateTimeout=null,this.audioContextContextResumeLock=!1}async destroy(){return this.closeAudio(),this.resetInit(),this.clearAudioResumeStateTimeout(),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.hasAudio=!1,this.playing=!1,this.scriptNode&&(this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=ke,this.scriptNode=null),await this._destroyWorklet(),this.workletProcessorNode&&(this.workletProcessorNode.disconnect(),this.workletProcessorNode.port.onmessage=ke,this.workletProcessorNode=null),this.audioBufferSourceNode&&(this.audioBufferSourceNode.stop(),this.audioBufferSourceNode=null),this.mediaStreamAudioDestinationNode&&(this.mediaStreamAudioDestinationNode.disconnect(),this.mediaStreamAudioDestinationNode=null),this.hasInitScriptNode=!1,this._prevVolume=null,this.audioContextContextResumeLock=!1,this.off(),!0}_destroyWorklet(){return new Promise(((e,t)=>{this.workletProcessorNode?(this.workletProcessorNode.port.postMessage({type:"destroy"}),this.workletWorkerCloseTimeout=setTimeout((()=>{this.player.debugLog(this.TAG_NAME,"send close and wait 10ms destroy directly"),this.workletWorkerCloseTimeout&&(clearTimeout(this.workletWorkerCloseTimeout),this.workletWorkerCloseTimeout=null),e()}),10)):e()}))}resetInit(){this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""},this.init=!1}getAudioInfo(){return this.audioInfo}updateAudioInfo(e){e.encTypeCode&&(this.audioInfo.encTypeCode=e.encTypeCode,this.audioInfo.encType=ae[e.encTypeCode]),e.channels&&(this.audioInfo.channels=e.channels),e.sampleRate&&(this.audioInfo.sampleRate=e.sampleRate),e.depth&&(this.audioInfo.depth=e.depth),this.audioInfo.sampleRate&&this.audioInfo.channels&&this.audioInfo.encType&&!this.init&&(this.player.emit(ee.audioInfo,this.audioInfo),this.init=!0)}get isPlaying(){return this.playing}get isMute(){return 0===this.gainNode.gain.value||this.isStateSuspended()}get volume(){return this.gainNode.gain.value}get bufferSize(){return this.bufferList.length}get audioContextState(){let e=null;return this.audioContext&&(e=this.audioContext.state),e}initScriptNode(){}initMobileScriptNode(){}initWorkletScriptNode(){}getEngineType(){return""}mute(e){e?(this.setVolume(0),this.clear()):this.setVolume(this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e).toFixed(2),isNaN(e)||(this.audioEnabled(!0),e=Ce(e,0,1),null!==this._prevVolume&&this._prevVolume===e||(null===this._prevVolume?this.player.emit(ee.mute,0===e):0===this._prevVolume&&e>0?this.player.emit(ee.mute,!1):this._prevVolume>0&&0===e&&this.player.emit(ee.mute,!0),this.gainNode.gain.value=e,this.player.emit(ee.volumechange,this.player.volume),this.player.emit(ee.volume,this.player.volume),this._prevVolume=e))}closeAudio(){this.hasInitScriptNode&&(this.scriptNode&&this.scriptNode.disconnect(this.gainNode),this.workletProcessorNode&&this.workletProcessorNode.disconnect(this.gainNode),this.gainNode&&(this.gainNode.disconnect(this.mediaStreamAudioDestinationNode),this.$audio||this.gainNode.disconnect(this.audioContext.destination))),this.clear()}audioEnabled(e){if(e&&this.isStateSuspended()){if(this.audioContextContextResumeLock)return;this.audioContextContextResumeLock=!0,this.audioContext.resume().then((()=>{this.player.emit(ee.audioResumeState,{state:this.audioContextState,isRunning:this.isStateRunning()})})).finally((()=>{this.audioContextContextResumeLock=!1})),this.audioResumeStateTimeout=setTimeout((()=>{this.clearAudioResumeStateTimeout(),this.audioContextContextResumeLock=!1,this.isStateSuspended()&&this.player.emit(ee.audioResumeState,{state:this.audioContextState,isRunning:this.isStateRunning()})}),1e3)}}isStateRunning(){return"running"===this.audioContextState}isStateSuspended(){return"suspended"===this.audioContextState}clearAudioResumeStateTimeout(){this.audioResumeStateTimeout&&(clearTimeout(this.audioResumeStateTimeout),this.audioResumeStateTimeout=null)}clear(){this.bufferList=[]}play(e,t){}pause(){this.playing=!1}resume(){this.playing=!0}setRate(e){}getAudioBufferSize(){return 0}}class tt{constructor(e,t,s,i){this.player=e,this.audio=t,this.channel=s,this.bufferSize=i}destroy(){this.buffer=null,this.channel=null}extract(e,t){let s=this.provide(t);for(let t=0;t<s.size;t++)e[2*t]=s.left[t],e[2*t+1]=s.right[t];return this.audio.tempAudioTimestamp=s.ts,s.size}provide(e){let t=new Float32Array(e),s=new Float32Array(e),i=0,r=0,o=0,A=e/this.bufferSize;const a=this.audio.bufferList;if(A&&a.length>=A){try{for(let e=0;e<A;e++){const e=a.shift();2===this.channel?(t.set(e.buffer[0],o),s.set(e.buffer[1],o)):(t.set(e.buffer[0],o),s.set(e.buffer[0],o)),o+=this.bufferSize,r=e.ts}}catch(e){this.player.debugWarn("Processor","provide()",e),t=new Float32Array(0),s=new Float32Array(0)}i=t.length}return{size:i,ts:r,left:t,right:s}}}class st{constructor(){this._vector=new Float32Array,this._position=0,this._frameCount=0}destroy(){this.clear(),this._vector=null}get vector(){return this._vector}get position(){return this._position}get startIndex(){return 2*this._position}get frameCount(){return this._frameCount}get endIndex(){return 2*(this._position+this._frameCount)}clear(){this.receive(this._frameCount),this.rewind()}put(e){this._frameCount+=e}putSamples(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=2*(t=t||0);s>=0||(s=(e.length-i)/2);const r=2*s;this.ensureCapacity(s+this._frameCount);const o=this.endIndex;this.vector.set(e.subarray(i,i+r),o),this._frameCount+=s}putBuffer(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=t||0,s>=0||(s=e.frameCount-t),this.putSamples(e.vector,e.position+t,s)}receive(e){e>=0&&!(e>this._frameCount)||(e=this.frameCount),this._frameCount-=e,this._position+=e}receiveSamples(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=2*t,i=this.startIndex;e.set(this._vector.subarray(i,i+s)),this.receive(t)}extract(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.startIndex+2*t,r=2*s;e.set(this._vector.subarray(i,i+r))}ensureCapacity(){const e=parseInt(2*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0));if(this._vector.length<e){const t=new Float32Array(e);t.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=t,this._position=0}else this.rewind()}ensureAdditionalCapacity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.ensureCapacity(this._frameCount+e)}rewind(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}}class it{constructor(e){e?(this._inputBuffer=new st,this._outputBuffer=new st):this._inputBuffer=this._outputBuffer=null}destroy(){this.clear(),this._outputBuffer&&(this._outputBuffer.destroy(),this._outputBuffer=null),this._inputBuffer&&(this._inputBuffer.destroy(),this._inputBuffer=null)}get inputBuffer(){return this._inputBuffer}set inputBuffer(e){this._inputBuffer=e}get outputBuffer(){return this._outputBuffer}set outputBuffer(e){this._outputBuffer=e}clear(){this._inputBuffer.clear(),this._outputBuffer.clear()}}class rt extends it{constructor(e){super(e),this.reset(),this._rate=1}destroy(){super.destroy()}set rate(e){this._rate=e}reset(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}clone(){const e=new rt;return e.rate=this._rate,e}process(){const e=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(e/this._rate+1);const t=this.transpose(e);this._inputBuffer.receive(),this._outputBuffer.put(t)}transpose(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return 0;const t=this._inputBuffer.vector,s=this._inputBuffer.startIndex,i=this._outputBuffer.vector,r=this._outputBuffer.endIndex;let o=0,A=0;for(;this.slopeCount<1;)i[r+2*A]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*t[s],i[r+2*A+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*t[s+1],A+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!==e)e:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,o+=1,o>=e-1)break e;const a=s+2*o;i[r+2*A]=(1-this.slopeCount)*t[a]+this.slopeCount*t[a+2],i[r+2*A+1]=(1-this.slopeCount)*t[a+1]+this.slopeCount*t[a+3],A+=1,this.slopeCount+=this._rate}return this.prevSampleL=t[s+2*e-2],this.prevSampleR=t[s+2*e-1],A}}const ot=function(){};class At extends class{constructor(e){this._pipe=e}destroy(){}get pipe(){return this._pipe}get inputBuffer(){return this._pipe.inputBuffer}get outputBuffer(){return this._pipe.outputBuffer}fillInputBuffer(){throw new Error("fillInputBuffer() not overridden")}fillOutputBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;for(;this.outputBuffer.frameCount<e;){const e=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(e),this.inputBuffer.frameCount<16384)break;this._pipe.process()}}clear(){this._pipe.clear()}}{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ot;super(t),this.callback=s,this.sourceSound=e,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}destroy(){this.clear(),this.sourceSound.destroy(),this.sourceSound=null,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}get position(){return this._position}set position(e){if(e>this._position)throw new RangeError("New position may not be greater than current position");const t=this.outputBufferPosition-(this._position-e);if(t<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=t,this._position=e}get sourcePosition(){return this._sourcePosition}set sourcePosition(e){this.clear(),this._sourcePosition=e}onEnd(){this.callback()}fillInputBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=new Float32Array(2*e),s=this.sourceSound.extract(t,e,this._sourcePosition);this._sourcePosition+=s,this.inputBuffer.putSamples(t,0,s)}extract(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillOutputBuffer(this.outputBufferPosition+t);const s=Math.min(t,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(e,this.outputBufferPosition,s);const i=this.outputBufferPosition+s;return this.outputBufferPosition=Math.min(this.historyBufferSize,i),this.outputBuffer.receive(Math.max(i-this.historyBufferSize,0)),this._position+=s,s}handleSampleData(e){this.extract(e.data,4096)}clear(){super.clear(),this.outputBufferPosition=0}}const at=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],nt=-10/1.5;class ht extends it{constructor(e){super(e),this._quickSeek=!0,this.midBufferDirty=!1,this.midBuffer=null,this.refMidBuffer=null,this.overlapLength=0,this.autoSeqSetting=!0,this.autoSeekSetting=!0,this._tempo=1,this.setParameters(44100,0,0,8)}destroy(){this.clear(),super.destroy()}clear(){super.clear(),this.clearMidBuffer(),this.refMidBuffer=null}clearMidBuffer(){this.midBufferDirty&&(this.midBufferDirty=!1),this.midBuffer=null}setParameters(e,t,s,i){e>0&&(this.sampleRate=e),i>0&&(this.overlapMs=i),t>0?(this.sequenceMs=t,this.autoSeqSetting=!1):this.autoSeqSetting=!0,s>0?(this.seekWindowMs=s,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}set tempo(e){let t;this._tempo=e,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,t=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(t+this.overlapLength,this.seekWindowLength)+this.seekLength}get tempo(){return this._tempo}get inputChunkSize(){return this.sampleReq}get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}calculateOverlapLength(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e=this.sampleRate*t/1e3,e=e<16?16:e,e-=e%8,this.overlapLength=e,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}checkLimits(e,t,s){return e<t?t:e>s?s:e}calculateSequenceParameters(){let e,t;this.autoSeqSetting&&(e=150+-50*this._tempo,e=this.checkLimits(e,50,125),this.sequenceMs=Math.floor(e+.5)),this.autoSeekSetting&&(t=28.333333333333332+nt*this._tempo,t=this.checkLimits(t,15,25),this.seekWindowMs=Math.floor(t+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}set quickSeek(e){this._quickSeek=e}clone(){const e=new ht;return e.tempo=this._tempo,e.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),e}seekBestOverlapPosition(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}seekBestOverlapPositionStereo(){let e,t,s,i=0;for(this.preCalculateCorrelationReferenceStereo(),e=0,t=Number.MIN_VALUE;i<this.seekLength;i+=1)s=this.calculateCrossCorrelationStereo(2*i,this.refMidBuffer),s>t&&(t=s,e=i);return e}seekBestOverlapPositionStereoQuick(){let e,t,s,i,r,o=0;for(this.preCalculateCorrelationReferenceStereo(),t=Number.MIN_VALUE,e=0,i=0,r=0;o<4;o+=1){let A=0;for(;at[o][A]&&(r=i+at[o][A],!(r>=this.seekLength));)s=this.calculateCrossCorrelationStereo(2*r,this.refMidBuffer),s>t&&(t=s,e=r),A+=1;i=e}return e}preCalculateCorrelationReferenceStereo(){let e,t,s=0;for(;s<this.overlapLength;s+=1)t=s*(this.overlapLength-s),e=2*s,this.refMidBuffer[e]=this.midBuffer[e]*t,this.refMidBuffer[e+1]=this.midBuffer[e+1]*t}calculateCrossCorrelationStereo(e,t){const s=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;let i=0,r=2;const o=2*this.overlapLength;let A;for(;r<o;r+=2)A=r+e,i+=s[A]*t[r]+s[A+1]*t[r+1];return i}overlap(e){this.overlapStereo(2*e)}overlapStereo(e){const t=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;const s=this._outputBuffer.vector,i=this._outputBuffer.endIndex;let r,o,A=0;const a=1/this.overlapLength;let n,h,l;for(;A<this.overlapLength;A+=1)o=(this.overlapLength-A)*a,n=A*a,r=2*A,h=r+e,l=r+i,s[l+0]=t[h+0]*n+this.midBuffer[r+0]*o,s[l+1]=t[h+1]*n+this.midBuffer[r+1]*o}process(){let e,t,s;if(null===this.midBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){e=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(e)),this._outputBuffer.put(this.overlapLength),t=this.seekWindowLength-2*this.overlapLength,t>0&&this._outputBuffer.putBuffer(this._inputBuffer,e+this.overlapLength,t);const i=this._inputBuffer.startIndex+2*(e+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(i,i+2*this.overlapLength)),this.skipFract+=this.nominalSkip,s=Math.floor(this.skipFract),this.skipFract-=s,this._inputBuffer.receive(s)}}}const lt=function(e,t){return(e>t?e-t:t-e)>1e-10};class ut{constructor(){this.transposer=new rt(!1),this.stretch=new ht(!1),this._inputBuffer=new st,this._intermediateBuffer=new st,this._outputBuffer=new st,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}destroy(){this.clear(),this._inputBuffer.destroy(),this._intermediateBuffer.destroy(),this._outputBuffer.destroy(),this._inputBuffer=null,this._intermediateBuffer=null,this._outputBuffer=null}clear(){this.transposer.clear(),this.stretch.clear()}clone(){const e=new ut;return e.rate=this.rate,e.tempo=this.tempo,e}get rate(){return this._rate}set rate(e){this.virtualRate=e,this.calculateEffectiveRateAndTempo()}set rateChange(e){this._rate=1+.01*e}get tempo(){return this._tempo}set tempo(e){this.virtualTempo=e,this.calculateEffectiveRateAndTempo()}set tempoChange(e){this.tempo=1+.01*e}set pitch(e){this.virtualPitch=e,this.calculateEffectiveRateAndTempo()}set pitchOctaves(e){this.pitch=Math.exp(.69314718056*e),this.calculateEffectiveRateAndTempo()}set pitchSemitones(e){this.pitchOctaves=e/12}get inputBuffer(){return this._inputBuffer}get outputBuffer(){return this._outputBuffer}calculateEffectiveRateAndTempo(){const e=this._tempo,t=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,lt(this._tempo,e)&&(this.stretch.tempo=this._tempo),lt(this._rate,t)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}process(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}}class dt{constructor(e,t,s){this.player=e,this.audio=t,this.soundTouch=new ut,this.soundTouch.tempo=1,this.soundTouch.rate=1,this.filter=new At(s,this.soundTouch)}destroy(){this.filter&&(this.filter.destroy(),this.filter=null),this.soundTouch&&(this.soundTouch.destroy(),this.soundTouch=null)}setRate(e){e!==this.soundTouch.rate&&(this.soundTouch.tempo=e)}provide(e){let t=new Float32Array(2*e),s=this.filter.extract(t,e),i=new Float32Array(s),r=new Float32Array(s);for(let e=0;e<s;e++)i[e]=t[2*e],r[e]=t[2*e+1];return{size:s,left:i,right:r,ts:this.audio.tempAudioTimestamp||0}}}class ct extends et{constructor(e){super(e),this.TAG_NAME="AudioContext",this.defaultPlaybackRate=1,this.playbackRate=1,this.rateProcessor=null,this.processor=null,this.scriptNodeInterval=null,this.engineType=this.getAutoAudioEngineType(),this.audioBufferSize=this.getAudioBufferSizeByType(),this.$audio=null,this._delayPlay=!1,this.eventListenList=[],this.workletUrl=null,this.clearWorkletUrlTimeout=null,this.player._opt.supportLockScreenPlayAudio&&Te()&&(this.$audio=document.createElement("audio"),Object.assign(this.$audio.style,{position:"absolute",left:"-100%",top:"-100%"}),e.$container?e.$container.appendChild(this.$audio):document.body.appendChild(this.$audio),this._bindAudioProxy(),this.player.debugLog("AudioContext","create audio element")),this.scriptStartTime=0,this.player.debugLog("AudioContext","init",`engineType: ${this.engineType}, audioBufferSize: ${this.audioBufferSize}`)}async destroy(){return await super.destroy(),this.workletUrl&&(URL.revokeObjectURL(this.workletUrl),this.workletUrl=null),this.clearWorkletUrlTimeout&&(clearTimeout(this.clearWorkletUrlTimeout),this.clearWorkletUrlTimeout=null),this.eventListenList.length&&(this.eventListenList.forEach((e=>{e()})),this.eventListenList=[]),this.$audio&&(this.$audio.pause(),this.$audio.srcObject=null,this.$audio.parentNode&&this.$audio.parentNode.removeChild(this.$audio),this.$audio=null),this.processor&&(this.processor.destroy(),this.processor=null),this.rateProcessor&&(this.rateProcessor.destroy(),this.rateProcessor=null),this.scriptNodeInterval&&(clearInterval(this.scriptNodeInterval),this.scriptNodeInterval=null),this.defaultPlaybackRate=1,this.playbackRate=1,this.scriptStartTime=0,this.audioBufferSize=0,this.engineType=de,this.player.debugLog("AudioContext","destroy"),!0}isAudioPlaying(){return this.$audio&&xe(this.$audio.paused)&&xe(this.$audio.ended)&&0!==this.$audio.playbackRate&&0!==this.$audio.readyState}_bindAudioProxy(){const{proxy:e}=this.player.events,t=e(this.$audio,"canplay",(()=>{this.player.debugLog("AudioContext","canplay"),this._delayPlay&&this._audioElementPlay()}));this.eventListenList.push(t)}_getAudioElementReadyState(){let e=0;return this.$audio&&(e=this.$audio.readyState),e}audioElementPlay(){if(this.$audio){const e=this._getAudioElementReadyState();if(this.player.debugLog("AudioContext",`play and readyState: ${e}`),!(0!==e||Re()&&Te()))return this.player.debugWarn("AudioContext","readyState is 0 and set _delayPlay to true"),void(this._delayPlay=!0);this._audioElementPlay()}}_audioElementPlay(){this.$audio&&this.$audio.play().then((()=>{this._delayPlay=!1,this.player.debugLog("AudioContext","_audioElementPlay success and volume is ",this.$audio.volume),setTimeout((()=>{this.isAudioPlaying()||(this.player.debugWarn("AudioContext","play failed and retry play"),this._audioElementPlay())}),100),this.isAudioPlaying()&&(this.player.debugLog("AudioContext","play success and remove document click event listener"),document.removeEventListener("click",this._audioElementPlay.bind(this)))})).catch((e=>{this.player.debugError("AudioContext","_audioElementPlay error",e),this.player.debugLog("AudioContext","play failed and add document click event listener"),document.addEventListener("click",this._audioElementPlay.bind(this))}))}getAudioBufferSize(){return this.audioBufferSize}get oneBufferDuration(){return this.audioBufferSize/this.audioContext.sampleRate*1e3}get isActiveEngineType(){return this.engineType===ce}getBufferListDuration(){return this.bufferList.length*this.oneBufferDuration}isMoreThanMinBufferDuration(){return this.getBufferListDuration()>=100*this.playbackRate}initProcessor(){this.processor=new tt(this.player,this,this.audioInfo.channels,this.audioBufferSize),this.rateProcessor=new dt(this.player,this,this.processor)}getAutoAudioEngineType(){let e=this.player._opt.audioEngine||de;const t=()=>{e=Le()?ce:(Te()&&this.player._opt.supportLockScreenPlayAudio||Ne()&&this.supportAudioWorklet(),de)};return this.player._opt.audioEngine?this.player._opt.audioEngine===ue&&Ne()&&this.supportAudioWorklet()?e=de:this.player._opt.audioEngine===ce?e=ce:this.player._opt.audioEngine===de?e=de:t():t(),e}getAudioBufferSizeByType(){const e=this.engineType;this.player._opt.hasVideo;const t=this.player._opt.weiXinInAndroidAudioBufferSize;return e===ue?1024:e===ce?t||4800:1024}supportAudioWorklet(){return this.audioContext&&this.audioContext.audioWorklet&&"function"==typeof this.audioContext.audioWorklet.addModule}initScriptNode(){this.playing=!0,this.hasInitScriptNode||(this.initProcessor(),this.engineType===ue?this.initWorkletScriptNode():this.engineType===ce?this.initIntervalScriptNode():this.engineType===de&&this.initProcessScriptNode(),this.audioElementPlay())}getEngineType(){return this.engineType}isPlaybackRateSpeed(){return this.playbackRate>this.defaultPlaybackRate}initProcessScriptNode(){const e=this.audioContext.createScriptProcessor(this.audioBufferSize,0,this.audioInfo.channels);e.onaudioprocess=e=>{const t=e.outputBuffer;this.handleScriptNodeCallback(t)},e.connect(this.gainNode),this.scriptNode=e,this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0}initIntervalScriptNode(){this.scriptStartTime=0;const e=1e3*this.audioBufferSize/this.audioContext.sampleRate;this.scriptNodeInterval=setInterval((()=>{if(0===this.bufferList.length||xe(this.playing)||this.isMute)return void(this.playing&&xe(this.isMute)&&this.player.debugLog("AudioContext",`interval script node and bufferList is ${this.bufferList.length} or playing is ${this.playing}`));const e=this.audioContext.createBufferSource(),t=this.audioContext.createBuffer(this.audioInfo.channels,this.audioBufferSize,this.audioContext.sampleRate);this.handleScriptNodeCallback(t,(()=>{this.scriptStartTime<this.audioContext.currentTime&&(this.player.debugLog("AudioContext",`script start time ${this.scriptStartTime} is less than current time ${this.audioContext.currentTime}`),this.scriptStartTime=this.audioContext.currentTime),e.buffer=t,e.connect(this.gainNode),e.start(this.scriptStartTime),this.scriptStartTime+=t.duration}))}),e),this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0}initWorkletScriptNode(){let e=function(e){const t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],s=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(s)}((function(){class e extends AudioWorkletProcessor{constructor(){super(),this.audioBufferSize=1024,this.start=!1,this.channels=1,this.samplesArray=[],this.offset=0,this.state=0,this.port.onmessage=e=>{"init"===e.data.message?(this.audioBufferSize=e.data.audioBufferSize,this.start=e.data.start,this.channels=e.data.channels,this.state=0,this.offset=0,this.samplesArray=[]):"stop"===e.data.message?(this.state=0,this.start=!1,this.offset=0,this.samplesArray=[]):"data"===e.data.message?this.samplesArray.push(e.data.buffer):"zero"===e.data.message&&this.samplesArray.push({left:new Float32Array(this.audioBufferSize).fill(0),right:new Float32Array(this.audioBufferSize).fill(0)})}}process(e,t,s){const i=t[0][0],r=t[0][1];if(0===this.offset&&this.port.postMessage({message:"beep"}),0===this.state)this.state=1;else if(1===this.state&&this.samplesArray.length>=4)this.state=2;else if(2===this.state){const e=this.samplesArray[0];for(let t=0;t<i.length;t++)1===this.channels?i[t]=e.left[t+this.offset]:2===this.channels&&(i[t]=e.left[t+this.offset],r&&(r[t]=e.right[t+this.offset]))}else 1===this.channels?i.fill(0):2===this.channels&&(i.fill(0),r&&r.fill(0));return this.offset+=128,this.offset===this.audioBufferSize&&(this.offset=0,2===this.state&&this.samplesArray.shift(),0===this.samplesArray.length&&(this.state=0)),this.start}}registerProcessor("worklet-processor",e)}));this.workletUrl=e,this.audioContext.audioWorklet.addModule(e).then((()=>{if(this.player.isDestroyedOrClosed())return void this.player.debugLog("AudioContext","initWorkletScriptNode() player is destroyed");if(!this.audioContext)return void this.player.debugWarn("AudioContext","initWorkletScriptNode audioContext is null");let e=[1];2===this.audioInfo.channels&&(e=[1,1]);try{this.workletProcessorNode=new AudioWorkletNode(this.audioContext,"worklet-processor",{numberOfOutputs:this.audioInfo.channels,outputChannelCount:e})}catch(e){this.player.debugError("AudioContext","initWorkletScriptNode error",e),this.workletProcessorNode=null,this.tierDownToProcessScript()}this.workletProcessorNode&&(this.workletProcessorNode.connect(this.gainNode),this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0,this.workletProcessorNode.port.postMessage({message:"init",audioBufferSize:this.audioBufferSize,start:!0,channels:this.audioInfo.channels}),this.workletProcessorNode.port.onmessage=e=>{this.workletProcessorNode?this.audioContext?this.handleScriptNodeCallback(this.workletProcessorNode,null,!0):this.workletProcessorNode.port.postMessage({message:"zero"}):this.player.debugError("AudioContext","workletProcessorNode is null")})})),this.clearWorkletUrlTimeout=setTimeout((()=>{URL.revokeObjectURL(this.workletUrl),this.workletUrl=null,this.clearWorkletUrlTimeout=null}),_)}tierDownToProcessScript(){this.player.debugLog("AudioContext","tierDownToProcessScript"),this.engineType=de,this.audioBufferSize=this.getAudioBufferSizeByType(),this.initProcessScriptNode(),this.audioElementPlay()}handleScriptNodeCallback(e,t){let s,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t||ke;let r=e.length;i&&(s=e,r=this.audioBufferSize);const o=this.audioInfo.channels;if(this.playing&&this.isMoreThanMinBufferDuration()){if(this.player._opt,this.player.openSyncAudioAndVideo()&&Oe(this.player.visibility)){this.calcPlaybackRateBySync();const r=this.player.getAudioSyncVideoDiff();if(r>this.player._opt.syncAudioAndVideoDiff){const A=this.player.getCurrentVideoAndAudio();return this.player.debugWarn("AudioContext",`audioSyncVideoOption more than diff :${r},\n                    and video is ${A.video} ,\n                    and audio is ${A.audio} , waiting and bufferList is ${this.bufferList.length}, fill zero`),i?s.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),void t()}}let A=this._provide(r);if(0===A.size)return xe(this.player.isPlaybackOnlyDecodeIFrame())&&this.player.debugWarn("AudioContext",`bufferList size is ${this.bufferList.length} outputBufferLength is ${r},and bufferItem.size is 0, fill zero`),i?s.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),void t();A&&A.ts&&(this.player.audioTimestamp=A.ts),i?s.port.postMessage({message:"data",buffer:A}):this.fillScriptNodeOutputBuffer(e,o,A),t()}else 0===this.bufferList.length&&this.playing&&xe(this.isMute)&&xe(this.player.isPlaybackOnlyDecodeIFrame())&&this.player.debugWarn("AudioContext",`bufferList size is 0 and outputBufferLength is ${r}, fill zero`),i?s.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),t()}fillScriptNodeOutputBuffer(e,t,s){if(1===t){const t=e.getChannelData(0);s?0===s.size?t.fill(0):t.set(s.left):t.fill(0)}else if(2===t){const t=e.getChannelData(0),i=e.getChannelData(1);s?0===s.size?(t.fill(0),i.fill(0)):(t.set(s.left),i.set(s.right)):(t.fill(0),i.fill(0))}}play(e,t){this.isMute||(this.hasInitScriptNode?(this.hasAudio=!0,this.player.latestAudioTimestamp=t,this.bufferList.push({buffer:e,ts:t}),xe(this.player.openSyncAudioAndVideo())&&this.calcPlaybackRateByBuffer()):this.player.debugWarn("AudioContext","play has not init script node"))}calcPlaybackRateBySync(){if(this.isMute)return;if(!this.playing)return;const e=Math.floor(2e3/this.oneBufferDuration);if(this.bufferList.length>e)return this.player.debugWarn("AudioContext",`bufferList length ${this.bufferList.length} more than ${e}, and drop`),void this.clear();const t=this.player.getAudioSyncVideoDiff();if(this.getEngineType()===ce){if(t<-this.player._opt.syncAudioAndVideoDiff){this.player.debugWarn("AudioContext",`engine active , audioSyncVideoOption ${-this.player._opt.syncAudioAndVideoDiff} less than diff :${t},\n                 and bufferlist is ${this.bufferList.length}`);const e=this.player.getRenderCurrentPts();for(;this.bufferList.length>0;){const t=this.bufferList[0],s=t.ts-e;if(s>-this.player._opt.syncAudioAndVideoDiff/2){this.player.audioTimestamp=t.ts,this.player.debugLog("AudioContext",`engine active , audioSyncVideoOption\n                        item.ts is ${t.ts} and currentVideoTimestamp is ${e}, diff is ${s} > -${this.player._opt.syncAudioAndVideoDiff/2} and end`);break}this.bufferList.shift(),this.player.audioTimestamp=t.ts}}}else{let e=this.playbackRate;t<-this.player._opt.syncAudioAndVideoDiff?e===this.defaultPlaybackRate&&(this.player.debugLog("AudioContext",`audioSyncVideoOption ${-this.player._opt.syncAudioAndVideoDiff} less than diff :${t},\n                 speed up, playbackRate is ${e},\n                 and bufferList is ${this.bufferList.length}`),e=this.defaultPlaybackRate+.2):t>-this.player._opt.syncAudioAndVideoDiff/2&&e!==this.defaultPlaybackRate&&(this.player.debugLog("AudioContext",`diff is ${t} > -${this.player._opt.syncAudioAndVideoDiff/2} and speed to 1`),e=this.defaultPlaybackRate),this.updatePlaybackRate(e)}}calcPlaybackRateByBuffer(){if(this.isMute)return;if(!this.playing)return;let e=this.playbackRate,t=1e3,s=5e3;this.isAudioPlayer&&(t=this.player._opt.videoBufferDelay,s=this.player._opt.videoBufferMax);const i=Math.floor(t/this.oneBufferDuration),r=Math.floor(s/this.oneBufferDuration);if(this.bufferList.length>r)return this.player.debugWarn("AudioContext",`bufferList length ${this.bufferList.length} more than ${r}, and drop`),void this.clear();this.getEngineType()!==ce&&(this.bufferList.length>i?(e=this.defaultPlaybackRate+.2,this.player.debugLog("AudioContext",`bufferList length ${this.bufferList.length} more than ${i}, speed up, playbackRate is ${e}`)):this.bufferList.length<i/2&&(e=this.defaultPlaybackRate),this.updatePlaybackRate(e))}updatePlaybackRate(e){this.rateProcessor&&(this.playbackRate=e,this.rateProcessor.setRate(this.playbackRate))}_provide(e){return(1===this.playbackRate?this.processor:this.rateProcessor).provide(e)}}class pt extends t{constructor(e){super(),this.player=e,this.$video=e.video.$videoElement,this.init=!1,this.player._opt.hlsUseCanvasRender&&(this.$video=this.player.hlsDecoder.$videoElement),this.player._opt.webrtcUseCanvasRender&&(this.$video=this.player.webrtc.$videoElement),this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""},this._prevVolume=null,this.player.debugLog("Audio","init")}async destroy(){return this.resetInit(),this.off(),this._prevVolume=null,this.player.debugLog("Audio","destroy"),!0}resetInit(){this.init=!1,this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""}}getAudioInfo(){return this.audioInfo}updateAudioInfo(e){e.encTypeCode&&(this.audioInfo.encTypeCode=e.encTypeCode,this.audioInfo.encType=ae[e.encTypeCode]),e.encType&&(this.audioInfo.encType=e.encType),e.channels&&(this.audioInfo.channels=e.channels),e.sampleRate&&(this.audioInfo.sampleRate=e.sampleRate),e.depth&&(this.audioInfo.depth=e.depth),this.audioInfo.sampleRate&&this.audioInfo.channels&&this.audioInfo.encType&&!this.init&&(this.player.debugLog("Audio","audioInfo",JSON.stringify(this.audioInfo)),this.player.emit(ee.audioInfo,this.audioInfo),this.init=!0)}get isPlaying(){return!0}get volume(){return Oe(this.$video.muted)?0:this.$video.volume}get isMute(){return 0===this.$video.volume||Oe(this.$video.muted)}mute(e){this.setVolume(e?0:this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e),isNaN(e)||(this.$video.muted&&(this.$video.muted=!1),e=Ce(e,0,1),Te()&&(this.$video.muted=0===e),this.player.isAliyunRtc()&&this.player.aliyunRtcDecoder&&this.player.aliyunRtcDecoder.aliyunRtcRemoteStream&&(this.player.aliyunRtcDecoder.aliyunRtcRemoteStream.muted=0===e),null!==this._prevVolume&&this._prevVolume===e||(null===this._prevVolume?this.player.emit(ee.mute,0===e):0===this._prevVolume&&e>0?this.player.emit(ee.mute,!1):this._prevVolume>0&&0===e&&this.player.emit(ee.mute,!0),this.$video.volume=e,this.player.emit(ee.volumechange,this.player.volume),this.player.emit(ee.volume,this.player.volume),this._prevVolume=e))}clear(){}play(e,t){const s=this.player.video.awriter;if(s)if(e.close)try{s.write(e),Me(e)}catch(e){this.player.debugError("Video","play audio error",e)}else try{const i=function(e,t){const s={...t,format:"f32-planar",data:new Float32Array(0)};if(s.numberOfFrames=e[0].length,1===e.length)s.data=new Float32Array(e[0]);else if(2===e.length){const t=new Float32Array(e[0].length+e[1].length);t.set(e[0],0),t.set(e[1],e[0].length),s.data=t}return new AudioData(s)}(e,{sampleRate:48e3,numberOfChannels:this.audioInfo.channels,timestamp:1e3*t});s.write(i),Me(i)}catch(e){this.player.debugError("Video","play audio error",e)}else this.player.debugWarn("Audio","play and this.awriter is null")}pause(){}resume(){}getEngineType(){return"audio"}isPlaybackRateSpeed(){return!1}setRate(){}initScriptNode(){}initScriptNodeDelay(){}audioEnabled(){this.mute(!1)}getAudioBufferSize(){return 2048}}class gt extends ct{constructor(e){super(e),this.delayTimeout=null,this.TAG_NAME=this.player.isPlayback()?"AudioPlaybackLoader":"AudioPlayVodLoader",this.player.isPlayback()?this.player.on(ee.playbackPause,(e=>{this.listenPlaybackPause(e)})):this.player.isPlayVod()&&this.player.on(ee.playVodPause,(e=>{this.listenPlayVodPause(e)})),this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null),await super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}listenPlaybackPause(e){e?(this.pause(),this.player.isPlayback()&&this.player.playback.isPlaybackPauseClearCache&&this.clear()):this.resume()}initScriptNodeDelay(){const e=this.player._opt.playbackDelayTime;e>0?this.delayTimeout=setTimeout((()=>{this.initScriptNode()}),e):this.initScriptNode()}setRate(e){e!==this.defaultPlaybackRate&&this.rateProcessor&&(this.player.debugLog(this.TAG_NAME,"setRate",e),this.defaultPlaybackRate=e,this.updatePlaybackRate(e))}}class mt extends ct{constructor(e){super(e),this.TAG_NAME="AudioPlayerLoader",this.isAudioPlayer=!0,this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return await super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}play(e,t){xe(this.playing)||super.play(e,t)}pause(){this.player.debugLog(this.TAG_NAME,"pause"),this.playing=!1,this.clear()}resume(){this.player.debugLog(this.TAG_NAME,"resume"),this.playing=!0}}class yt extends t{constructor(e){super(),this.TAG_NAME="AudioWebrtcPlayerLoader",this.$video=new Audio,this.player=e,this.init=!1,this._prevVolume=null,this.eventsDestroy=[],this._handleDocumentClickPlay=this._handleClickPlay.bind(this),this._initAudioEvents(),this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return this.resetInit(),this.off(),this.eventsDestroy.length&&(this.eventsDestroy.forEach((e=>e())),this.eventsDestroy=[]),this._prevVolume=null,this.$video&&(this.$video.pause(),this.$video.srcObject=null,this.$video=null),this.player.debugLog(this.TAG_NAME,"destroy"),!0}_initAudioEvents(){const{proxy:e}=this.player.events,t=e(this.$video,"timeupdate",(e=>{const t=parseInt(e.timeStamp,10);this.player.handleRender(),this.player.updateStats({ts:t})}));this.eventsDestroy.push(t)}resetInit(){this.init=!1}_handleClickPlay(){this.$video&&(this.$video.play(),document.removeEventListener("click",this._handleDocumentClickPlay))}bindStream(e){this.$video.srcObject=e,this.$video.volume=1,this.$video.play().catch((e=>{this.player.debugWarn(this.TAG_NAME,"audio play error",e),document.addEventListener("click",this._handleDocumentClickPlay)}))}getEngineType(){return"audio"}get isPlaying(){return!0}get volume(){return Oe(this.$video.muted)?0:this.$video.volume}get isMute(){return 0===this.$video.volume||Oe(this.$video.muted)}mute(e){this.setVolume(e?0:this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e),isNaN(e)||null===this.$video||(this.$video.muted&&(this.$video.muted=!1),e=Ce(e,0,1),Te()&&(this.$video.muted=0===e),null!==this._prevVolume&&this._prevVolume===e||(null===this._prevVolume?this.player.emit(ee.mute,0===e):0===this._prevVolume&&e>0?this.player.emit(ee.mute,!1):this._prevVolume>0&&0===e&&this.player.emit(ee.mute,!0),this.$video.volume=e,this.player.emit(ee.volumechange,this.player.volume),this.player.emit(ee.volume,this.player.volume),this._prevVolume=e))}pause(){}resume(){}audioEnabled(){this.mute(!1)}}class ft{constructor(e){return new(ft.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){return e.playType===b||e.playType===w?e.useMSE&&e.mseDecodeAudio?pt:gt:e.playType===f?e.isWebrtc?yt:mt:e.isHls&&xe(e.supportHls265)||e.isWebrtc&&xe(e.isWebrtcH265)||e.useMSE&&e.mseDecodeAudio||e.isAliyunRtc||e.useWCS&&e.wcsDecodeAudio||e.useWasm&&e.wasmPlayAudioUseVideoRender?pt:ct}}const bt=()=>"wakeLock"in navigator&&-1===window.navigator.userAgent.indexOf("Samsung")&&xe(Te());class wt{constructor(e){this.player=e,this.enabled=!1,bt()?(this.player.debugLog("NoSleep","Native Wake Lock API supported."),this._wakeLock=null,this.handleVisibilityChange=()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable()},document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange)):(this.player.debugLog("NoSleep","Native Wake Lock API not supported. so use video element."),this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm","data:video/webm;base64,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ggOtgPj//qOHggPBgPj//qOHggPVgPj//qOHggPpgPj//qOegQPvANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCA/2A+P/+o4eCBBGA+P/+o4eCBCWA+P/+o4eCBDmA+P/+o4eCBE2A+P/+o56BBFMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IEiID4//6jh4IEnID4//6jh4IEsID4//6jnoEEtwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggTEgPj//qOHggTYgPj//qOHggTsgPj//qOHggUAgPj//qOHggUUgPj//qOegQUbANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCBSiA+P/+o4eCBTyA+P/+o4eCBVCA+P/+o4eCBWSA+P/+o4eCBXiA+P/+o56BBX8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IFjID4//6jh4IFoID4//6jh4IFtID4//6jh4IFyID4//6jh4IF3ID4//6jnoEF4wDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggXwgPj//qOHggYEgPj//qOHggYYgPj//qOHggYsgPj//qOHggZAgPj//qOegQZHANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCBlSA+P/+o4eCBmiA+P/+o4eCBnyA+P/+o4eCBpCA+P/+o4eCBqSA+P/+o56BBqsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IGuID4//6jh4IGzID4//6jh4IG4ID4//6jh4IG9ID4//6jh4IHCID4//6jnoEHDwDRAgAFEBAUYABhYL/QACIAEM1+tck+ccwAAKOHggccgPj//qOHggcwgPj//qOHggdEgPj//qOHggdYgPj//qOHggdsgPj//qOegQdzANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCB4CA+P/+o4eCB5SA+P/+o4eCB6iA+P/+o4eCB7yA+P/+o4eCB9CA+P/+o56BB9cA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IH5ID4//6jh4IH+ID4//6jh4IIDID4//6jh4IIIID4//6jh4IINID4//6jnoEIOwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgghIgPj//qOHgghcgPj//qOHgghwgPj//qOHggiEgPj//qOegQifANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCMCA+P/+o4eCCNSA+P/+o4eCCOiA+P/+o4eCCPyA+P/+o56BCQMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IJEID4//6jh4IJJID4//6jh4IJOID4//6jh4IJTID4//6jh4IJYID4//6jnoEJZwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggl0gPj//qOHggmIgPj//qOHggmcgPj//qOHggmwgPj//qOHggnEgPj//qOegQnLANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCdiA+P/+o4eCCeyA+P/+o4eCCgCA+P/+o4eCChSA+P/+o4eCCiiA+P/+o56BCi8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IKPID4//6jh4IKUID4//6jh4IKZID4//6jh4IKeID4//6jh4IKjID4//6jnoEKkwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggqggPj//qOHggq0gPj//qOHggrIgPj//qOHggrcgPj//qOHggrwgPj//qOegQr3ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCwSA+P/+o4eCCxiA+P/+o4eCCyyA+P/+o4eCC0CA+P/+o4eCC1SA+P/+o56BC1sA0QIABRAQFGAAYWC/0AAiABDNfrXJPnHMAACjh4ILaID4//6jh4ILfID4//6jh4ILkID4//6jh4ILpID4//6jh4ILuID4//6jnoELvwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggvMgPj//qOHggvggPj//qOHggv0gPj//qOHggwIgPj//qOHggwcgPj//qOegQwjANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDDCA+P/+o4eCDESA+P/+o4eCDFiA+P/+o4eCDGyA+P/+o4eCDICA+P/+o56BDIcA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IMlID4//6jh4IMqID4//6jh4IMvID4//6jh4IM0ID4//6jnoEM6wDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg0MgPj//qOHgg0ggPj//qOHgg00gPj//qOHgg1IgPj//qOegQ1PANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDVyA+P/+o4eCDXCA+P/+o4eCDYSA+P/+o4eCDZiA+P/+o4eCDayA+P/+o56BDbMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4INwID4//6jh4IN1ID4//6jh4IN6ID4//6jh4IN/ID4//6jh4IOEID4//6jnoEOFwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg4kgPj//qOHgg44gPj//qOHgg5MgPj//qOHgg5ggPj//qOHgg50gPj//qOegQ57ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDoiA+P/+o4eCDpyA+P/+o4eCDrCA+P/+o4eCDsSA+P/+o4eCDtiA+P/+o56BDt8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IO7ID4//6jh4IPAID4//6jh4IPFID4//6jh4IPKID4//6jh4IPPID4//6jnoEPQwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg9QgPj//qOHgg9kgPj//qOHgg94gPj//qOHgg+MgPj//qOHgg+ggPj//qOegQ+nANECAAUQEBRgAGFgv9AAIgAQzX61yT5xzAAAo4eCD7SA+P/+o4eCD8iA+P/+o4eCD9yA+P/+o4eCD/CA+P/+o4eCEASA+P/+o56BEAsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IQGID4//6jh4IQLID4//6jh4IQQID4//6jh4IQVID4//6jh4IQaID4//6jnoEQbwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghB8gPj//qOHghCQgPj//qOHghCkgPj//qOHghC4gPj//qOHghDMgPj//qOegRDTANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEOCA+P/+o4eCEPSA+P/+o4eCEQiA+P/+o56BETcA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IRQ4D4//6jh4IRV4D4//6jh4IRa4D4//6jh4IRf4D4//6jh4IRk4D4//6jnoERmwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghGngPj//qOHghG7gPj//qOHghHPgPj//qOHghHjgPj//qOHghH3gPj//qOegRH/ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEguA+P/+o4eCEh+A+P/+o4eCEjOA+P/+o4eCEkeA+P/+o4eCEluA+P/+o56BEmMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4ISb4D4//6jh4ISg4D4//6jh4ISl4D4//6jh4ISq4D4//6jh4ISv4D4//6jnoESxwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghLTgPj//qOHghLngPj//qOHghL7gPj//qOHghMPgPj//qOHghMjgPj//qOegRMrANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEzeA+P/+o4eCE0uA+P/+o4eCE1+A+P/+o4eCE3OA+P/+oAEAAAAAAAAPoYeCE4cA+P/+daKDB/KBHFO7a5G7j7OBB7eK94EB8YIDX/CBDA=="),this._addSourceToVideo(this.noSleepVideo,"mp4","data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACORtZGF03gIATGF2YzU4LjM1LjEwMAACMEAOAAACcQYF//9t3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2MSByMzAyNyA0MTIxMjc3IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTAgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTcgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0wIHdlaWdodHA9MCBrZXlpbnQ9MjUwIGtleWludF9taW49MTAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAADvZYiED/JigADD7JycnJycnJycnJycnJycnJycnJ11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111114BGCAHARggBwEYIAcBGCAHARggBwAAAAdBmjgf4BLYARggBwEYIAcBGCAHARggBwAAAAdBmlQH+AS2ARggBwEYIAcBGCAHARggBwAAAAdBmmA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZqAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZrAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0Ga4D/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbAD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbID/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBm0A/wCWwARggBwEYIAcBGCAHAAAAB0GbYD/AJbABGCAHARggBwEYIAcAAAAHQZuAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GboD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbwD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0Gb4D/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBmgA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmiA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmkA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZpgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqgP8AlsAEYIAcBGCAHARggBwAAAAdBmsA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmuA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmwA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZsgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtgP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GbgD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GboD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbwD/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdB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"),Object.assign(this.noSleepVideo.style,{position:"absolute",left:"-100%",top:"-100%"}),document.querySelector("body").append(this.noSleepVideo),this.handleNoSleepVideoTimeUpdate=()=>{this.noSleepVideo&&this.noSleepVideo.currentTime>4&&(this.noSleepVideo.currentTime=1)},this.noSleepVideo.addEventListener("timeupdate",this.handleNoSleepVideoTimeUpdate))}destroy(){if(this._wakeLock&&(this._wakeLock.release(),this._wakeLock=null),this.noSleepVideo){this.handleNoSleepVideoTimeUpdate&&this.noSleepVideo.removeEventListener("timeupdate",this.handleNoSleepVideoTimeUpdate);try{this.noSleepVideo.parentNode&&this.noSleepVideo.parentNode.removeChild(this.noSleepVideo)}catch(e){this.player.debugWarn("NoSleep","Failed to remove noSleepVideo element.")}this.noSleepVideo=null}this.handleVisibilityChange&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange))}_addSourceToVideo(e,t,s){var i=document.createElement("source");i.src=s,i.type=`video/${t}`,e.appendChild(i)}get isEnabled(){return this.enabled}enable(){if(bt())return navigator.wakeLock.request("screen").then((e=>{this._wakeLock=e,this.enabled=!0,this.player.debugLog("wakeLock","Wake Lock active."),this._wakeLock.addEventListener("release",(()=>{this.player.debugLog("wakeLock","Wake Lock released.")}))})).catch((e=>{throw this.enabled=!1,this.player.debugWarn("wakeLock",`${e.name}, ${e.message}`),e}));return this.noSleepVideo.play().then((e=>(this.player.debugLog("wakeLock","noSleepVideo Wake Lock active."),this.enabled=!0,e))).catch((e=>{throw this.player.debugWarn("wakeLock",`noSleepVideo ${e.name}, ${e.message}`),this.enabled=!1,e}))}disable(){bt()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):this.noSleepVideo&&this.noSleepVideo.pause(),this.enabled=!1,this.player.debugLog("wakeLock","Disabling wake lock.")}}class kt{constructor(e){this.player=e,this.TAG_NAME="decoderAudioWorker",this.destroyResolve=null,this.workerClearTimeout=null,this.workerUrl=null;let t=this.player._opt.decoder;if(this.decoderWorkerCloseTimeout=null,0===t.indexOf("http")&&this.player._opt.isDecoderUseCDN){const e=new Blob([`importScripts("${t}")`],{type:"application/javascript"});t=window.URL.createObjectURL(e),this.workerUrl=t,this.workerClearTimeout=setTimeout((()=>{window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null,this.workerClearTimeout=null}),_)}this.decoderWorker=new Worker(t),this._initDecoderWorker(),e.debugLog(this.TAG_NAME,`init and decoder url is ${t}`)}destroy(){return new Promise(((e,t)=>{this.player.loaded?(this.player.debugLog(this.TAG_NAME,"has loaded and post message to destroy"),this.decoderWorker?(this.decoderWorker.postMessage({cmd:N}),this.destroyResolve=e,this.decoderWorkerCloseTimeout=setTimeout((()=>{this.player.debugWarn(this.TAG_NAME,"send close but not response and destroy directly"),this._destroy(),setTimeout((()=>{e()}),0)}),2e3)):(this.player.debugWarn(this.TAG_NAME,"has loaded but decoderWorker is null and destroy directly"),this._destroy(),setTimeout((()=>{e()}),0))):(this.player.debugLog(this.TAG_NAME,"has not loaded and destroy directly"),this._destroy(),setTimeout((()=>{e()}),0))}))}_destroy(){this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this.workerUrl&&(window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.workerClearTimeout&&(clearTimeout(this.workerClearTimeout),this.workerClearTimeout=null),this.decoderWorker&&(this.decoderWorker.terminate(),this.decoderWorker.onerror=null,this.decoderWorker.onmessageerror=null,this.decoderWorker.onmessage=null,this.decoderWorker=null),this.player.debugLog(this.TAG_NAME,"destroy"),this.destroyResolve&&(this.destroyResolve(),this.destroyResolve=null)}_initDecoderWorker(){this.player,this.decoderWorker.onerror=e=>{const t=e.filename||"",s=e.message||"",i=t&&(-1!==t.indexOf(".wasm")||-1!==t.indexOf("wasm://"));i&&-1!==s.indexOf(fe)?this.player.debugLog("decoderWorker",`onerror and ignore filename: ${t},message: ${s}`,e):(this.player.debugError("decoderWorker",`onerror filename: ${t},message: ${s}`,e),i?this.player.emitError(se.decoderWorkerWasmError,`filename: ${t},message: ${s}`):this.player.emitError(se.decoderWorkerInitError,`filename: ${t},message: ${s}`))},this.decoderWorker.onmessageerror=e=>{this.player.debugError(this.TAG_NAME,"onmessageerror",e)},this.decoderWorker.onmessage=e=>{const t=e.data;switch(t.cmd){case T:this.player.debugLog(this.TAG_NAME,"onmessage:",T),this.decoderWorker&&this._initWork(),this.player.loaded||this.player.emit(ee.load),this.player.emit(ee.decoderWorkerInit);break;case R:this.player.debugLog(this.TAG_NAME,"onmessage:",R,t.code),this.player.audio&&this.player.audio.updateAudioInfo({encTypeCode:t.code});break;case I:if(this.player.debugLog(this.TAG_NAME,"onmessage:",I,`channels:${t.channels},sampleRate:${t.sampleRate}`),t.channels>2)return this.player.emit(ee.error,se.audioChannelError),void this.player.emit(se.audioChannelError,`audio channel is ${t.channels}, max is 2`);this.player.audio&&(this.player.audio.updateAudioInfo(t),this.player.audio.initScriptNode());break;case v:if(!this.player.audio)return void this.player.debugWarn(this.TAG_NAME,"onmessage playAudio but audio is null");this.player.handleRender(),this.player.updateStats({ts:t.ts,buf:t.delay}),this.player.audio.play(t.buffer,t.ts);break;case P:t.type===ee.streamSuccess?this.player.stream?this.player.stream.emit(ee.streamSuccess):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response stream success but stream is null"):t.type===ee.streamRate?this.player.emit(ee.kBps,(t.value/1024).toFixed(2)):t.type===ee.streamEnd?this.player?(t.value===u&&this.player.emit(ee.websocketClose,t.msg),this.player.stream?this.player.stream.emit(ee.streamEnd,t.msg):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response stream end but player.stream is null")):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response stream end but player is null"):t.type===se.websocketError?(this.player&&this.player.stream?this.player.stream.emit(se.websocketError,t.value):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response websocket error but stream is null"),this.player&&this.player.emit(ee.error,se.websocketError)):t.type===se.fetchError?(this.player&&this.player.stream?this.player.stream.emit(se.fetchError,t.value):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response fetch error but stream is null"),this.player&&this.player.emit(ee.error,se.fetchError)):t.type===ee.streamAbps&&this.player.updateStats({abps:t.value});break;case L:this.player.debugLog(this.TAG_NAME,"onmessage:",L),this.player.destroy(),console.error("Jb pro 体验结束,请刷新页面再次体验(wasm内部会暂停解码)，如需要购买商业授权，可以联系微信：bosswancheng"),alert("Jb pro 体验结束,请刷新页面再次体验，如需要购买商业授权，可以联系微信：bosswancheng"),window.location.reload();break;case W:this.player.debugLog(this.TAG_NAME,"onmessage:",W),this._destroy();break;default:this.player.debugWarn(this.TAG_NAME,"onmessage:",`unknown msg.cmd:${t.cmd}`)}}}_initWork(){const e={debug:this.player._opt.debug,debugLevel:this.player._opt.debugLevel,sampleRate:this.player.audio&&this.player.audio.audioContext&&this.player.audio.audioContext.sampleRate||0,audioBufferSize:this.player.audio&&this.player.audio.getAudioBufferSize()||1024,videoBuffer:this.player._opt.videoBuffer,isChrome:Pe()};this.decoderWorker.postMessage({cmd:M,opt:JSON.stringify(e)})}updateWorkConfig(e){this.decoderWorker&&this.decoderWorker.postMessage({cmd:D,key:e.key,value:e.value})}workerFetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{_opt:s}=this.player;let i=[];t.protocols&&(i=t.protocols,delete t.protocols);const r={protocol:s.protocol,isFlv:s.isFlv,isG711a:s.isG711a,isG711u:s.isG711u};this.decoderWorker.postMessage({cmd:G,url:e,protocols:i,opt:JSON.stringify(r)})}workerSendMessage(e){this.decoderWorker.postMessage({cmd:O,message:e})}}var Et,Ct="application/json, text/javascript",St="text/html",Bt=/^(?:text|application)\/xml/i,_t=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Tt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,vt=/^\s*$/,It={},Rt={},Pt="",Lt={type:"GET",beforeSend:Wt,success:Wt,error:Wt,complete:Wt,context:null,xhr:function(){return new window.XMLHttpRequest},accepts:{json:Ct,xml:"application/xml, text/xml",html:St,text:"text/plain","*":"*/".concat("*")},crossDomain:!1,timeout:0,username:null,password:null,processData:!0,promise:Wt,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};function Wt(){}var Mt=function(e,t){"object"==typeof e&&(t=e,e=void 0);var s=jt({},t=t||{});for(var i in Lt)void 0===s[i]&&(s[i]=Lt[i]);try{var r={},o=new Promise((function(e,t){r.resolve=e,r.reject=t}));o.resolve=r.resolve,o.reject=r.reject,s.promise=o}catch(e){s.promise={resolve:Wt,reject:Wt}}var A=Tt.exec(window.location.href.toLowerCase())||[];s.url=((e||s.url||window.location.href)+"").replace(/#.*$/,"").replace(/^\/\//,A[1]+"//");var a=s.url;s.crossDomain||(s.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(s.url)&&RegExp.$2!==window.location.href);var n=s.dataType;if("jsonp"===n){if(!/=\?/.test(s.url)){var h=(s.jsonp||"callback")+"=?";s.url=xt(s.url,h)}return function(e){var t,s=e.jsonpCallback||"jsonp"+Ut(),i=window.document.createElement("script"),r={abort:function(){s in window&&(window[s]=Wt)}},o=window.document.getElementsByTagName("head")[0]||window.document.documentElement;function A(s){window.clearTimeout(t),r.abort(),Gt(s.type,r,s.type,e),a()}i.onerror=function(e){A(e)},window[s]=function(s){window.clearTimeout(t),Nt(s,r,e),a()},Qt(e),i.src=e.url.replace(/=\?/,"="+s),i.src=xt(i.src,"_="+(new Date).getTime()),i.async=!0,e.scriptCharset&&(i.charset=e.scriptCharset);o.insertBefore(i,o.firstChild),e.timeout>0&&(t=window.setTimeout((function(){r.abort(),Gt("timeout",r,"timeout",e),a()}),e.timeout));function a(){i.clearAttributes?i.clearAttributes():i.onload=i.onreadystatechange=i.onerror=null,i.parentNode&&i.parentNode.removeChild(i),i=null,delete window[s]}return e.promise.abort=function(){r.abort()},e.promise.xhr=r,e.promise}(s)}Qt(s);var l=s.accepts[n]||s.accepts["*"],u={};/^([\w-]+:)\/\//.test(s.url)?RegExp.$1:window.location.protocol;var d,c=Lt.xhr();s.crossDomain||u["X-Requested-With"]||(u["X-Requested-With"]="XMLHttpRequest"),s.ifModified&&(It[a]&&(u["If-Modified-Since"]=It[a]),Rt[a]&&(u["If-None-Match"]=Rt[a])),l&&(u.Accept=l,l.indexOf(",")>-1&&(l=l.split(",",2)[0]),c.overrideMimeType&&c.overrideMimeType(l));var p=!/^(?:GET|HEAD)$/.test(s.type.toUpperCase());if((s.data&&p&&!1!==s.contentType||t.contentType)&&(u["Content-Type"]=s.contentType),!1===s.cache&&!p){var g=/([?&])_=[^&]*/;s.url=g.test(a)?a.replace(g,"$1_="+Ut()):a+(/\?/.test(a)?"&":"?")+"_="+Ut()}s.headers=jt(u,s.headers||{}),c.onreadystatechange=function(){if(4===c.readyState){var e;clearTimeout(d);var t=!1;if(c.status>=200&&c.status<300||304===c.status){if(Pt=c.getAllResponseHeaders(),s.ifModified){var i=Ot("Last-Modified");i&&(It[a]=i),(i=Ot("etag"))&&(Rt[a]=i)}n=n||function(e){return e&&(e===St?"html":e===Ct?"json":Bt.test(e)&&"xml")||"text"}(c.getResponseHeader("content-type")),e=c.responseText;try{"xml"===n?e=c.responseXML:"json"===n&&(e=vt.test(e)?null:JSON.parse(e))}catch(e){t=e}t?Gt(t,"parseerror",c,s):Nt(e,c,s)}else Gt(null,"error",c,s)}};var m=!("async"in s)||s.async;if(c.open(s.type,s.url,m,s.username,s.password),s.xhrFields)for(var y in s.xhrFields)c[y]=s.xhrFields[y];for(var y in s.mimeType&&c.overrideMimeType&&c.overrideMimeType(s.mimeType),s.headers)void 0!==s.headers[y]&&c.setRequestHeader(y,s.headers[y]+"");return!1===function(e,t){var s=t.context;if(!1===t.beforeSend.call(s,e,t))return!1}(c,s)?(c.abort(),!1):(s.timeout>0&&(d=window.setTimeout((function(){c.onreadystatechange=Wt,c.abort(),Gt(null,"timeout",c,s)}),s.timeout)),c.send(s.data?s.data:null),s.promise.abort=function(){c.abort()},s.promise)};function Nt(e,t,s){var i=s.context,r="success";s.success.call(i,e,r,t),s.promise.resolve(e,r,t),Dt(r,t,s)}function Dt(e,t,s){var i=s.context;s.complete.call(i,t,e)}function Gt(e,t,s,i){var r=i.context;i.error.call(r,s,t,e),i.promise.reject(s,t,e),Dt(t,s,i)}function Ot(e){var t;if(!Et){for(Et={};t=_t.exec(Pt);)Et[t[1].toLowerCase()]=t[2];t=Et[e.toLowerCase()]}return null===t?null:t}function xt(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function Qt(e){!Ft(e)||e.data instanceof FormData||!e.processData||(e.data=function(e,t){var s=[];return s.add=function(e,t){this.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},Ht(s,e,t),s.join("&").replace("%20","+")}(e.data)),!e.data||e.type&&"GET"!==e.type.toUpperCase()||(e.url=xt(e.url,e.data))}function Ht(e,t,s,i){var r=function(e){return"[object Array]"===Object.prototype.toString.call(e)}(t);for(var o in t){var A=t[o];i&&(o=s?i:i+"["+(r?"":o)+"]"),!i&&r?e.add(A.name,A.value):(s?r(A):Ft(A))?Ht(e,A,s,o):e.add(o,A)}}function jt(e){for(var t=Array.prototype.slice,s=t.call(arguments,1),i=0,r=s.length;i<r;i++){var o=s[i]||{};for(var A in o)o.hasOwnProperty(A)&&void 0!==o[A]&&(e[A]=o[A])}return e}function Ft(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function Vt(e){return"function"==typeof e}function Ut(){return(new Date).getTime()}Mt.get=function(e,t,s,i){return Vt(t)&&(i=i||s,s=t,t=void 0),Mt({url:e,data:t,success:s,dataType:i})},Mt.post=function(e,t,s,i){return Vt(t)&&(i=i||s,s=t,t=void 0),Mt({type:"POST",url:e,data:t,success:s,dataType:i})},Mt.getJSON=function(e,t,s){return Vt(t)&&(s=t,t=void 0),Mt({url:e,data:t,success:s,dataType:"json"})},Mt.ajaxSetup=function(e,t){return t?jt(jt(e,Lt),t):jt(Lt,e)};class $t extends t{constructor(e){super(),this.player=e,this.TAG_NAME="CommonAudioWebrtc",this.rtcPeerConnection=null,this.rtcPeerConnectionDataChannel=null,this.videoStream=null,this.isDisconnected=!1,this.eventsDestroy=[],this.isInitInfo=!1,this.bandwidthEstimateInterval=null,this.rtcPeerTrackAudioReceiver=null,this.prevWebrtcAudioStats={},this.currentWebrtcStats={},this.isDestroyed=!1,this._initRtcPeerConnection()}destroy(){this.isDestroyed=!0,this.isDisconnected=!1,this.isInitInfo=!1,this.prevWebrtcVideoStats={},this.currentWebrtcStats={},this.rtcPeerTrackAudioReceiver=null,this._stopBandwidthEstimateInterval(),this.eventsDestroy.length&&(this.eventsDestroy.forEach((e=>e())),this.eventsDestroy=[]),this.videoStream&&(this.videoStream.getTracks().forEach((e=>{e.stop()})),this.videoStream=null),this.rtcPeerConnectionDataChannel&&(this.rtcPeerConnectionDataChannel.onopen=ke,this.rtcPeerConnectionDataChannel.onclose=ke,this.rtcPeerConnectionDataChannel.onmessage=ke,this.rtcPeerConnectionDataChannel.close(),this.rtcPeerConnectionDataChannel=null),this.rtcPeerConnection&&(this.rtcPeerConnection.onicecandidate=ke,this.rtcPeerConnection.ontrack=ke,this.rtcPeerConnection.onconnectionstatechange=ke,this.rtcPeerConnection.ondatachannel=ke,this.rtcPeerConnection.close(),this.rtcPeerConnection=null)}_initRtcPeerConnection(){const e=new RTCPeerConnection,t=this.player;e.addTransceiver("audio",{direction:"recvonly"}),e.onsignalingstatechange=e=>{this.player.debugLog(this.TAG_NAME,"onsignalingstatechange[本地端的信号状态]",e)},e.onicegatheringstatechange=t=>{this.player.debugLog(this.TAG_NAME,"onicegatheringstatechange[ICE收集状态]",t,e.iceGatheringState)},e.onnegotiationneeded=e=>{this.player.debugLog(this.TAG_NAME,"onnegotiationneeded[通信环境发生变化]",e)},e.oniceconnectionstatechange=s=>{this.player.debugLog(this.TAG_NAME,"oniceconnectionstatechange",e.iceConnectionState);const i=e.iceConnectionState;switch(this.player.emit(ee.webrtcOnIceConnectionStateChange,i),this.isDisconnected="disconnected"===i,e.iceConnectionState){case"new":break;case"checking":t.emit(ee.webrtcChecking);break;case"closed":case"closed":t.emit(ee.webrtcClosed);break;case"failed":t.emit(ee.webrtcFailed);break;case"disconnected":t.emit(ee.webrtcDisconnect);break;case"connected":t.emit(ee.webrtcConnected);break;case"completed":t.emit(ee.webrtcCompleted)}},e.onicecandidate=e=>{this.player.debugLog(this.TAG_NAME,"onicecandidate",e),e.candidate&&this.player.debugLog(this.TAG_NAME,"Remote ICE candidate: ",e.candidate.candidate)},e.ontrack=t=>{if(this.player.debugLog(this.TAG_NAME,"ontrack",t),"video"===t.track.kind);else if("audio"===t.track.kind){this.player.debugLog(this.TAG_NAME,"ontrack audio"),this.rtcPeerTrackAudioReceiver=e.getReceivers().find((function(e){return e.track===t.track})),this.rtcPeerTrackAudioReceiver&&this._startBandwidthEstimateInterval();let s=t.streams[0];this.videoStream=s,this.player.audio.bindStream(s)}},e.onicecandidateerror=e=>{this.player.debugLog(this.TAG_NAME,"onicecandidateerrorr[candidate错误]",e),this.player.emitError(se.webrtcIceCandidateError,e)},e.onconnectionstatechange=s=>{switch(this.player.debugLog(this.TAG_NAME,"onconnectionstatechange[所有ICE 状态总览]",s),this.player.emit(ee.webrtcOnConnectionStateChange,e.connectionState),e.connectionState){case"new":case"connecting":case"connected":case"disconnected":break;case"failed":this.isDisconnected&&t.emit(ee.webrtcFailed)}},this.rtcPeerConnection=e}_startBandwidthEstimateInterval(){this.player.debugLog(this.TAG_NAME,"_startBandwidthEstimateInterval"),this._stopBandwidthEstimateInterval(),this.bandwidthEstimateInterval=setInterval((()=>{this.rtcPeerTrackAudioReceiver&&this.rtcPeerTrackAudioReceiver.getStats().then((e=>{let t=0;const s={};e.forEach((e=>{if(e&&e.type===be){this.currentWebrtcStats.lastTimeStamp=e.timestamp;const i=((e.timestamp||0)-(this.prevWebrtcAudioStats.timestamp||0))/1e3,r=Number(e.bytesReceived||0)-Number(this.prevWebrtcAudioStats.bytesReceived||0),o=Math.floor(r/i);t+=o,s.abps=o,this.prevWebrtcAudioStats=e}})),this.player.updateStats(s),this.player.emit(ee.kBps,(t/1024).toFixed(2))}))}),1e3)}_stopBandwidthEstimateInterval(){this.player.debugLog(this.TAG_NAME,"_stopBandwidthEstimateInterval"),this.bandwidthEstimateInterval&&(clearInterval(this.bandwidthEstimateInterval),this.bandwidthEstimateInterval=null)}async loadSource(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=this.rtcPeerConnection;try{const i=await s.createOffer();await s.setLocalDescription(i);const r=await this.getWebRtcRemoteSdpByPost(e,i.sdp,t);await s.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:r}))}catch(e){return this.player.debugError(this.TAG_NAME,`loadSource error ${e.toString()}`,e),{code:400,message:"getWebRtcRemoteSdp response error:"+e.toString()}}return!0}async getWebRtcRemoteSdpByPost(e,t,s){return!0}}class Yt extends $t{constructor(e){super(e),this.TAG_NAME="WebRTCForZlmAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,s){const i=await function(e,t){return Mt({url:e,type:"POST",data:t,contentType:"text/plain;charset=utf-8",processData:!1,dataType:"json"})}(e,t);if(0!==i.code)throw new Error(i.msg);if(i.sdp)return i.sdp;throw new Error("sdp is null")}}class zt extends $t{constructor(e){super(e),this.TAG_NAME="WebRTCForOtherAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,s){const i=await function(e,t){return fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/sdp"},body:t})}(e,t),r=await i.text();try{let e=JSON.parse(r);if(this.player.debugLog(this.TAG_NAME,"this is json sdp response"),0!=e.code)throw this.player.debugError(this.TAG_NAME,`response json code ${e.code}`),new Error(`response sdp json code: ${e.code}`);return e.sdp}catch(e){this.player.debugLog(this.TAG_NAME,"this is raw sdp response")}return r}}class qt extends $t{constructor(e){super(e),this.TAG_NAME="WebRTCForM7sAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,s){const i=await function(e,t,s){let i={"Content-Type":"application/sdp"};return s.username&&s.password&&(i.Authorization="Basic "+btoa(s.username+":"+s.password)),fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:i,body:t})}(e,t,s);return await i.text()}}class Jt extends $t{constructor(e){super(e),this.TAG_NAME="WebRTCForSRSAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,s){const i=await function(e,t){return fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/sdp"},body:t})}(e,t);if(0!==i.code)throw new Error(i.msg);if(i)return i;throw new Error("sdp is null")}}class Zt extends t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._opt={},this.TAG_NAME="AudioPlayer";const t=Ge();this._opt=Object.assign({},t,e),this.debug=new we(this),this.debugLog(this.TAG_NAME,"init and version is",_e),this._loading=!1,this._playing=!1,this._hasLoaded=!1,this._destroyed=!1,this._closed=!1,this._checkHeartTimeout=null,this._checkLoadingTimeout=null,this._checkStatsInterval=null,this._startBpsTime=null,this._stats={abps:0,ts:0,buf:0,audioBufferTs:0},this._audioTimestamp=0,this.stream=null,this._lastVolume=null,this._historyAbpsList=[],this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},this._tempWorkerStats=null,/(iphone|ipad|ipod|ios|android)/i.test(window.navigator.userAgent.toLowerCase())&&xe(this._opt.supportLockScreenPlayAudio&&Te())&&(this.keepScreenOn=new wt(this)),je(this),this.stream=null,this.webrtc=null,this.events=new He(this),this.decoderWorker=null,this.audio=null;try{this.debugLog(this.TAG_NAME,"_opt",JSON.stringify(this._opt))}catch(e){this.debugLog(this.TAG_NAME,"_opt",this._opt)}}async destroy(){this._destroyed=!0,this.emit("destroy"),this.off(),this.events&&(this.events.destroy(),this.events=null),this.clearCheckHeartTimeout(),this.clearCheckLoadingTimeout(),this.clearStatsInterval(),this.decoderWorker&&(await this.decoderWorker.destroy(),this.decoderWorker=null),await this._destroy()}async _destroy(){this._loading=!1,this._playing=!1,this._hasLoaded=!1,this._destroyed=!1,this._checkHeartTimeout=null,this._checkLoadingTimeout=null,this._checkStatsInterval=null,this._resetStats(),this._audioTimestamp=0,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},this._tempWorkerStats=null,this.audio&&(await this.audio.destroy(),this.audio=null),this.webrtc&&(await this.webrtc.destroy(),this.webrtc=null),this.stream&&(await this.stream.destroy(),this.stream=null),this.debugLog(this.TAG_NAME,"destroy end"),this._opt=Ge()}_resetStats(){this._startBpsTime=null,this._playingStartTimestamp=null,this._historyAbpsList=[],this._stats={abps:0,ts:0,buf:0,audioBufferTs:0}}set loaded(e){this._hasLoaded=e}get loaded(){return this._hasLoaded}set playing(e){e&&(this.loading=!1),this.playing!==e&&(this._playing=e,this.emit(ee.playing,e),this.emit(ee.volumechange,this.volume),e?this.emit(ee.play):this.emit(ee.pause))}get playing(){return this._playing}get volume(){return this.audio&&this.audio.volume||0}set volume(e){e!==this.volume&&(this.audio?(this.audio.setVolume(e),this._lastVolume=this.volume):this.debugWarn(this.TAG_NAME,"set volume error, audio is null"))}get lastVolume(){return this._lastVolume}set loading(e){this.loading!==e&&(this._loading=e,this.emit(ee.loading,this._loading))}get loading(){return this._loading}set audioTimestamp(e){null!==e&&(this._audioTimestamp=e)}get audioTimestamp(){return this._audioTimestamp}get isDebug(){return Oe(this._opt.debug)}isDestroyed(){return this._destroyed}updateOption(e){this._opt=Object.assign({},this._opt,e)}init(){return new Promise(((e,t)=>{this.audio||(this.audio=new ft(this)),this.stream||(this.stream=new Ke(this)),this.isWebrtc()?(this.webrtc||(this._opt.isWebrtcForZLM?this.webrtc=new Yt(this):this._opt.isWebrtcForSRS?this.webrtc=new Jt(this):this._opt.isWebrtcForOthers?this.webrtc=new zt(this):this.webrtc=new qt(this),this.loaded=!0),e()):this.decoderWorker?this.loaded?e():this.once(ee.decoderWorkerInit,(()=>{this.loaded=!0,e()})):(this.decoderWorker=new kt(this),this.once(ee.decoderWorkerInit,(()=>{this.loaded=!0,e()})))}))}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((s,i)=>{if(!e&&!this._opt.url)return i("url is empty");this.loading=!0,this.playing=!1,this._closed=!1,this._times.playInitStart=Ee(),e||(e=this._opt.url),this._opt.url=e,this.clearCheckHeartTimeout(),this.init().then((()=>{this._times.playStart=Ee(),this._opt.isNotMute&&this.mute(!1),this.checkLoadingTimeout(),this.stream&&(this.stream.once(se.fetchError,(e=>{this.emitError(se.fetchError,e)})),this.stream.once(se.websocketError,(e=>{this.emitError(se.websocketError,e)})),this.stream.once(ee.streamEnd,(e=>{this.emit(ee.streamEnd,e)})),this.stream.once(ee.streamSuccess,(()=>{s(),this._times.streamResponse=Ee(),this.checkStatsInterval(),this.debugLog(this.TAG_NAME,"stream success and start play")})),this.stream.fetchStream(e,t))})).catch((()=>{i()}))}))}checkLoadingTimeout(){this._checkLoadingTimeout=setTimeout((()=>{this.playing?this.debugWarn(this.TAG_NAME,`checkLoadingTimeout but loading is ${this.loading} and playing is ${this.playing}`):this.isDestroyed()?this.debug&&this.debugWarn(this.TAG_NAME,"checkLoadingTimeout but player is destroyed"):(this.debugWarn(this.TAG_NAME,"checkLoadingTimeout and pause and emit loadingTimeout event"),this.emit(ee.timeout,ee.loadingTimeout),this.emit(ee.loadingTimeout))}),1e3*this._opt.loadingTimeout)}clearCheckLoadingTimeout(){this._checkLoadingTimeout&&(this.debugLog(this.TAG_NAME,"clearCheckLoadingTimeout"),clearTimeout(this._checkLoadingTimeout),this._checkLoadingTimeout=null)}checkStatsInterval(){this.debugLog(this.TAG_NAME,"checkStatsInterval"),this._checkStatsInterval=setInterval((()=>{this.updateStats()}),1e3)}clearCheckHeartTimeout(){this.debugLog(this.TAG_NAME,"clearCheckHeartTimeout"),this._checkHeartTimeout&&(clearTimeout(this._checkHeartTimeout),this._checkHeartTimeout=null)}clearStatsInterval(){this.debugLog(this.TAG_NAME,"clearStatsInterval"),this._checkStatsInterval&&(clearInterval(this._checkStatsInterval),this._checkStatsInterval=null)}updateStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._startBpsTime||(this._startBpsTime=Ee()),Ie(e.ts)&&(this._stats.ts=e.ts,null===this._playingStartTimestamp&&e.ts>0&&(this._playingStartTimestamp=e.ts)),Ie(e.buf)&&(this._stats.buf=e.buf);const t=Ee(),s=t-this._startBpsTime;if(e.abps&&(this._stats.abps+=e.abps),s<1e3)return;let i=0,r=0;this.audio&&this.audio.bufferList&&(i=this.audio.bufferList.length,r=i*this.audio.oneBufferDuration),this._stats.audioBufferTs=parseInt(r,10),this.emit(ee.stats,this._stats),this.emit(ee.timeUpdate,this._stats.ts),this.updateHistoryAbpsList(this._stats.abps),this._stats.abps=0,this._startBpsTime=t}enableWakeLock(){this._opt.keepScreenOn&&this.keepScreenOn&&this.keepScreenOn.enable()}releaseWakeLock(){this._opt.keepScreenOn&&this.keepScreenOn&&this.keepScreenOn.disable()}pause(){return new Promise(((e,t)=>{this._closed=!0;const s=()=>{this.stream&&(this.stream.destroy(),this.stream=null),this.off(),this.clearCheckHeartTimeout(),this.clearCheckLoadingTimeout(),this.clearStatsInterval(),this.releaseWakeLock(),this._resetStats(),this.loading=!1,this.playing=!1,this.audio&&this.audio.pause(),this._audioTimestamp=0,this._hasLoaded=!1,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},je(this)};this.decoderWorker?this.decoderWorker.destroy().then((()=>{this.decoderWorker=null,s(),e()})).catch((e=>{this.debugError(this.TAG_NAME,"pause() decoderWorker destroy error",e),t(e)})):(s(),setTimeout((()=>{e()}),0))}))}handleRender(){this.isDestroyed()?this.debug&&this.debugWarn("player","handleRender but player is destroyed"):(this.loading&&(this.clearCheckLoadingTimeout(),this.emit(ee.start),this.loading=!1),this.playing||(this.playing=!0))}updateHistoryAbpsList(e){this._historyAbpsList.length>this._opt.heartTimeout&&this._historyAbpsList.shift(),this._historyAbpsList.push(e),this.isHistoryAbpsListAllZero()&&this.checkHeartTimeout$2()}isHistoryAbpsListAllZero(){let e=!0;if(this._historyAbpsList.length<this._opt.heartTimeout&&(e=!1),e)for(let t=0;t<this._historyAbpsList.length;t++)if(this._historyAbpsList[t]>0){e=!1;break}return e}checkHeartTimeout$2(){if(this.playing){if(this.isDestroyed())return void(this.debug&&this.debugWarn("player","checkHeartTimeout$2 but player is destroyed"));if(xe(this.isHistoryAbpsListAllZero()))return void(this.debug&&this.debugWarn("player","checkHeartTimeout$2 but fps is not all zero"));if(xe(this.visibility)&&0!==this._stats.abps)return void(this.debug&&this.debugWarn("player",`checkHeartTimeout$2 but page is not visibility and vbps is ${this._stats.vbps}`));const e=this._historyAbpsList.join(",");this.debugWarn("player",`checkHeartTimeout$2 and\n                pause and emit delayTimeout event and\n                current abps is ${this._stats.abps} and\n                history abpsList is ${e} and\n                current visibility is ${this.visibility} and`),this.emit(ee.timeout,ee.delayTimeout),this.emit(ee.delayTimeout)}else this.debugLog("player",`checkHeartTimeout$2()  playing is ${this.playing}`)}getOption(){return this._opt}getDemuxType(){let e="";return e=this.getOption().demuxType,e}getAudioEngineType(){let e="";return this.audio&&(e=this.audio.getEngineType()),e}mute(e){this.audio&&this.audio.mute(e)}isAudioMute(){let e=!0;return this.audio&&(e=this.audio.isMute),e}isAudioNotMute(){return!this.isAudioMute()}getPlayType(){return this._opt.playType}emitError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.emit(e,t),this.emit(ee.error,e,t)}openSyncAudioAndVideo(){return!1}isDestroyedOrClosed(){return this.isDestroyed()||this.isClosed()}isClosed(){return this._closed}isWebrtc(){return Oe(this._opt.isWebrtc)}isWebrtcForM7S(){return xe(this._opt.isWebrtcForZLM)&&xe(this._opt.isWebrtcForSRS)&&xe(this._opt.isWebrtcForOthers)}debugLog(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.debug.log(e,...s)}}debugWarn(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.debug.warn(e,...s)}}debugError(e){if(this.debug){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.debug.error(e,...s)}}}class Xt extends t{constructor(e){super(),this.player=e,this.TAG_NAME="Network",this.online=this.isOnline(),this.prevOnline=this.online,this.interval=null,this._initListener(),this.player.debugLog(this.TAG_NAME,"init")}destroy(){this.off(),this._stopCheck(),window.removeEventListener("online",this._updateOnlineStatus),window.removeEventListener("offline",this._updateOfflineStatus),this.player.debugLog(this.TAG_NAME,"destroy")}_initListener(){window.addEventListener("online",this._updateOnlineStatus.bind(this)),window.addEventListener("offline",this._updateOfflineStatus.bind(this))}_stopCheck(){this.interval&&(clearInterval(this.interval),this.interval=null)}_startCheck(){this.interval=setInterval((()=>{this.isOnline()!==this.prevOnline&&(this.isOnline()?this._updateOnlineStatus():this._updateOfflineStatus())}),1e3)}_updateOnlineStatus(){this.prevOnline=this.online,this.online=!0,this.logStatus(),this.emit("online")}_updateOfflineStatus(){this.prevOnline=this.online,this.online=!1,this.logStatus(),this.emit("offline")}logStatus(){const e=this.prevOnline?"online":"offline",t=this.online?"online":"offline";this.player.debugLog(this.TAG_NAME,`prevOnline: ${this.prevOnline}, online: ${this.online}, status: ${e} -> ${t}`)}isOnline(){return void 0===navigator.onLine||navigator.onLine}isOffline(){return!this.isOnline()}}class Kt extends t{constructor(e){super(),this._opt={},this.TAG_NAME="JbProAudio",Object.keys(e).forEach((t=>{if(void 0===e[t])throw new Error(`JbPro option "${t}" can not be undefined`)}));const t=Ge();let s=Object.assign({},t,e);Ie(s.videoBuffer)&&(s.videoBuffer=1e3*Number(s.videoBuffer)),Ie(s.videoBufferDelay)&&(s.videoBufferDelay=1e3*Number(s.videoBufferDelay)),Ie(s.videoBufferMax)&&(s.videoBufferMax=1e3*Number(s.videoBufferMax)),Ie(s.timeout)&&(ve(s.loadingTimeout)&&(s.loadingTimeout=s.timeout),ve(s.heartTimeout)&&(s.heartTimeout=s.timeout)),this._opt=s,this._destroyed=!1,this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0,this._isNetworkOfflinePaused=!1,this._isNetworkOfflinePausedAndNextPlayConfig={},this._streamErrorReplayTimes=0,this.debug=new we(this),this.events=new He(this),this.network=new Xt(this),this._initAudioPlayer(),this._initNetwork(),this.debugLog(this.TAG_NAME,'init success and version is "9-13-2024"'),console.log('JbProAudio version is "9-13-2024"')}destroy(){return new Promise(((e,t)=>{this.debugLog(this.TAG_NAME,"destroy()"),this._destroyed=!0,this.off(),this.player?this.player.destroy().then((()=>{this.player=null,this._destroy(),e()})).catch((()=>{t()})):(this._destroy(),e())}))}_destroy(){this.events&&(this.events.destroy(),this.events=null),this.debugLog("JbPro","destroy end"),this._resetOpt(),this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0,this._isNetworkOfflinePaused=!1,this._isNetworkOfflinePausedAndNextPlayConfig={},this._streamErrorReplayTimes=0}_initAudioPlayer(){this.player=new Zt(this._opt),this.debugLog(this.TAG_NAME,"_initPlayer",this.player.getOption()),this._bindEvents()}_initNetwork(){this.network.on(ee.online,(()=>{if(this.emit(ee.networkState,ee.online),this.isDestroyed())this.debugLog(this.TAG_NAME,"network online but player is destroyed");else if(this._isNetworkOfflinePaused&&this._isNetworkOfflinePausedAndNextPlayConfig&&this._isNetworkOfflinePausedAndNextPlayConfig.url){const e=this._isNetworkOfflinePausedAndNextPlayConfig.url;this._streamErrorReplayTimes++;const t=this._isNetworkOfflinePausedAndNextPlayConfig.type||"unknown";this._isNetworkOfflinePaused=!1,this._isNetworkOfflinePausedAndNextPlayConfig={},this.debugLog(this.TAG_NAME,`${t} and network online and _streamErrorReplayTimes is ${this._streamErrorReplayTimes} and reset player and play`),this.play(e).then((()=>{this.debugLog(this.TAG_NAME,`${t} and network online and play success`)})).catch((e=>{this.emit(ee.playFailedAndPaused,se.fetchError,{},e),this.debugError(this.TAG_NAME,`${t} and network online and play error`,e.toString(),e)}))}})),this.network.on(ee.offline,(()=>{this.emit(ee.networkState,ee.offline)}))}_resetOpt(){this._opt=Ge()}_bindEvents(){Object.keys(te).forEach((e=>{this.player.on(te[e],(t=>{this.emit(e,t)}))}))}_play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return new Promise(((r,A)=>{const a=e.split("?")[0],h=a.startsWith("http://")||a.startsWith("https://"),l=a.startsWith("ws://")||a.startsWith("wss://"),u=a.startsWith("webrtc://"),d=h||l,c=-1!==e.indexOf(".flv"),p=d&&(a.endsWith(".g711a")||a.endsWith(".g711u")),g=p&&a.endsWith(".g711a"),m=p&&a.endsWith(".g711u");let y=this._opt.isWebrtcForZLM||!1,f=this._opt.isWebrtcForSRS||!1,b=this._opt.isWebrtcForOthers||!1;u&&(-1!==e.indexOf("/index/api/webrtc")?(y=!0,f=!1,b=!1):-1!==e.indexOf("/rtc/v1/play/")&&(f=!0,y=!1,b=!1));let w=null,S=null;if(h?w=i:u?w=o:l&&(w=s),c&&!this._opt.isFlv?this._opt.isFlv=!0:!p||this._opt.isG711a||this._opt.isG711u||(this._opt.isG711a=g,this._opt.isG711u=m),this._opt.isFlv?S=k:u?S=C:l&&(S=E),!w||!S)return A(`play protocol is ${w}, demuxType is ${S}`);this.debugLog(this.TAG_NAME,`play protocol is ${n[w]}, demuxType is ${S}`);const B=()=>{this.player.once(se.fetchError,this._handleFetchError.bind(this)),this.player.once(ee.streamEnd,this._handleStreamEnd.bind(this)),this.player.once(se.websocketError,this._handleWebsocketError.bind(this)),this.player.once(se.decoderWorkerInitError,this._handleDecoderWorkerInitError.bind(this)),this.player.once(se.decoderWorkerWasmError,this._handleDecoderWorkerWasmError.bind(this)),this.player.on(ee.delayTimeout,this._handleDelayTimeout.bind(this)),this.player.on(ee.loadingTimeout,this._handleLoadingTimeout.bind(this)),this.player.play(e,t).then((()=>{r()})).catch((e=>{this.debugError(this.TAG_NAME,"hasLoaded and play error",e),this.emit(ee.crashLog,this._getCrashLog("hasLoaded and play error",e)),this.player.pause().then((()=>{A(e)})).catch((e=>{this.debugError(this.TAG_NAME,"hasLoaded and play error and next pause error",e)}))}))};u&&xe(this._opt.isWebrtcH265)?this._resetPlayer({protocol:w,demuxType:S,isWebrtc:u,isWebrtcForZLM:y,isWebrtcForSRS:f,isWebrtcForOthers:b}).then((()=>{B()})).catch((e=>{A("reset player error",e)})):(this.player.updateOption({protocol:w,demuxType:S,isFlv:this._opt.isFlv,isWebrtc:u}),B())}))}isDestroyed(){return this._destroyed}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((s,i)=>{if(this.isDestroyed())return i("JbPro is destroyed");if(!this.player)return i("player is null");try{this.debugLog(this.TAG_NAME,`play() ${e}`,JSON.stringify(t))}catch(s){this.debugLog(this.TAG_NAME,`play() ${e}`,t)}if(!e&&!this._opt.url)return this.emit(ee.error,se.playError),void i("url is null and this._opt.url is null");if(e){if(e=(""+e).trim(),-1===e.indexOf("http:")&&-1===e.indexOf("https:")&&-1===e.indexOf("webrtc:")&&-1===e.indexOf("ws:")&&-1===e.indexOf("wss:"))return i(`url ${e} must be "http:" or "https:" or "webrtc:" or "ws:" or "wss：" protocol`);this._opt.url=e}this.player.playing||this.player.loading?(this.debugWarn(this.TAG_NAME,`play() and player is playing ${this.player.playing} or loading ${this.player.loading} and pause to play`),this.player.pause().then((()=>{this._play(this._opt.url).then((()=>{s()})).catch((e=>{i(e)}))}))):this._play(this._opt.url,t).then((()=>{s()})).catch((e=>{i(e)}))}))}mute(){this.debugLog(this.TAG_NAME,"mute()"),this.player&&this.player.mute(!0)}cancelMute(){this.debugLog(this.TAG_NAME,"cancelMute()"),this.player&&this.player.mute(!1)}pause(){return new Promise(((e,t)=>{this.debugLog(this.TAG_NAME,"pause()"),this.player?this.player.pause().then((t=>{this._bindEvents(),e(t)})).catch((e=>{t(e)})):t("player is null")}))}setVolume(e){this.debugLog(this.TAG_NAME,`setVolume() ${e}`),this.player&&(this.player.volume=e)}getVolume(){let e=null;return this.player&&(e=this.player.volume,e=parseFloat(e).toFixed(2)),e}setTimeout(e){this.debugLog(this.TAG_NAME,`setTimeout() ${e}`),e=Number(e),this.player&&this.player.updateOption({timeout:e,loadingTimeout:e,heartTimeout:e})}audioResume(){this.debugLog(this.TAG_NAME,"audioResume()"),this.player&&this.player.audio?this.player.audio.audioEnabled(!0):this.debugWarn(this.TAG_NAME,"audioResume() player is not init")}setDebug(e){this.debugLog(this.TAG_NAME,`setDebug() ${e}`),this.player?this.player.updateOption({debug:!!e}):this.debugWarn(this.TAG_NAME,"setDebug() player is not init")}_getCrashLog(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.player)return;const s=this.player;let i={url:this._opt.url,playType:f,demuxType:s.getDemuxType(),audioInfo:{encType:"",sampleRate:"",channels:""},audioEngine:s.getAudioEngineType(),timestamp:Ee(),type:e,error:De(t)||e};if(s.audio){const e=s.audio.audioInfo||{};i.audioInfo={encType:e.encType||"",sampleRate:e.sampleRate||"",channels:e.channels||""}}return i}_isNeedNetworkDisconnectReplay(){return this._opt.networkDisconnectReplay&&this.network.isOffline()}_handleFetchError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleFetchError but player is destroyed"):(this.emit(ee.crashLog,this._getCrashLog(se.fetchError,e)),this.debugLog(this.TAG_NAME,"fetch error and reset player"),this.pause().then((()=>{if(this._isNeedNetworkDisconnectReplay())return this.debugLog(this.TAG_NAME,"fetch error and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:_url,type:se.fetchError});this.emit(ee.playFailedAndPaused,se.fetchError)})).catch((e=>{this.debugError(this.TAG_NAME,"fetch error and pause",e)})))}_handleStreamEnd(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleStreamEnd but player is destroyed"):(this.emit(ee.crashLog,this._getCrashLog(ee.streamEnd,e)),this.debugLog(this.TAG_NAME,"streamEnd and reset player"),this.pause().then((()=>{if(this._isNeedNetworkDisconnectReplay())return this.debugLog(this.TAG_NAME,"stream End and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:_url,type:ee.streamEnd});this.emit(ee.playFailedAndPaused,ee.streamEnd)})).catch((e=>{this.emit(ee.playFailedAndPaused,se.streamEnd),this.debugError(this.TAG_NAME,"streamEnd and pause",e)})))}_handleWebsocketError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleWebsocketError but player is destroyed"):(this.emit(ee.crashLog,this._getCrashLog(se.websocketError,e)),this.debugLog(this.TAG_NAME,"websocketError and reset player"),this.pause().then((()=>{if(this._isNeedNetworkDisconnectReplay())return this.debugLog(this.TAG_NAME,"websocket Error and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:_url,type:se.websocketError});this.emit(ee.playFailedAndPaused,se.websocketError)})).catch((e=>{this.emit(ee.playFailedAndPaused,se.websocketError),this.debugError(this.TAG_NAME,"websocketError and pause",e)})))}_handleDecoderWorkerInitError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleDecoderWorkerInitError but player is destroyed"):(this.emit(ee.crashLog,this.getCrashLog(se.decoderWorkerInitError,e)),this.debugLog(this.TAG_NAME,"decoderWorkerInitError and pause player"),this._pause().then((()=>{this.emit(ee.playFailedAndPaused,se.decoderWorkerInitError)})).catch((e=>{this.emit(ee.playFailedAndPaused,se.decoderWorkerInitError),this.debugError(this.TAG_NAME,"decoderWorkerInitError and pause",e)})))}_handleDecoderWorkerWasmError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleDecoderWorkerWasmError but player is destroyed"):(this.emit(ee.crashLog,this.getCrashLog(se.decoderWorkerWasmError,e)),this.debugLog(this.TAG_NAME,"decoderWorkerWasmError and pause player"),this._pause().then((()=>{this.emit(ee.playFailedAndPaused,se.decoderWorkerWasmError)})).catch((e=>{this.emit(ee.playFailedAndPaused,se.decoderWorkerWasmError),this.debugError(this.TAG_NAME,"decoderWorkerWasmError and pause",e)})))}_handleDelayTimeout(e){this.emit(ee.crashLog,this._getCrashLog(ee.delayTimeout,e)),this.isDestroyed()?this.debugLog(this.TAG_NAME,"delay timeout but player is destroyed"):this.pause().then((()=>{if(this.player&&this.player._opt.heartTimeoutReplay&&(this._heartTimeoutReplayTimes<this.player._opt.heartTimeoutReplayTimes||-1===this.player._opt.heartTimeoutReplayTimes)){if(this.debugLog(this.TAG_NAME,`delay timeout and\n                        replay time is ${this._heartTimeoutReplayTimes} and\n                        heartTimeoutReplayTimes is ${this.player._opt.heartTimeoutReplayTimes}`),this.isDestroyed())return void this.debugWarn(this.TAG_NAME,"delay timeout replay but player is destroyed");this._heartTimeoutReplayTimes+=1;const e=this._opt.url;if(this._isNeedNetworkDisconnectReplay())return this.debugLog("JbPro","delayTimeout and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:e,type:ee.delayTimeout});this.play(e).then((()=>{})).catch((e=>{this.debugError(this.TAG_NAME,"delay timeout replay error",e)}))}else this.emit(ee.playFailedAndPaused,ee.delayTimeout),this.emit(ee.delayTimeoutRetryEnd),this.debugWarn(this.TAG_NAME,`delayTimeoutRetryEnd and\n                            opt.heartTimeout is ${this.player&&this.player._opt.heartTimeout} and\n                            opt.heartTimeoutReplay is ${this.player&&this.player._opt.heartTimeoutReplay} and\n                            opt.heartTimeoutReplayTimes is ${this.player&&this.player._opt.heartTimeoutReplayTimes},and\n                            local._heartTimeoutReplayTimes is ${this._heartTimeoutReplayTimes}`)})).catch((e=>{this.emit(ee.playFailedAndPaused,ee.delayTimeout),this.debugError(this.TAG_NAME,"delay timeout and pause error",e)}))}_handleLoadingTimeout(t){this.emit(ee.crashLog,this._getCrashLog(ee.loadingTimeout,t)),this.isDestroyed()?this.debugLog(this.TAG_NAME,"loading timeout but player is destroyed"):this.pause().then((()=>{if(this.player&&this.player._opt.loadingTimeoutReplay&&(this._loadingTimeoutReplayTimes<this.player._opt.loadingTimeoutReplayTimes||-1===this.player._opt.loadingTimeoutReplayTimes)){if(this.debugLog(this.TAG_NAME,`loading timeout and\n                             replay time is ${this._loadingTimeoutReplayTimes} and\n                             loadingTimeoutReplayTimes is ${this.player._opt.loadingTimeoutReplayTimes}`),this.isDestroyed())return void this.debugWarn(this.TAG_NAME,"loading timeout replay but player is destroyed");this._loadingTimeoutReplayTimes+=1;const t=this._opt.url;if(this._isNeedNetworkDisconnectReplay())return this.debugLog("JbPro","loadingTimeout and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:t,type:ee.loadingTimeout});this.play(t).then((()=>{})).catch((()=>{this.debugError(this.TAG_NAME,"loading timeout replay error",e)}))}else this.emit(ee.loadingTimeoutRetryEnd),this.emit(ee.playFailedAndPaused,ee.loadingTimeoutRetryEnd)})).catch((e=>{this.emit(ee.playFailedAndPaused,ee.loadingTimeoutRetryEnd),this.debugError(this.TAG_NAME,"loading timeout and pause error",e)}))}debugLog(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.debug.log(e,...s)}}debugWarn(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.debug.warn(e,...s)}}debugError(e){if(this.debug){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.debug.error(e,...s)}}}return window.JessibucaProAudio=Kt,window.JbProAudio=Kt,window.WebPlayerProAudio=Kt,Kt}));
