!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["jessibuca-audio-demo"]=t()}(this,(function(){"use strict";class t{on(e,t,i){const s=this.e||(this.e={});return(s[e]||(s[e]=[])).push({fn:t,ctx:i}),this}once(e,t,i){const s=this;function r(){s.off(e,r);for(var o=arguments.length,A=new Array(o),a=0;a<o;a++)A[a]=arguments[a];t.apply(i,A)}return r._=t,this.on(e,r,i)}emit(e){const t=((this.e||(this.e={}))[e]||[]).slice();for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];for(let e=0;e<t.length;e+=1)t[e].fn.apply(t[e].ctx,s);return this}off(e,t){const i=this.e||(this.e={});if(!e)return Object.keys(i).forEach((e=>{delete i[e]})),void delete this.e;const s=i[e],r=[];if(s&&t)for(let e=0,i=s.length;e<i;e+=1)s[e].fn!==t&&s[e].fn._!==t&&r.push(s[e]);return r.length?i[e]=r:delete i[e],this}}const i=1,s=2,r=3,o=4,A=5,a=6,n=["","websocket","fetch","hls","webrtc","webTransport","aliyunRtc","ts"],h="fetch",l="hls",u="websocket",d="webrtc",c="webTransport",p="worker",g="aliyunRtc",m="player",y="playerAudio",f="playbackTF",b="flv",w="m7s",E="webrtc",C="debug",k="warn",B=1e4,S="init",_="playAudio",v="initAudio",T="audioCode",I="workerFetch",R="workerEnd",P="closeEnd",L="init",N="close",W="updateConfig",D="fetchStream",M="sendWsMessage",G="fetch",O="destroy",x="destroyEnd",Q="buffer",H="fetchError",j="fetchClose",F="fetchSuccess",Y={fullscreen:"fullscreen$2",webFullscreen:"webFullscreen",decoderWorkerInit:"decoderWorkerInit",play:"play",playing:"playing",pause:"pause",mute:"mute",load:"load",loading:"loading",zooming:"zooming",videoInfo:"videoInfo",timeUpdate:"timeUpdate",audioInfo:"audioInfo",log:"log",error:"error",kBps:"kBps",timeout:"timeout",delayTimeout:"delayTimeout",delayTimeoutRetryEnd:"delayTimeoutRetryEnd",loadingTimeout:"loadingTimeout",loadingTimeoutRetryEnd:"loadingTimeoutRetryEnd",stats:"stats",performance:"performance",videoSmooth:"videoSmooth",faceDetectActive:"faceDetectActive",objectDetectActive:"objectDetectActive",occlusionDetectActive:"occlusionDetectActive",imageDetectActive:"imageDetectActive",record:"record",recording:"recording",recordingTimestamp:"recordingTimestamp",recordStart:"recordStart",recordEnd:"recordEnd",recordCreateError:"recordCreateError",recordBlob:"recordBlob",recordCancel:"recordCancel",buffer:"buffer",videoFrame:"videoFrame",videoSEI:"videoSEI",start:"start",metadata:"metadata",resize:"resize",volumechange:"volumechange",volume:"volume",destroy:"destroy",beforeDestroy:"beforeDestroy",streamEnd:"streamEnd",streamRate:"streamRate",streamAbps:"streamAbps",streamVbps:"streamVbps",streamDts:"streamDts",streamSuccess:"streamSuccess",streamMessage:"streamMessage",streamError:"streamError",streamStats:"streamStats",mseSourceOpen:"mseSourceOpen",mseSourceClose:"mseSourceClose",mseSourceended:"mseSourceended",mseSourceStartStreaming:"mseSourceStartStreaming",mseSourceEndStreaming:"mseSourceEndStreaming",mseSourceBufferError:"mseSourceBufferError",mseAddSourceBufferError:"mseAddSourceBufferError",mseWorkerAddSourceBufferError:"mseWorkerAddSourceBufferError",mseSourceBufferBusy:"mseSourceBufferBusy",mseSourceBufferFull:"mseSourceBufferFull",videoWaiting:"videoWaiting",videoTimeUpdate:"videoTimeUpdate",videoSyncAudio:"videoSyncAudio",playToRenderTimes:"playToRenderTimes",playbackTime:"playbackTime",playbackTimestamp:"playbackTimestamp",playbackTimeScroll:"playbackTimeScroll",playbackPrecision:"playbackPrecision",playbackShowPrecisionChange:"playbackShowPrecisionChange",playbackJustTime:"playbackJustTime",playbackStats:"playbackStats",playbackSeek:"playbackSeek",playbackPause:"playbackPause",playbackPauseOrResume:"playbackPauseOrResume",playbackRateChange:"playbackRateChange",playbackPreRateChange:"playbackPreRateChange",ptz:"ptz",streamQualityChange:"streamQualityChange",visibilityChange:"visibilityChange",netBuf:"netBuf",close:"close",networkDelayTimeout:"networkDelayTimeout",togglePerformancePanel:"togglePerformancePanel",viewResizeChange:"viewResizeChange",flvDemuxBufferSizeTooLarge:"flvDemuxBufferSizeTooLarge",talkGetUserMediaSuccess:"talkGetUserMediaSuccess",talkGetUserMediaFail:"talkGetUserMediaFail",talkGetUserMediaTimeout:"talkGetUserMediaTimeout",talkStreamStart:"talkStreamStart",talkStreamOpen:"talkStreamOpen",talkStreamClose:"talkStreamClose",talkStreamError:"talkStreamError",talkStreamInactive:"talkStreamInactive",talkStreamMsg:"talkStreamMsg",webrtcDisconnect:"webrtcDisconnect",webrtcFailed:"webrtcFailed",webrtcClosed:"webrtcClosed",webrtcChecking:"webrtcChecking",webrtcConnected:"webrtcConnected",webrtcCompleted:"webrtcCompleted",webrtcOnConnectionStateChange:"webrtcOnConnectionStateChange",webrtcOnIceConnectionStateChange:"webrtcOnIceConnectionStateChange",crashLog:"crashLog",focus:"focus",blur:"blur",inView:"inView",visibilityHiddenTimeout:"visibilityHiddenTimeout",websocketOpen:"websocketOpen",websocketClose:"websocketClose",websocketError:"websocketError",websocketMessage:"websocketMessage",aiObjectDetectorInfo:"aiObjectDetectorInfo",aiFaceDetectorInfo:"aiFaceDetectorInfo",aiOcclusionDetectResult:"aiOcclusionDetectResult",aiImageDetectResult:"aiImageDetectResult",playFailedAndPaused:"playFailedAndPaused",audioResumeState:"audioResumeState",webrtcStreamH265:"webrtcStreamH265",flvMetaData:"flvMetaData",talkFailedAndStop:"talkFailedAndStop",removeLoadingBgImage:"removeLoadingBgImage",memoryLog:"memoryLog",downloadMemoryLog:"downloadMemoryLog",pressureObserverCpu:"pressureObserverCpu",currentPts:"currentPts",online:"online",offline:"offline",networkState:"networkState"},$={load:Y.load,timeUpdate:Y.timeUpdate,audioInfo:Y.audioInfo,error:Y.error,kBps:Y.kBps,start:Y.start,timeout:Y.timeout,loadingTimeout:Y.loadingTimeout,loadingTimeoutRetryEnd:Y.loadingTimeoutRetryEnd,delayTimeout:Y.delayTimeout,delayTimeoutRetryEnd:Y.delayTimeoutRetryEnd,play:Y.play,pause:Y.pause,mute:Y.mute,stats:Y.stats,playToRenderTimes:Y.playToRenderTimes,crashLog:Y.crashLog,websocketOpen:Y.websocketOpen,websocketClose:Y.websocketClose,playFailedAndPaused:Y.playFailedAndPaused,audioResumeState:Y.audioResumeState},z={playError:"playIsNotPauseOrUrlIsNull",fetchError:"fetchError",websocketError:"websocketError",webcodecsH265NotSupport:"webcodecsH265NotSupport",webcodecsDecodeError:"webcodecsDecodeError",webcodecsUnsupportedConfigurationError:"webcodecsUnsupportedConfigurationError",webcodecsDecodeConfigureError:"webcodecsDecodeConfigureError",webcodecsAudioInitTimeout:"webcodecsAudioInitTimeout",webcodecsAudioNoDataTimeout:"webcodecsAudioNoDataTimeout",mediaSourceH265NotSupport:"mediaSourceH265NotSupport",mediaSourceAudioG711NotSupport:"mediaSourceAudioG711NotSupport",mediaSourceAudioInitTimeout:"mediaSourceAudioInitTimeout",mediaSourceAudioNoDataTimeout:"mediaSourceAudioNoDataTimeout",mediaSourceDecoderConfigurationError:"mediaSourceDecoderConfigurationError",mediaSourceFull:Y.mseSourceBufferFull,mseSourceBufferError:Y.mseSourceBufferError,mseAddSourceBufferError:Y.mseAddSourceBufferError,mseWorkerAddSourceBufferError:Y.mseWorkerAddSourceBufferError,mediaSourceAppendBufferError:"mediaSourceAppendBufferError",mediaSourceTsIsMaxDiff:"mediaSourceTsIsMaxDiff",mediaSourceUseCanvasRenderPlayFailed:"mediaSourceUseCanvasRenderPlayFailed",mediaSourceBufferedIsZeroError:"mediaSourceBufferedIsZeroError",wasmDecodeError:"wasmDecodeError",wasmUseVideoRenderError:"wasmUseVideoRenderError",hlsError:"hlsError",webrtcError:"webrtcError",webrtcClosed:Y.webrtcClosed,webrtcIceCandidateError:"webrtcIceCandidateError",webglAlignmentError:"webglAlignmentError",wasmWidthOrHeightChange:"wasmWidthOrHeightChange",mseWidthOrHeightChange:"mseWidthOrHeightChange",wcsWidthOrHeightChange:"wcsWidthOrHeightChange",widthOrHeightChange:"widthOrHeightChange",tallWebsocketClosedByError:"tallWebsocketClosedByError",flvDemuxBufferSizeTooLarge:Y.flvDemuxBufferSizeTooLarge,audioChannelError:"audioChannelError",simdH264DecodeVideoWidthIsTooLarge:"simdH264DecodeVideoWidthIsTooLarge",simdDecodeError:"simdDecodeError",webglContextLostError:"webglContextLostError",videoElementPlayingFailed:"videoElementPlayingFailed",videoElementPlayingFailedForWebrtc:"videoElementPlayingFailedForWebrtc",decoderWorkerInitError:"decoderWorkerInitError",decoderWorkerWasmError:"decoderWorkerWasmError",videoInfoError:"videoInfoError",streamEnd:Y.streamEnd,websocket1006Error:"websocket1006Error",delayTimeout:Y.delayTimeout,loadingTimeout:Y.loadingTimeout,networkDelayTimeout:Y.networkDelayTimeout,aliyunRtcError:"aliyunRtcError",mseWaitVideoCanplayTimeout:"mseWaitVideoCanplayTimeout",initDecoderWorkerTimeout:"initDecoderWorkerTimeout",...{talkStreamError:Y.talkStreamError,talkStreamClose:Y.talkStreamClose}},U="notConnect",V="open",q="close",J="error",Z={10:"AAC",7:"ALAW",8:"MULAW",2:"MP3"},X="The user aborted a request",K="AbortError",ee="AbortError",te="worklet",ie="script",se="active",re={playType:y,timeout:10,loadingTimeout:10,heartTimeout:10,debug:!1,debugLevel:k,protocol:s,demuxType:b,isFlv:!1,isG711a:!1,isG711u:!1,isNotMute:!1,muted:!0,videoBuffer:1e3,videoBufferDelay:1e3,videoBufferMax:5e3,loadingTimeoutReplay:!0,heartTimeoutReplay:!0,loadingTimeoutReplayTimes:3,heartTimeoutReplayTimes:3,decoder:"decoder-pro-audio-player.js",isDecoderUseCDN:!1,weiXinInAndroidAudioBufferSize:4800,audioEngine:null,supportLockScreenPlayAudio:!0},oe="idle",Ae="buffering",ae="complete",ne="memory access out of bounds",he="inbound-rtp";class le{constructor(e){this.log=function(t){if(e._opt.debugLevel==C){const o=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"";for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];console.log(`JbPro${o}[✅✅✅][${t}]`,...s)}},this.warn=function(t){if(e._opt.debugLevel==C||e._opt.debugLevel==k){const o=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"";for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];console.log(`JbPro${o}[❗❗❗][${t}]`,...s)}},this.error=function(t){const i=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"";for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];console.error(`JbPro${i}[❌❌❌][${t}]`,...r)}}}function ue(){}function de(){return(new Date).getTime()}function ce(e,t,i){return Math.max(Math.min(e,Math.max(t,i)),Math.min(t,i))}function pe(){return performance&&"function"==typeof performance.now?performance.now():Date.now()}function ge(e){let t=0,i=pe();return s=>{if(r=s,"[object Number]"!==Object.prototype.toString.call(r))return;var r;t+=s;const o=pe(),A=o-i;A>=1e3&&(e(t/A*1e3),i=o,t=0)}}(function(e,t){return e(t={exports:{}},t.exports),t.exports})((function(e){!function(){var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},i=e.exports,s=function(){for(var e,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=0,r=i.length,o={};s<r;s++)if((e=i[s])&&e[1]in t){for(s=0;s<e.length;s++)o[i[0][s]]=e[s];return o}return!1}(),r={change:s.fullscreenchange,error:s.fullscreenerror},o={request:function(e,i){return new Promise(function(r,o){var A=function(){this.off("change",A),r()}.bind(this);this.on("change",A);var a=(e=e||t.documentElement)[s.requestFullscreen](i);a instanceof Promise&&a.then(A).catch(o)}.bind(this))},exit:function(){return new Promise(function(e,i){if(this.isFullscreen){var r=function(){this.off("change",r),e()}.bind(this);this.on("change",r);var o=t[s.exitFullscreen]();o instanceof Promise&&o.then(r).catch(i)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,i){var s=r[e];s&&t.addEventListener(s,i,!1)},off:function(e,i){var s=r[e];s&&t.removeEventListener(s,i,!1)},raw:s};s?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(t[s.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[s.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[s.fullscreenEnabled])}}}),i?e.exports=o:window.screenfull=o):i?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()})).isEnabled,(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}})();const me='"7-29-2024"';function ye(){const e=window.navigator.userAgent.toLowerCase();return e&&/iphone|ipad|ipod|ios/.test(e)}function fe(e){return null==e}function be(e){return!fe(e)}const we=()=>{const e=window.navigator.userAgent;return/MicroMessenger/i.test(e)},Ee=()=>{const e=window.navigator.userAgent;return/Chrome/i.test(e)},Ce=()=>we()&&function(){const e=window.navigator.userAgent.toLowerCase();return/android/i.test(e)}();function ke(e){let t=Ie(e.hasAudio)&&(e.useMSE||e.useWCS&&!e.useOffscreen)&&Ie(e.demuxUseWorker);return!!(Ie(t)&&e.useMSE&&e.mseDecodeAudio&&Ie(e.demuxUseWorker))||(!!(Ie(t)&&e.useWCS&&e.wcsDecodeAudio)||t)}function Be(e){e.close()}function Se(){return"https:"===window.location.protocol||"localhost"===window.location.hostname}function _e(e){const t=Object.prototype.toString;return function(e){switch(t.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:try{return e instanceof Error}catch(e){return!1}}}(e)?e.message:null==e?"":"object"==typeof e?JSON.stringify(e,null,2):String(e)}function ve(){return function(e){let t="";if("object"==typeof e)try{t=JSON.stringify(e),t=JSON.parse(t)}catch(i){t=e}else t=e;return t}(re)}function Te(e){return!0===e||"true"===e}function Ie(e){return!0!==e&&"true"!==e}class Re{constructor(e){this.destroys=[],this.proxy=this.proxy.bind(this),this.master=e}proxy(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)return;if(Array.isArray(t))return t.map((t=>this.proxy(e,t,i,s)));e.addEventListener(t,i,s);const r=()=>{"function"==typeof e.removeEventListener&&e.removeEventListener(t,i,s)};return this.destroys.push(r),r}destroy(){this.master.debugLog("Events","destroy"),this.destroys.forEach((e=>e())),this.destroys=[]}}var Pe=e=>{e.on(Y.decoderWorkerInit,(()=>{e.debugLog("audioPlayer","listen decoderWorkerInit and set loaded true"),e.loaded=!0})),e.on(Y.play,(()=>{e.loading=!1})),e._opt.debug&&(Object.keys(Y).forEach((t=>{e.on(Y[t],(i=>{e.debugLog("audioPlayer events",Y[t],i)}))})),Object.keys(z).forEach((t=>{e.on(z[t],(i=>{e.debugLog("audioPlayer event error",z[t],i)}))})))};class Le extends t{constructor(e){super(),this.player=e,this.playing=!1,this._requestAbort=!1,this._status=oe,this.writableStream=null,this.abortController=new AbortController,this.streamRate=ge((t=>{e.emit(Y.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,e.debugLog("FetchStream","init")}async destroy(){return this.abort(),await this._closeWritableStream(),this.off(),this._status=oe,this.streamRate=null,this.stopStreamRateInterval(),this.player.debugLog("FetchStream","destroy"),!0}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}async _closeWritableStream(){if(this.writableStream&&Ie(this.writableStream.locked))try{await this.writableStream.close(),this.writableStream=null,this.player.debugLog("FetchStream","close writableStream success")}catch(e){this.player.debugLog("FetchStream","destroy and writableStream.close()",e)}}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{demux:i}=this.player;this.player._times.streamStart=de();const s=Object.assign({signal:this.abortController.signal},{headers:t.headers||{}});fetch(e,s).then((e=>{if(this._requestAbort)return this._status=oe,void e.body.cancel();if(!function(e){return e.ok&&e.status>=200&&e.status<=299}(e))return this.player.debugError("FetchStream",`fetch response status is ${e.status} and ok is ${e.ok} and emit error and next abort()`),this.abort(),void this.emit(z.fetchError,`fetch response status is ${e.status} and ok is ${e.ok}`);if(this.emit(Y.streamSuccess),this.startStreamRateInterval(),"undefined"!=typeof WritableStream)this.player.debugLog("FetchStream","use WritableStream() to read stream"),this.writableStream=new WritableStream({write:e=>this.abortController&&this.abortController.signal&&this.abortController.signal.aborted?(this.player.debugLog("FetchStream","writableStream.write() and this.abortController.signal.aborted so return"),void(this._status=ae)):Te(this._requestAbort)?(this.player.debugLog("FetchStream","writableStream.write() and this._requestAbort is true so return"),this._status=ae,void this.abort()):"string"!=typeof e?(this._status=Ae,this.streamRate&&this.streamRate(e.byteLength),i.dispatch(e)):void this.player.debugWarn("FetchStream",`writableStream.write() and value is "${e}" string so return`),close:()=>{this._status=ae,i.close(),this.emit(Y.streamEnd,"fetch done")},abort:e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return this.player.debugLog("FetchStream","writableStream.abort() and this.abortController.signal.aborted so return"),void(this._status=ae);i.close();const t=e.toString();-1===t.indexOf(X)&&-1===t.indexOf(K)&&e.name!==ee&&(this.abort(),this.emit(z.fetchError,e))}}),e.body.pipeTo(this.writableStream).catch((e=>{"AbortError"!==e.name&&this.player.debugLog("FetchStream","res.body.pipeTo() error",e.name,e.toString())}));else{this.player.debugLog("FetchStream","not support WritableStream and use getReader() to read stream");const t=e.body.getReader(),s=()=>{t.read().then((e=>{let{done:t,value:r}=e;return t?(this._status=ae,i.close(),void this.emit(Y.streamEnd,"fetch done")):this.abortController&&this.abortController.signal&&this.abortController.signal.aborted?(this.player.debugLog("FetchStream","reader.read() and this.abortController.signal.aborted so return"),void(this._status=ae)):Te(this._requestAbort)?(this.player.debugLog("FetchStream","reader.read() and this._requestAbort is true so return"),this._status=ae,void this.abort()):void("string"!=typeof r?(this._status=Ae,this.streamRate&&this.streamRate(r.byteLength),i.dispatch(r),s()):this.player.debugWarn("FetchStream",`reader.read() and value is "${r}" string so return`))})).catch((e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return this.player.debugLog("FetchStream","reader.read().catch() and this.abortController.signal.aborted so return"),void(this._status=ae);i.close();const t=e.toString();-1===t.indexOf(X)&&-1===t.indexOf(K)&&e.name!==ee&&(this.abort(),this.emit(z.fetchError,e))}))};s()}})).catch((e=>{this.abortController&&this.abortController.signal&&this.abortController.signal.aborted||"AbortError"!==e.name&&(i.close(),this.abort(),this.emit(z.fetchError,e))}))}abort(){if(this._requestAbort=!0,this.abortController)try{this.abortController.abort(),this.abortController=null,this.player.debugLog("FetchStream","abortController.abort() success")}catch(e){this.abortController=null,this.player.debugLog("FetchStream","abortController.abort() error",e)}}getStreamType(){return h}}class Ne extends t{constructor(e){super(),this.TAG_NAME="FetchWorkerLoader",this.player=e,this.playing=!1,this.fetchWorker=null,this.workerClearTimeout=null,this.workerUrl=null,this.destroyResolve=null,this.decoderWorkerCloseTimeout=null,this.abortController=new AbortController,this.streamRate=ge((t=>{e.emit(Y.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,this._initFetchWorker(),e.debugLog(this.TAG_NAME,"init")}destroy(){return new Promise(((e,t)=>{this.fetchWorker?(this.player.debugLog(this.TAG_NAME,"send destroy"),this.fetchWorker.postMessage({cmd:O}),this.destroyResolve=e,this.decoderWorkerCloseTimeout=setTimeout((()=>{this.player.debugWarn(this.TAG_NAME,"send close but not response and destroy directly"),this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this._destroy(),setTimeout((()=>{e()}),0)}),2e3)):(this._destroy(),setTimeout((()=>{e()}),0))}))}_destroy(){this.off(),this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this.workerUrl&&(window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.workerClearTimeout&&(clearTimeout(this.workerClearTimeout),this.workerClearTimeout=null),this._stopStreamRateInterval(),this.streamRate=null,this.fetchWorker&&(this.fetchWorker.terminate(),this.fetchWorker.onmessage=null,this.fetchWorker=null),this.destroyResolve&&(this.destroyResolve(),this.destroyResolve=null),this.player.debugLog(this.TAG_NAME,"destroy")}_initFetchWorker(){const e=(t=function(){function e(e){return!0===e||"true"===e}const t="The user aborted a request",i="AbortError",s="AbortError",r="fetch",o="destroy",A="destroyEnd",a="buffer",n="fetchError",h="fetchClose",l="fetchSuccess",u="idle",d="buffering",c="complete";let p=new class{constructor(){this._requestAbort=!1,this._status=u,this.writableStream=null,this.isChrome=!1,this.abortController=new AbortController}destroy(){var e;this.abort(),this.writableStream&&(!1===(e=this.writableStream.locked)||"false"===e)&&this.writableStream.close().catch((e=>{})),this.writableStream=null,this._status=u}fetchStream(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=Object.assign({signal:this.abortController.signal},{headers:o.headers||{}});fetch(r,A).then((r=>{if(this._requestAbort)return this._status=u,void r.body.cancel();if(!function(e){return e.ok&&e.status>=200&&e.status<=299}(r))return this.abort(),void postMessage({cmd:n,message:`fetch response status is ${r.status} and ok is ${r.ok}`});if(postMessage({cmd:l}),"undefined"!=typeof WritableStream)this.writableStream=new WritableStream({write:t=>{if(!(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted))return e(this._requestAbort)?(this._status=c,void this.abort()):void("string"!=typeof t&&(this._status=d,postMessage({cmd:a,buffer:t},[t.buffer])));this._status=c},close:()=>{this._status=c,postMessage({cmd:h})},abort:e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return void(this._status=c);const r=e.toString();-1===r.indexOf(t)&&-1===r.indexOf(i)&&e.name!==s&&(this.abort(),postMessage({cmd:n,message:e.toString()}))}}),r.body.pipeTo(this.writableStream).catch((e=>{}));else{const o=r.body.getReader(),A=()=>{o.read().then((t=>{let{done:i,value:s}=t;return i?(this._status=c,void postMessage({cmd:h})):this.abortController&&this.abortController.signal&&this.abortController.signal.aborted?void(this._status=c):e(this._requestAbort)?(this._status=c,void this.abort()):void("string"!=typeof s&&(this._status=d,postMessage({cmd:a,buffer:s},[s.buffer]),A()))})).catch((e=>{if(this.abortController&&this.abortController.signal&&this.abortController.signal.aborted)return void(this._status=c);const r=e.toString();-1===r.indexOf(t)&&-1===r.indexOf(i)&&e.name!==s&&(this.abort(),postMessage({cmd:n,message:e.toString()}))}))};A()}})).catch((e=>{this.abortController&&this.abortController.signal&&this.abortController.signal.aborted||"AbortError"!==e.name&&(this.abort(),postMessage({cmd:n,message:e.toString()}))}))}abort(){if(this._requestAbort=!0,this.abortController)try{this.abortController.abort(),this.abortController=null}catch(e){this.abortController=null}}};self.onmessage=t=>{const i=t.data;switch(i.cmd){case r:p.isChrome=e(i.isChrome),p.fetchStream(i.url,JSON.parse(i.options));break;case o:p.destroy(),p=null,postMessage({cmd:A})}}}.toString(),t.trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1]);var t;const i=new Blob([e],{type:"text/javascript"});let s=URL.createObjectURL(i);const r=new Worker(s);this.workerUrl=s,this.workerClearTimeout=setTimeout((()=>{window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null,this.workerClearTimeout=null}),B),r.onmessage=e=>{const{demux:t}=this.player,i=e.data;switch(i.cmd){case Q:this.streamRate&&this.streamRate(i.buffer.byteLength),t.dispatch(i.buffer);break;case F:this.emit(Y.streamSuccess),this._startStreamRateInterval();break;case j:t.close(),this.emit(Y.streamEnd,"fetch done");break;case H:t.close(),this.emit(z.fetchError,i.message);break;case x:this._destroy()}},this.fetchWorker=r}_startStreamRateInterval(){this._stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}_stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.player._times.streamStart=de(),this.fetchWorker.postMessage({cmd:G,url:e,isChrome:Ee(),options:JSON.stringify(t)})}getStreamType(){return h}}class We extends t{constructor(e){super(),this.player=e,this.socket=null,this.socketStatus=U,this.wsUrl=null,this.requestAbort=!1,this.socketDestroyFnList=[],this.streamRate=ge((t=>{e.emit(Y.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,e.debugLog("WebsocketStream","init")}async destroy(){this._closeWebSocket(),this.stopStreamRateInterval(),this.wsUrl=null,this.off(),this.player.debugLog("WebsocketStream","destroy")}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_createWebSocket(e){const t=this.player,{events:{proxy:i},demux:s}=t,r=e.protocols||[];this.socket=new WebSocket(this.wsUrl,r),this.socket.binaryType="arraybuffer";const o=i(this.socket,"open",(()=>{this.player.debugLog("WebsocketStream","socket open"),this.socketStatus=V,this.emit(Y.streamSuccess),this.player.emit(Y.websocketOpen),this.startStreamRateInterval()})),A=i(this.socket,"message",(e=>{"string"!=typeof e.data?(this.streamRate&&this.streamRate(e.data.byteLength),this._handleMessage(e.data)):this.player.debugWarn("WebsocketStream",`websocket handle message message is "${e.data}" string so return`)})),a=i(this.socket,"close",(e=>{if(!this.player.isDestroyedOrClosed())if(this.socketStatus!==J){if(this.player.debugLog("WebsocketStream",`socket close and code is ${e.code}`),1006===e.code&&this.player.debugError("WebsocketStream",`socket close abnormally and code is ${e.code}`),Te(this.requestAbort))return this.requestAbort=!1,void this.player.debugLog("WebsocketStream","socket close and requestAbort is true");s.close(),this.socketStatus=q,this.player.emit(Y.websocketClose,e.code),this.emit(Y.streamEnd,e.code)}else this.player.debugLog("WebsocketStream","socket close and status is error, so return")})),n=i(this.socket,"error",(e=>{this.player.isDestroyedOrClosed()||(this.player.debugError("WebsocketStream","socket error",e),this.socketStatus=J,this.emit(z.websocketError,e),s.close(),this.player.debugLog("WebsocketStream","socket error:",e.isTrusted?"websocket user aborted":"websocket error"))}));this.socketDestroyFnList.push(o,A,a,n)}_closeWebSocket(){this.socketDestroyFnList.forEach((e=>e())),!this.socket||0!==this.socket.readyState&&1!==this.socket.readyState?this.socket&&this.player.debugLog("WebsocketStream",`_closeWebSocket() socket is null or socket status is ${this.socket&&this.socket.readyState}`):(this.requestAbort=!0,this.socket.close(1e3,"Client disconnecting")),this.socket=null,this.socketStatus=U,this.streamRate=null}_handleMessage(e){const{demux:t}=this.player;t?t.dispatch(e):this.player.debugWarn("WebsocketStream","websocket handle message demux is null so return")}fetchStream(e,t){this.player._times.streamStart=de(),this.wsUrl=e,this._createWebSocket(t)}sendMessage(e){this.socket?this.socketStatus===V?this.socket.send(e):this.player.debugError("WebsocketStream",`websocket send message error and  socket status is ${this.socketStatus}`):this.player.debugError("WebsocketStream","websocket send message socket is null")}resetFetchStream(){this._closeWebSocket(),this._createWebSocket()}getStreamType(){return u}}class De extends t{constructor(e){super(),this.player=e,e.debugLog("HlsStream","init")}async destroy(){return this.off(),this.player.debugLog("HlsStream","destroy"),!0}fetchStream(e){const{hlsDecoder:t,debug:i}=this.player;this.player._times.streamStart=de(),t.loadSource(e).then((()=>{this.player.debugLog("HlsStream","loadSource success"),this.emit(Y.streamSuccess)})).catch((e=>{this.emit(z.hlsError,e)}))}getStreamType(){return l}}class Me extends t{constructor(e){super(),this.player=e,this.webrctUrl=null,e.debugLog("WebrtcStream","init")}async destroy(){return this.webrctUrl=null,this.off(),this.player.debugLog("WebrtcStream","destroy"),!0}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{webrtc:i,debug:s}=this.player;if(this.player._times.streamStart=de(),this.webrctUrl=e.replace("webrtc:",window.location.protocol),this.player.isWebrtcForM7S()&&-1===this.webrctUrl.indexOf("/webrtc/play")){const t=new URL(this.webrctUrl),i="/webrtc/play"+t.pathname;this.webrctUrl=t.origin+i+t.search,this.player.debugLog("WebrtcStream",`original url is ${e}, and new url is: ${this.webrctUrl}`)}i.loadSource(this.webrctUrl,t).then((()=>{this.player.debugLog("WebrtcStream","loadSource success"),this.emit(Y.streamSuccess)})).catch((e=>{this.player.debugError("WebrtcStream","loadSource error",e),this.emit(z.webrtcError,e)}))}getStreamType(){return d}}class Ge extends t{constructor(e){super(),this.player=e,this.transport=null,this.wtUrl=null,this.streamRate=ge((t=>{e.emit(Y.kBps,(t/1024).toFixed(2))})),this.streamRateInterval=null,e.debugLog("WebTransportLoader","init")}async destroy(){return this.abort(),this.off(),this.player.debugLog("WebTransportLoader","destroy"),!0}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval((()=>{this.streamRate&&this.streamRate(0)}),1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_createWebTransport(){const e=this.player,{debug:t,events:{proxy:i},demux:s}=e;try{this.transport=new WebTransport(this.wtUrl),this.transport.ready.then((()=>{this.emit(Y.streamSuccess),this.startStreamRateInterval(),this.transport.createBidirectionalStream().then((e=>{e.readable.pipeTo(new WritableStream(s.input))}))})).catch((e=>{this.player.debugWarn("WebTransportLoader","_createWebTransport-ready",e)}))}catch(e){this.player.debugWarn("WebTransportLoader","_createWebTransport",e)}}fetchStream(e){this.player._times.streamStart=de(),this.wtUrl=e.replace(/^wt:/,"https:"),this._createWebTransport()}abort(){if(this.transport)try{this.transport.close(),this.transport=null}catch(e){this.transport=null}}getStreamType(){return c}}class Oe extends t{constructor(e){super(),this.player=e,this.workUrl=null,e.debugLog("WorkerStream","init")}async destroy(){return this.workUrl=null,this.off(),this.player.debugLog("WorkerStream","destroy"),!0}sendMessage(e){this.player.decoderWorker.workerSendMessage(e)}fetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.workUrl=e,this.player._times.streamStart=de(),this.player.decoderWorker.workerFetchStream(e,t)}getStreamType(){const e=this.player._opt.protocol;return p+" "+(e===s?h:u)}}class xe extends t{constructor(e){super(),this.TAG_NAME="AliyunRtcLoader",this.player=e,e.debugLog(this.TAG_NAME,"init")}async destroy(){return this.off(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}fetchStream(e){const{aliyunRtcDecoder:t}=this.player;this.player._times.streamStart=de(),t.loadSource(e).then((()=>{this.player.debugLog(this.TAG_NAME,"loadSource success"),this.emit(Y.streamSuccess)})).catch((e=>{this.player.debugError(this.TAG_NAME,"loadSource error",e),this.emit(z.aliyunRtcError,e)}))}getStreamType(){return g}}class Qe{constructor(e){return new(Qe.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){const{protocol:t,useWasm:n,playType:h,useWCS:l,useMSE:u,demuxUseWorker:d,mainThreadFetchUseWorker:c}=e;return t===s?h===y?Oe:h===m?n&&!ke(e)||d?Oe:c?Ne:Le:l||u?d?Oe:c?Ne:Le:Oe:t===i?h===y?Oe:h===m?n&&!ke(e)||d?Oe:We:l||u?d?Oe:We:Oe:t===r?De:t===o?Me:t===A?Ge:t===a?xe:void 0}}class He extends t{constructor(e){super(),this.bufferList=[],this.player=e,this.$audio=null,this.scriptNode=null,this.workletProcessorNode=null,this.workletWorkerCloseTimeout=null,this.hasInitScriptNode=!1,this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3}),this.gainNode=this.audioContext.createGain();const t=this.audioContext.createBufferSource();t.buffer=this.audioContext.createBuffer(1,1,22050),t.connect(this.audioContext.destination),t.noteOn?t.noteOn(0):t.start(0),this.audioBufferSourceNode=t,this.mediaStreamAudioDestinationNode=this.audioContext.createMediaStreamDestination(),this.gainNode.gain.value=0,this._prevVolume=null,this.playing=!1,this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""},this.init=!1,this.hasAudio=!1,this.audioResumeStateTimeout=null,this.audioContextContextResumeLock=!1}async destroy(){return this.closeAudio(),this.resetInit(),this.clearAudioResumeStateTimeout(),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.hasAudio=!1,this.playing=!1,this.scriptNode&&(this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=ue,this.scriptNode=null),await this._destroyWorklet(),this.workletProcessorNode&&(this.workletProcessorNode.disconnect(),this.workletProcessorNode.port.onmessage=ue,this.workletProcessorNode=null),this.audioBufferSourceNode&&(this.audioBufferSourceNode.stop(),this.audioBufferSourceNode=null),this.mediaStreamAudioDestinationNode&&(this.mediaStreamAudioDestinationNode.disconnect(),this.mediaStreamAudioDestinationNode=null),this.hasInitScriptNode=!1,this._prevVolume=null,this.audioContextContextResumeLock=!1,this.off(),!0}_destroyWorklet(){return new Promise(((e,t)=>{this.workletProcessorNode?(this.workletProcessorNode.port.postMessage({type:"destroy"}),this.workletWorkerCloseTimeout=setTimeout((()=>{this.player.debugLog(this.TAG_NAME,"send close and wait 10ms destroy directly"),this.workletWorkerCloseTimeout&&(clearTimeout(this.workletWorkerCloseTimeout),this.workletWorkerCloseTimeout=null),e()}),10)):e()}))}resetInit(){this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""},this.init=!1}getAudioInfo(){return this.audioInfo}updateAudioInfo(e){e.encTypeCode&&(this.audioInfo.encTypeCode=e.encTypeCode,this.audioInfo.encType=Z[e.encTypeCode]),e.channels&&(this.audioInfo.channels=e.channels),e.sampleRate&&(this.audioInfo.sampleRate=e.sampleRate),e.depth&&(this.audioInfo.depth=e.depth),this.audioInfo.sampleRate&&this.audioInfo.channels&&this.audioInfo.encType&&!this.init&&(this.player.emit(Y.audioInfo,this.audioInfo),this.init=!0)}get isPlaying(){return this.playing}get isMute(){return 0===this.gainNode.gain.value||this.isStateSuspended()}get volume(){return this.gainNode.gain.value}get bufferSize(){return this.bufferList.length}get audioContextState(){let e=null;return this.audioContext&&(e=this.audioContext.state),e}initScriptNode(){}initMobileScriptNode(){}initWorkletScriptNode(){}getEngineType(){return""}mute(e){e?(this.setVolume(0),this.clear()):this.setVolume(this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e).toFixed(2),isNaN(e)||(this.audioEnabled(!0),e=ce(e,0,1),null!==this._prevVolume&&this._prevVolume===e||(null===this._prevVolume?this.player.emit(Y.mute,0===e):0===this._prevVolume&&e>0?this.player.emit(Y.mute,!1):this._prevVolume>0&&0===e&&this.player.emit(Y.mute,!0),this.gainNode.gain.value=e,this.player.emit(Y.volumechange,this.player.volume),this.player.emit(Y.volume,this.player.volume),this._prevVolume=e))}closeAudio(){this.hasInitScriptNode&&(this.scriptNode&&this.scriptNode.disconnect(this.gainNode),this.workletProcessorNode&&this.workletProcessorNode.disconnect(this.gainNode),this.gainNode&&(this.gainNode.disconnect(this.mediaStreamAudioDestinationNode),this.$audio||this.gainNode.disconnect(this.audioContext.destination))),this.clear()}audioEnabled(e){if(e&&this.isStateSuspended()){if(this.audioContextContextResumeLock)return;this.audioContextContextResumeLock=!0,this.audioContext.resume().then((()=>{this.player.emit(Y.audioResumeState,{state:this.audioContextState,isRunning:this.isStateRunning()})})).finally((()=>{this.audioContextContextResumeLock=!1})),this.audioResumeStateTimeout=setTimeout((()=>{this.clearAudioResumeStateTimeout(),this.audioContextContextResumeLock=!1,this.isStateSuspended()&&this.player.emit(Y.audioResumeState,{state:this.audioContextState,isRunning:this.isStateRunning()})}),1e3)}}isStateRunning(){return"running"===this.audioContextState}isStateSuspended(){return"suspended"===this.audioContextState}clearAudioResumeStateTimeout(){this.audioResumeStateTimeout&&(clearTimeout(this.audioResumeStateTimeout),this.audioResumeStateTimeout=null)}clear(){this.bufferList=[]}play(e,t){}pause(){this.playing=!1}resume(){this.playing=!0}setRate(e){}getAudioBufferSize(){return 0}}class je{constructor(e,t,i,s){this.player=e,this.audio=t,this.channel=i,this.bufferSize=s}destroy(){this.buffer=null,this.channel=null}extract(e,t){let i=this.provide(t);for(let t=0;t<i.size;t++)e[2*t]=i.left[t],e[2*t+1]=i.right[t];return this.audio.tempAudioTimestamp=i.ts,i.size}provide(e){let t=new Float32Array(e),i=new Float32Array(e),s=0,r=0,o=0,A=e/this.bufferSize;const a=this.audio.bufferList;if(A&&a.length>=A){try{for(let e=0;e<A;e++){const e=a.shift();2===this.channel?(t.set(e.buffer[0],o),i.set(e.buffer[1],o)):(t.set(e.buffer[0],o),i.set(e.buffer[0],o)),o+=this.bufferSize,r=e.ts}}catch(e){this.player.debugWarn("Processor","provide()",e),t=new Float32Array(0),i=new Float32Array(0)}s=t.length}return{size:s,ts:r,left:t,right:i}}}class Fe{constructor(){this._vector=new Float32Array,this._position=0,this._frameCount=0}destroy(){this.clear(),this._vector=null}get vector(){return this._vector}get position(){return this._position}get startIndex(){return 2*this._position}get frameCount(){return this._frameCount}get endIndex(){return 2*(this._position+this._frameCount)}clear(){this.receive(this._frameCount),this.rewind()}put(e){this._frameCount+=e}putSamples(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=2*(t=t||0);i>=0||(i=(e.length-s)/2);const r=2*i;this.ensureCapacity(i+this._frameCount);const o=this.endIndex;this.vector.set(e.subarray(s,s+r),o),this._frameCount+=i}putBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=t||0,i>=0||(i=e.frameCount-t),this.putSamples(e.vector,e.position+t,i)}receive(e){e>=0&&!(e>this._frameCount)||(e=this.frameCount),this._frameCount-=e,this._position+=e}receiveSamples(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=2*t,s=this.startIndex;e.set(this._vector.subarray(s,s+i)),this.receive(t)}extract(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=this.startIndex+2*t,r=2*i;e.set(this._vector.subarray(s,s+r))}ensureCapacity(){const e=parseInt(2*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0));if(this._vector.length<e){const t=new Float32Array(e);t.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=t,this._position=0}else this.rewind()}ensureAdditionalCapacity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.ensureCapacity(this._frameCount+e)}rewind(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}}class Ye{constructor(e){e?(this._inputBuffer=new Fe,this._outputBuffer=new Fe):this._inputBuffer=this._outputBuffer=null}destroy(){this.clear(),this._outputBuffer&&(this._outputBuffer.destroy(),this._outputBuffer=null),this._inputBuffer&&(this._inputBuffer.destroy(),this._inputBuffer=null)}get inputBuffer(){return this._inputBuffer}set inputBuffer(e){this._inputBuffer=e}get outputBuffer(){return this._outputBuffer}set outputBuffer(e){this._outputBuffer=e}clear(){this._inputBuffer.clear(),this._outputBuffer.clear()}}class $e extends Ye{constructor(e){super(e),this.reset(),this._rate=1}destroy(){super.destroy()}set rate(e){this._rate=e}reset(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}clone(){const e=new $e;return e.rate=this._rate,e}process(){const e=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(e/this._rate+1);const t=this.transpose(e);this._inputBuffer.receive(),this._outputBuffer.put(t)}transpose(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return 0;const t=this._inputBuffer.vector,i=this._inputBuffer.startIndex,s=this._outputBuffer.vector,r=this._outputBuffer.endIndex;let o=0,A=0;for(;this.slopeCount<1;)s[r+2*A]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*t[i],s[r+2*A+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*t[i+1],A+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!==e)e:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,o+=1,o>=e-1)break e;const a=i+2*o;s[r+2*A]=(1-this.slopeCount)*t[a]+this.slopeCount*t[a+2],s[r+2*A+1]=(1-this.slopeCount)*t[a+1]+this.slopeCount*t[a+3],A+=1,this.slopeCount+=this._rate}return this.prevSampleL=t[i+2*e-2],this.prevSampleR=t[i+2*e-1],A}}const ze=function(){};class Ue extends class{constructor(e){this._pipe=e}destroy(){}get pipe(){return this._pipe}get inputBuffer(){return this._pipe.inputBuffer}get outputBuffer(){return this._pipe.outputBuffer}fillInputBuffer(){throw new Error("fillInputBuffer() not overridden")}fillOutputBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;for(;this.outputBuffer.frameCount<e;){const e=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(e),this.inputBuffer.frameCount<16384)break;this._pipe.process()}}clear(){this._pipe.clear()}}{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ze;super(t),this.callback=i,this.sourceSound=e,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}destroy(){this.clear(),this.sourceSound.destroy(),this.sourceSound=null,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}get position(){return this._position}set position(e){if(e>this._position)throw new RangeError("New position may not be greater than current position");const t=this.outputBufferPosition-(this._position-e);if(t<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=t,this._position=e}get sourcePosition(){return this._sourcePosition}set sourcePosition(e){this.clear(),this._sourcePosition=e}onEnd(){this.callback()}fillInputBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=new Float32Array(2*e),i=this.sourceSound.extract(t,e,this._sourcePosition);this._sourcePosition+=i,this.inputBuffer.putSamples(t,0,i)}extract(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillOutputBuffer(this.outputBufferPosition+t);const i=Math.min(t,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(e,this.outputBufferPosition,i);const s=this.outputBufferPosition+i;return this.outputBufferPosition=Math.min(this.historyBufferSize,s),this.outputBuffer.receive(Math.max(s-this.historyBufferSize,0)),this._position+=i,i}handleSampleData(e){this.extract(e.data,4096)}clear(){super.clear(),this.outputBufferPosition=0}}const Ve=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],qe=-10/1.5;class Je extends Ye{constructor(e){super(e),this._quickSeek=!0,this.midBufferDirty=!1,this.midBuffer=null,this.refMidBuffer=null,this.overlapLength=0,this.autoSeqSetting=!0,this.autoSeekSetting=!0,this._tempo=1,this.setParameters(44100,0,0,8)}destroy(){this.clear(),super.destroy()}clear(){super.clear(),this.clearMidBuffer(),this.refMidBuffer=null}clearMidBuffer(){this.midBufferDirty&&(this.midBufferDirty=!1),this.midBuffer=null}setParameters(e,t,i,s){e>0&&(this.sampleRate=e),s>0&&(this.overlapMs=s),t>0?(this.sequenceMs=t,this.autoSeqSetting=!1):this.autoSeqSetting=!0,i>0?(this.seekWindowMs=i,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}set tempo(e){let t;this._tempo=e,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,t=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(t+this.overlapLength,this.seekWindowLength)+this.seekLength}get tempo(){return this._tempo}get inputChunkSize(){return this.sampleReq}get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}calculateOverlapLength(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e=this.sampleRate*t/1e3,e=e<16?16:e,e-=e%8,this.overlapLength=e,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}checkLimits(e,t,i){return e<t?t:e>i?i:e}calculateSequenceParameters(){let e,t;this.autoSeqSetting&&(e=150+-50*this._tempo,e=this.checkLimits(e,50,125),this.sequenceMs=Math.floor(e+.5)),this.autoSeekSetting&&(t=28.333333333333332+qe*this._tempo,t=this.checkLimits(t,15,25),this.seekWindowMs=Math.floor(t+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}set quickSeek(e){this._quickSeek=e}clone(){const e=new Je;return e.tempo=this._tempo,e.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),e}seekBestOverlapPosition(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}seekBestOverlapPositionStereo(){let e,t,i,s=0;for(this.preCalculateCorrelationReferenceStereo(),e=0,t=Number.MIN_VALUE;s<this.seekLength;s+=1)i=this.calculateCrossCorrelationStereo(2*s,this.refMidBuffer),i>t&&(t=i,e=s);return e}seekBestOverlapPositionStereoQuick(){let e,t,i,s,r,o=0;for(this.preCalculateCorrelationReferenceStereo(),t=Number.MIN_VALUE,e=0,s=0,r=0;o<4;o+=1){let A=0;for(;Ve[o][A]&&(r=s+Ve[o][A],!(r>=this.seekLength));)i=this.calculateCrossCorrelationStereo(2*r,this.refMidBuffer),i>t&&(t=i,e=r),A+=1;s=e}return e}preCalculateCorrelationReferenceStereo(){let e,t,i=0;for(;i<this.overlapLength;i+=1)t=i*(this.overlapLength-i),e=2*i,this.refMidBuffer[e]=this.midBuffer[e]*t,this.refMidBuffer[e+1]=this.midBuffer[e+1]*t}calculateCrossCorrelationStereo(e,t){const i=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;let s=0,r=2;const o=2*this.overlapLength;let A;for(;r<o;r+=2)A=r+e,s+=i[A]*t[r]+i[A+1]*t[r+1];return s}overlap(e){this.overlapStereo(2*e)}overlapStereo(e){const t=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;const i=this._outputBuffer.vector,s=this._outputBuffer.endIndex;let r,o,A=0;const a=1/this.overlapLength;let n,h,l;for(;A<this.overlapLength;A+=1)o=(this.overlapLength-A)*a,n=A*a,r=2*A,h=r+e,l=r+s,i[l+0]=t[h+0]*n+this.midBuffer[r+0]*o,i[l+1]=t[h+1]*n+this.midBuffer[r+1]*o}process(){let e,t,i;if(null===this.midBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){e=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(e)),this._outputBuffer.put(this.overlapLength),t=this.seekWindowLength-2*this.overlapLength,t>0&&this._outputBuffer.putBuffer(this._inputBuffer,e+this.overlapLength,t);const s=this._inputBuffer.startIndex+2*(e+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(s,s+2*this.overlapLength)),this.skipFract+=this.nominalSkip,i=Math.floor(this.skipFract),this.skipFract-=i,this._inputBuffer.receive(i)}}}const Ze=function(e,t){return(e>t?e-t:t-e)>1e-10};class Xe{constructor(){this.transposer=new $e(!1),this.stretch=new Je(!1),this._inputBuffer=new Fe,this._intermediateBuffer=new Fe,this._outputBuffer=new Fe,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}destroy(){this.clear(),this._inputBuffer.destroy(),this._intermediateBuffer.destroy(),this._outputBuffer.destroy(),this._inputBuffer=null,this._intermediateBuffer=null,this._outputBuffer=null}clear(){this.transposer.clear(),this.stretch.clear()}clone(){const e=new Xe;return e.rate=this.rate,e.tempo=this.tempo,e}get rate(){return this._rate}set rate(e){this.virtualRate=e,this.calculateEffectiveRateAndTempo()}set rateChange(e){this._rate=1+.01*e}get tempo(){return this._tempo}set tempo(e){this.virtualTempo=e,this.calculateEffectiveRateAndTempo()}set tempoChange(e){this.tempo=1+.01*e}set pitch(e){this.virtualPitch=e,this.calculateEffectiveRateAndTempo()}set pitchOctaves(e){this.pitch=Math.exp(.69314718056*e),this.calculateEffectiveRateAndTempo()}set pitchSemitones(e){this.pitchOctaves=e/12}get inputBuffer(){return this._inputBuffer}get outputBuffer(){return this._outputBuffer}calculateEffectiveRateAndTempo(){const e=this._tempo,t=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,Ze(this._tempo,e)&&(this.stretch.tempo=this._tempo),Ze(this._rate,t)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}process(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}}class Ke{constructor(e,t,i){this.player=e,this.audio=t,this.soundTouch=new Xe,this.soundTouch.tempo=1,this.soundTouch.rate=1,this.filter=new Ue(i,this.soundTouch)}destroy(){this.filter&&(this.filter.destroy(),this.filter=null),this.soundTouch&&(this.soundTouch.destroy(),this.soundTouch=null)}setRate(e){e!==this.soundTouch.rate&&(this.soundTouch.tempo=e)}provide(e){let t=new Float32Array(2*e),i=this.filter.extract(t,e),s=new Float32Array(i),r=new Float32Array(i);for(let e=0;e<i;e++)s[e]=t[2*e],r[e]=t[2*e+1];return{size:i,left:s,right:r,ts:this.audio.tempAudioTimestamp||0}}}class et extends He{constructor(e){super(e),this.TAG_NAME="AudioContext",this.defaultPlaybackRate=1,this.playbackRate=1,this.rateProcessor=null,this.processor=null,this.scriptNodeInterval=null,this.engineType=this.getAutoAudioEngineType(),this.audioBufferSize=this.getAudioBufferSizeByType(),this.$audio=null,this._delayPlay=!1,this.eventListenList=[],this.workletUrl=null,this.clearWorkletUrlTimeout=null,this.player._opt.supportLockScreenPlayAudio&&ye()&&(this.$audio=document.createElement("audio"),Object.assign(this.$audio.style,{position:"absolute",left:"-100%",top:"-100%"}),e.$container?e.$container.appendChild(this.$audio):document.body.appendChild(this.$audio),this._bindAudioProxy(),this.player.debugLog("AudioContext","create audio element")),this.scriptStartTime=0,this.player.debugLog("AudioContext","init",`engineType: ${this.engineType}, audioBufferSize: ${this.audioBufferSize}`)}async destroy(){return await super.destroy(),this.workletUrl&&(URL.revokeObjectURL(this.workletUrl),this.workletUrl=null),this.clearWorkletUrlTimeout&&(clearTimeout(this.clearWorkletUrlTimeout),this.clearWorkletUrlTimeout=null),this.eventListenList.length&&(this.eventListenList.forEach((e=>{e()})),this.eventListenList=[]),this.$audio&&(this.$audio.pause(),this.$audio.srcObject=null,this.$audio.parentNode&&this.$audio.parentNode.removeChild(this.$audio),this.$audio=null),this.processor&&(this.processor.destroy(),this.processor=null),this.rateProcessor&&(this.rateProcessor.destroy(),this.rateProcessor=null),this.scriptNodeInterval&&(clearInterval(this.scriptNodeInterval),this.scriptNodeInterval=null),this.defaultPlaybackRate=1,this.playbackRate=1,this.scriptStartTime=0,this.audioBufferSize=0,this.engineType=ie,this.player.debugLog("AudioContext","destroy"),!0}isAudioPlaying(){return this.$audio&&Ie(this.$audio.paused)&&Ie(this.$audio.ended)&&0!==this.$audio.playbackRate&&0!==this.$audio.readyState}_bindAudioProxy(){const{proxy:e}=this.player.events,t=e(this.$audio,"canplay",(()=>{this.player.debugLog("AudioContext","canplay"),this._delayPlay&&this._audioElementPlay()}));this.eventListenList.push(t)}_getAudioElementReadyState(){let e=0;return this.$audio&&(e=this.$audio.readyState),e}audioElementPlay(){if(this.$audio){const e=this._getAudioElementReadyState();if(this.player.debugLog("AudioContext",`play and readyState: ${e}`),!(0!==e||we()&&ye()))return this.player.debugWarn("AudioContext","readyState is 0 and set _delayPlay to true"),void(this._delayPlay=!0);this._audioElementPlay()}}_audioElementPlay(){this.$audio&&this.$audio.play().then((()=>{this._delayPlay=!1,this.player.debugLog("AudioContext","_audioElementPlay success"),setTimeout((()=>{this.isAudioPlaying()||(this.player.debugWarn("AudioContext","play failed and retry play"),this._audioElementPlay())}),100),this.isAudioPlaying()&&(this.player.debugLog("AudioContext","play success and remove document click event listener"),document.removeEventListener("click",this._audioElementPlay.bind(this)))})).catch((e=>{this.player.debugError("AudioContext","_audioElementPlay error",e),document.addEventListener("click",this._audioElementPlay.bind(this))}))}getAudioBufferSize(){return this.audioBufferSize}get oneBufferDuration(){return this.audioBufferSize/this.audioContext.sampleRate*1e3}get isActiveEngineType(){return this.engineType===se}getBufferListDuration(){return this.bufferList.length*this.oneBufferDuration}isMoreThanMinBufferDuration(){return this.getBufferListDuration()>=100*this.playbackRate}initProcessor(){this.processor=new je(this.player,this,this.audioInfo.channels,this.audioBufferSize),this.rateProcessor=new Ke(this.player,this,this.processor)}getAutoAudioEngineType(){let e=this.player._opt.audioEngine||ie;const t=()=>{e=Ce()?se:(ye()&&this.player._opt.supportLockScreenPlayAudio||Se()&&this.supportAudioWorklet(),ie)};return this.player._opt.audioEngine?this.player._opt.audioEngine===te&&Se()&&this.supportAudioWorklet()?e=ie:this.player._opt.audioEngine===se?e=se:this.player._opt.audioEngine===ie?e=ie:t():t(),e}getAudioBufferSizeByType(){const e=this.engineType;this.player._opt.hasVideo;const t=this.player._opt.weiXinInAndroidAudioBufferSize;return e===te?1024:e===se?t||4800:1024}supportAudioWorklet(){return this.audioContext&&this.audioContext.audioWorklet&&"function"==typeof this.audioContext.audioWorklet.addModule}initScriptNode(){this.playing=!0,this.hasInitScriptNode||(this.initProcessor(),this.engineType===te?this.initWorkletScriptNode():this.engineType===se?this.initIntervalScriptNode():this.engineType===ie&&this.initProcessScriptNode(),this.audioElementPlay())}getEngineType(){return this.engineType}isPlaybackRateSpeed(){return this.playbackRate>this.defaultPlaybackRate}initProcessScriptNode(){const e=this.audioContext.createScriptProcessor(this.audioBufferSize,0,this.audioInfo.channels);e.onaudioprocess=e=>{const t=e.outputBuffer;this.handleScriptNodeCallback(t)},e.connect(this.gainNode),this.scriptNode=e,this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0}initIntervalScriptNode(){this.scriptStartTime=0;const e=1e3*this.audioBufferSize/this.audioContext.sampleRate;this.scriptNodeInterval=setInterval((()=>{if(0===this.bufferList.length||Ie(this.playing)||this.isMute)return void(this.playing&&Ie(this.isMute)&&this.player.debugLog("AudioContext",`interval script node and bufferList is ${this.bufferList.length} or playing is ${this.playing}`));const e=this.audioContext.createBufferSource(),t=this.audioContext.createBuffer(this.audioInfo.channels,this.audioBufferSize,this.audioContext.sampleRate);this.handleScriptNodeCallback(t,(()=>{this.scriptStartTime<this.audioContext.currentTime&&(this.player.debugLog("AudioContext",`script start time ${this.scriptStartTime} is less than current time ${this.audioContext.currentTime}`),this.scriptStartTime=this.audioContext.currentTime),e.buffer=t,e.connect(this.gainNode),e.start(this.scriptStartTime),this.scriptStartTime+=t.duration}))}),e),this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0}initWorkletScriptNode(){let e=function(e){const t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)}((function(){class e extends AudioWorkletProcessor{constructor(){super(),this.audioBufferSize=1024,this.start=!1,this.channels=1,this.samplesArray=[],this.offset=0,this.state=0,this.port.onmessage=e=>{"init"===e.data.message?(this.audioBufferSize=e.data.audioBufferSize,this.start=e.data.start,this.channels=e.data.channels,this.state=0,this.offset=0,this.samplesArray=[]):"stop"===e.data.message?(this.state=0,this.start=!1,this.offset=0,this.samplesArray=[]):"data"===e.data.message?this.samplesArray.push(e.data.buffer):"zero"===e.data.message&&this.samplesArray.push({left:new Float32Array(this.audioBufferSize).fill(0),right:new Float32Array(this.audioBufferSize).fill(0)})}}process(e,t,i){const s=t[0][0],r=t[0][1];if(0===this.offset&&this.port.postMessage({message:"beep"}),0===this.state)this.state=1;else if(1===this.state&&this.samplesArray.length>=4)this.state=2;else if(2===this.state){const e=this.samplesArray[0];for(let t=0;t<s.length;t++)1===this.channels?s[t]=e.left[t+this.offset]:2===this.channels&&(s[t]=e.left[t+this.offset],r&&(r[t]=e.right[t+this.offset]))}else 1===this.channels?s.fill(0):2===this.channels&&(s.fill(0),r&&r.fill(0));return this.offset+=128,this.offset===this.audioBufferSize&&(this.offset=0,2===this.state&&this.samplesArray.shift(),0===this.samplesArray.length&&(this.state=0)),this.start}}registerProcessor("worklet-processor",e)}));this.workletUrl=e,this.audioContext.audioWorklet.addModule(e).then((()=>{if(this.player.isDestroyedOrClosed())return void this.player.debugLog("AudioContext","initWorkletScriptNode() player is destroyed");if(!this.audioContext)return void this.player.debugWarn("AudioContext","initWorkletScriptNode audioContext is null");let e=[1];2===this.audioInfo.channels&&(e=[1,1]);try{this.workletProcessorNode=new AudioWorkletNode(this.audioContext,"worklet-processor",{numberOfOutputs:this.audioInfo.channels,outputChannelCount:e})}catch(e){this.player.debugError("AudioContext","initWorkletScriptNode error",e),this.workletProcessorNode=null,this.tierDownToProcessScript()}this.workletProcessorNode&&(this.workletProcessorNode.connect(this.gainNode),this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0,this.workletProcessorNode.port.postMessage({message:"init",audioBufferSize:this.audioBufferSize,start:!0,channels:this.audioInfo.channels}),this.workletProcessorNode.port.onmessage=e=>{this.workletProcessorNode?this.audioContext?this.handleScriptNodeCallback(this.workletProcessorNode,null,!0):this.workletProcessorNode.port.postMessage({message:"zero"}):this.player.debugError("AudioContext","workletProcessorNode is null")})})),this.clearWorkletUrlTimeout=setTimeout((()=>{URL.revokeObjectURL(this.workletUrl),this.workletUrl=null,this.clearWorkletUrlTimeout=null}),B)}tierDownToProcessScript(){this.player.debugLog("AudioContext","tierDownToProcessScript"),this.engineType=ie,this.audioBufferSize=this.getAudioBufferSizeByType(),this.initProcessScriptNode(),this.audioElementPlay()}handleScriptNodeCallback(e,t){let i,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t||ue;let r=e.length;s&&(i=e,r=this.audioBufferSize);const o=this.audioInfo.channels;if(this.playing&&this.isMoreThanMinBufferDuration()){if(this.player._opt,this.player.openSyncAudioAndVideo()&&Te(this.player.visibility)){this.calcPlaybackRateBySync();const r=this.player.getAudioSyncVideoDiff();if(r>this.player._opt.syncAudioAndVideoDiff){const A=this.player.getCurrentVideoAndAudio();return this.player.debugWarn("AudioContext",`audioSyncVideoOption more than diff :${r},\n                    and video is ${A.video} ,\n                    and audio is ${A.audio} , waiting and bufferList is ${this.bufferList.length}, fill zero`),s?i.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),void t()}}let A=this._provide(r);if(0===A.size)return Ie(this.player.isPlaybackOnlyDecodeIFrame())&&this.player.debugWarn("AudioContext",`bufferList size is ${this.bufferList.length} outputBufferLength is ${r},and bufferItem.size is 0, fill zero`),s?i.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),void t();A&&A.ts&&(this.player.audioTimestamp=A.ts),s?i.port.postMessage({message:"data",buffer:A}):this.fillScriptNodeOutputBuffer(e,o,A),t()}else 0===this.bufferList.length&&this.playing&&Ie(this.isMute)&&Ie(this.player.isPlaybackOnlyDecodeIFrame())&&this.player.debugWarn("AudioContext",`bufferList size is 0 and outputBufferLength is ${r}, fill zero`),s?i.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),t()}fillScriptNodeOutputBuffer(e,t,i){if(1===t){const t=e.getChannelData(0);i?0===i.size?t.fill(0):t.set(i.left):t.fill(0)}else if(2===t){const t=e.getChannelData(0),s=e.getChannelData(1);i?0===i.size?(t.fill(0),s.fill(0)):(t.set(i.left),s.set(i.right)):(t.fill(0),s.fill(0))}}play(e,t){this.isMute||(this.hasInitScriptNode?(this.hasAudio=!0,this.player.latestAudioTimestamp=t,this.bufferList.push({buffer:e,ts:t}),Ie(this.player.openSyncAudioAndVideo())&&this.calcPlaybackRateByBuffer()):this.player.debugWarn("AudioContext","play has not init script node"))}calcPlaybackRateBySync(){if(this.isMute)return;if(!this.playing)return;const e=Math.floor(2e3/this.oneBufferDuration);if(this.bufferList.length>e)return this.player.debugWarn("AudioContext",`bufferList length ${this.bufferList.length} more than ${e}, and drop`),void this.clear();const t=this.player.getAudioSyncVideoDiff();if(this.getEngineType()===se){if(t<-this.player._opt.syncAudioAndVideoDiff){this.player.debugWarn("AudioContext",`engine active , audioSyncVideoOption ${-this.player._opt.syncAudioAndVideoDiff} less than diff :${t},\n                 and bufferlist is ${this.bufferList.length}`);const e=this.player.getRenderCurrentPts();for(;this.bufferList.length>0;){const t=this.bufferList[0],i=t.ts-e;if(i>-this.player._opt.syncAudioAndVideoDiff/2){this.player.audioTimestamp=t.ts,this.player.debugLog("AudioContext",`engine active , audioSyncVideoOption\n                        item.ts is ${t.ts} and currentVideoTimestamp is ${e}, diff is ${i} > -${this.player._opt.syncAudioAndVideoDiff/2} and end`);break}this.bufferList.shift(),this.player.audioTimestamp=t.ts}}}else{let e=this.playbackRate;t<-this.player._opt.syncAudioAndVideoDiff?e===this.defaultPlaybackRate&&(this.player.debugLog("AudioContext",`audioSyncVideoOption ${-this.player._opt.syncAudioAndVideoDiff} less than diff :${t},\n                 speed up, playbackRate is ${e},\n                 and bufferList is ${this.bufferList.length}`),e=this.defaultPlaybackRate+.2):t>-this.player._opt.syncAudioAndVideoDiff/2&&e!==this.defaultPlaybackRate&&(this.player.debugLog("AudioContext",`diff is ${t} > -${this.player._opt.syncAudioAndVideoDiff/2} and speed to 1`),e=this.defaultPlaybackRate),this.updatePlaybackRate(e)}}calcPlaybackRateByBuffer(){if(this.isMute)return;if(!this.playing)return;let e=this.playbackRate,t=1e3,i=5e3;this.isAudioPlayer&&(t=this.player._opt.videoBufferDelay,i=this.player._opt.videoBufferMax);const s=Math.floor(t/this.oneBufferDuration),r=Math.floor(i/this.oneBufferDuration);if(this.bufferList.length>r)return this.player.debugWarn("AudioContext",`bufferList length ${this.bufferList.length} more than ${r}, and drop`),void this.clear();this.getEngineType()!==se&&(this.bufferList.length>s?(e=this.defaultPlaybackRate+.2,this.player.debugLog("AudioContext",`bufferList length ${this.bufferList.length} more than ${s}, speed up, playbackRate is ${e}`)):this.bufferList.length<s/2&&(e=this.defaultPlaybackRate),this.updatePlaybackRate(e))}updatePlaybackRate(e){this.rateProcessor&&(this.playbackRate=e,this.rateProcessor.setRate(this.playbackRate))}_provide(e){return(1===this.playbackRate?this.processor:this.rateProcessor).provide(e)}}class tt extends t{constructor(e){super(),this.player=e,this.$video=e.video.$videoElement,this.init=!1,this.player._opt.hlsUseCanvasRender&&(this.$video=this.player.hlsDecoder.$videoElement),this.player._opt.webrtcUseCanvasRender&&(this.$video=this.player.webrtc.$videoElement),this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""},this._prevVolume=null,this.player.debugLog("Audio","init")}async destroy(){return this.resetInit(),this.off(),this._prevVolume=null,this.player.debugLog("Audio","destroy"),!0}resetInit(){this.init=!1,this.audioInfo={encTypeCode:"",encType:"",channels:"",sampleRate:"",depth:""}}getAudioInfo(){return this.audioInfo}updateAudioInfo(e){e.encTypeCode&&(this.audioInfo.encTypeCode=e.encTypeCode,this.audioInfo.encType=Z[e.encTypeCode]),e.encType&&(this.audioInfo.encType=e.encType),e.channels&&(this.audioInfo.channels=e.channels),e.sampleRate&&(this.audioInfo.sampleRate=e.sampleRate),e.depth&&(this.audioInfo.depth=e.depth),this.audioInfo.sampleRate&&this.audioInfo.channels&&this.audioInfo.encType&&!this.init&&(this.player.debugLog("Audio","audioInfo",JSON.stringify(this.audioInfo)),this.player.emit(Y.audioInfo,this.audioInfo),this.init=!0)}get isPlaying(){return!0}get volume(){return Te(this.$video.muted)?0:this.$video.volume}get isMute(){return 0===this.$video.volume||Te(this.$video.muted)}mute(e){this.setVolume(e?0:this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e),isNaN(e)||(this.$video.muted&&(this.$video.muted=!1),e=ce(e,0,1),ye()&&(this.$video.muted=0===e),this.player.isAliyunRtc()&&this.player.aliyunRtcDecoder&&this.player.aliyunRtcDecoder.aliyunRtcRemoteStream&&(this.player.aliyunRtcDecoder.aliyunRtcRemoteStream.muted=0===e),null!==this._prevVolume&&this._prevVolume===e||(null===this._prevVolume?this.player.emit(Y.mute,0===e):0===this._prevVolume&&e>0?this.player.emit(Y.mute,!1):this._prevVolume>0&&0===e&&this.player.emit(Y.mute,!0),this.$video.volume=e,this.player.emit(Y.volumechange,this.player.volume),this.player.emit(Y.volume,this.player.volume),this._prevVolume=e))}clear(){}play(e,t){const i=this.player.video.awriter;if(i)if(e.close)try{i.write(e),Be(e)}catch(e){this.player.debugError("Video","play audio error",e)}else try{const s=function(e,t){const i={...t,format:"f32-planar",data:new Float32Array(0)};if(i.numberOfFrames=e[0].length,1===e.length)i.data=e[0];else if(2===e.length){const t=new Float32Array(e[0].length+e[1].length);for(let i=0;i<e[0].length;i++)t[2*i]=e[0][i],t[2*i+1]=e[1][i];i.data=t}return new AudioData(i)}(e,{sampleRate:48e3,numberOfChannels:this.audioInfo.channels,timestamp:t});i.write(s),Be(s)}catch(e){this.player.debugError("Video","play audio error",e)}else this.player.debugWarn("Audio","play and this.awriter is null")}pause(){}resume(){}getEngineType(){return"audio"}isPlaybackRateSpeed(){return!1}setRate(){}initScriptNode(){}initScriptNodeDelay(){}audioEnabled(){this.mute(!1)}getAudioBufferSize(){return 2048}}class it extends et{constructor(e){super(e),this.delayTimeout=null,this.player.on(Y.playbackPause,(e=>{this.listenPlaybackPause(e)})),this.player.debugLog("AudioPlaybackContext","init")}async destroy(){return this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null),await super.destroy(),this.player.debugLog("AudioPlaybackLoader","destroy"),!0}listenPlaybackPause(e){e?(this.pause(),this.player.playback.isPlaybackPauseClearCache&&this.clear()):this.resume()}initScriptNodeDelay(){const e=this.player._opt.playbackDelayTime;e>0?this.delayTimeout=setTimeout((()=>{this.initScriptNode()}),e):this.initScriptNode()}setRate(e){e!==this.defaultPlaybackRate&&this.rateProcessor&&(this.player.debugLog("AudioPlaybackContext","setRate",e),this.defaultPlaybackRate=e,this.updatePlaybackRate(e))}}class st extends et{constructor(e){super(e),this.TAG_NAME="AudioPlayerLoader",this.isAudioPlayer=!0,this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return await super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}play(e,t){Ie(this.playing)||super.play(e,t)}pause(){this.player.debugLog(this.TAG_NAME,"pause"),this.playing=!1,this.clear()}resume(){this.player.debugLog(this.TAG_NAME,"resume"),this.playing=!0}}class rt extends t{constructor(e){super(),this.TAG_NAME="AudioWebrtcPlayerLoader",this.$video=new Audio,this.player=e,this.init=!1,this._prevVolume=null,this.eventsDestroy=[],this._handleDocumentClickPlay=this._handleClickPlay.bind(this),this._initAudioEvents(),this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return this.resetInit(),this.off(),this.eventsDestroy.length&&(this.eventsDestroy.forEach((e=>e())),this.eventsDestroy=[]),this._prevVolume=null,this.$video&&(this.$video.pause(),this.$video.srcObject=null,this.$video=null),this.player.debugLog(this.TAG_NAME,"destroy"),!0}_initAudioEvents(){const{proxy:e}=this.player.events,t=e(this.$video,"timeupdate",(e=>{const t=parseInt(e.timeStamp,10);this.player.handleRender(),this.player.updateStats({ts:t})}));this.eventsDestroy.push(t)}resetInit(){this.init=!1}_handleClickPlay(){this.$video&&(this.$video.play(),document.removeEventListener("click",this._handleDocumentClickPlay))}bindStream(e){this.$video.srcObject=e,this.$video.volume=1,this.$video.play().catch((e=>{this.player.debugWarn(this.TAG_NAME,"audio play error",e),document.addEventListener("click",this._handleDocumentClickPlay)}))}getEngineType(){return"audio"}get isPlaying(){return!0}get volume(){return Te(this.$video.muted)?0:this.$video.volume}get isMute(){return 0===this.$video.volume||Te(this.$video.muted)}mute(e){this.setVolume(e?0:this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e),isNaN(e)||null===this.$video||(this.$video.muted&&(this.$video.muted=!1),e=ce(e,0,1),ye()&&(this.$video.muted=0===e),null!==this._prevVolume&&this._prevVolume===e||(null===this._prevVolume?this.player.emit(Y.mute,0===e):0===this._prevVolume&&e>0?this.player.emit(Y.mute,!1):this._prevVolume>0&&0===e&&this.player.emit(Y.mute,!0),this.$video.volume=e,this.player.emit(Y.volumechange,this.player.volume),this.player.emit(Y.volume,this.player.volume),this._prevVolume=e))}pause(){}resume(){}audioEnabled(){this.mute(!1)}}class ot{constructor(e){return new(ot.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){return e.playType===f?e.useMSE&&e.mseDecodeAudio?tt:it:e.playType===y?e.isWebrtc?rt:st:e.isHls&&Ie(e.supportHls265)||e.isWebrtc&&Ie(e.isWebrtcH265)||e.useMSE&&e.mseDecodeAudio||e.isAliyunRtc||e.useWCS&&e.wcsDecodeAudio||e.useWasm&&e.wasmPlayAudioUseVideoRender?tt:et}}const At=()=>"wakeLock"in navigator&&-1===window.navigator.userAgent.indexOf("Samsung")&&Ie(ye());class at{constructor(e){this.player=e,this.enabled=!1,At()?(this.player.debugLog("NoSleep","Native Wake Lock API supported."),this._wakeLock=null,this.handleVisibilityChange=()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable()},document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange)):(this.player.debugLog("NoSleep","Native Wake Lock API not supported. so use video element."),this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm","data:video/webm;base64,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ggOtgPj//qOHggPBgPj//qOHggPVgPj//qOHggPpgPj//qOegQPvANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCA/2A+P/+o4eCBBGA+P/+o4eCBCWA+P/+o4eCBDmA+P/+o4eCBE2A+P/+o56BBFMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IEiID4//6jh4IEnID4//6jh4IEsID4//6jnoEEtwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggTEgPj//qOHggTYgPj//qOHggTsgPj//qOHggUAgPj//qOHggUUgPj//qOegQUbANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCBSiA+P/+o4eCBTyA+P/+o4eCBVCA+P/+o4eCBWSA+P/+o4eCBXiA+P/+o56BBX8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IFjID4//6jh4IFoID4//6jh4IFtID4//6jh4IFyID4//6jh4IF3ID4//6jnoEF4wDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggXwgPj//qOHggYEgPj//qOHggYYgPj//qOHggYsgPj//qOHggZAgPj//qOegQZHANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCBlSA+P/+o4eCBmiA+P/+o4eCBnyA+P/+o4eCBpCA+P/+o4eCBqSA+P/+o56BBqsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IGuID4//6jh4IGzID4//6jh4IG4ID4//6jh4IG9ID4//6jh4IHCID4//6jnoEHDwDRAgAFEBAUYABhYL/QACIAEM1+tck+ccwAAKOHggccgPj//qOHggcwgPj//qOHggdEgPj//qOHggdYgPj//qOHggdsgPj//qOegQdzANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCB4CA+P/+o4eCB5SA+P/+o4eCB6iA+P/+o4eCB7yA+P/+o4eCB9CA+P/+o56BB9cA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IH5ID4//6jh4IH+ID4//6jh4IIDID4//6jh4IIIID4//6jh4IINID4//6jnoEIOwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgghIgPj//qOHgghcgPj//qOHgghwgPj//qOHggiEgPj//qOegQifANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCMCA+P/+o4eCCNSA+P/+o4eCCOiA+P/+o4eCCPyA+P/+o56BCQMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IJEID4//6jh4IJJID4//6jh4IJOID4//6jh4IJTID4//6jh4IJYID4//6jnoEJZwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggl0gPj//qOHggmIgPj//qOHggmcgPj//qOHggmwgPj//qOHggnEgPj//qOegQnLANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCdiA+P/+o4eCCeyA+P/+o4eCCgCA+P/+o4eCChSA+P/+o4eCCiiA+P/+o56BCi8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IKPID4//6jh4IKUID4//6jh4IKZID4//6jh4IKeID4//6jh4IKjID4//6jnoEKkwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggqggPj//qOHggq0gPj//qOHggrIgPj//qOHggrcgPj//qOHggrwgPj//qOegQr3ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCwSA+P/+o4eCCxiA+P/+o4eCCyyA+P/+o4eCC0CA+P/+o4eCC1SA+P/+o56BC1sA0QIABRAQFGAAYWC/0AAiABDNfrXJPnHMAACjh4ILaID4//6jh4ILfID4//6jh4ILkID4//6jh4ILpID4//6jh4ILuID4//6jnoELvwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggvMgPj//qOHggvggPj//qOHggv0gPj//qOHggwIgPj//qOHggwcgPj//qOegQwjANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDDCA+P/+o4eCDESA+P/+o4eCDFiA+P/+o4eCDGyA+P/+o4eCDICA+P/+o56BDIcA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IMlID4//6jh4IMqID4//6jh4IMvID4//6jh4IM0ID4//6jnoEM6wDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg0MgPj//qOHgg0ggPj//qOHgg00gPj//qOHgg1IgPj//qOegQ1PANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDVyA+P/+o4eCDXCA+P/+o4eCDYSA+P/+o4eCDZiA+P/+o4eCDayA+P/+o56BDbMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4INwID4//6jh4IN1ID4//6jh4IN6ID4//6jh4IN/ID4//6jh4IOEID4//6jnoEOFwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg4kgPj//qOHgg44gPj//qOHgg5MgPj//qOHgg5ggPj//qOHgg50gPj//qOegQ57ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDoiA+P/+o4eCDpyA+P/+o4eCDrCA+P/+o4eCDsSA+P/+o4eCDtiA+P/+o56BDt8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IO7ID4//6jh4IPAID4//6jh4IPFID4//6jh4IPKID4//6jh4IPPID4//6jnoEPQwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg9QgPj//qOHgg9kgPj//qOHgg94gPj//qOHgg+MgPj//qOHgg+ggPj//qOegQ+nANECAAUQEBRgAGFgv9AAIgAQzX61yT5xzAAAo4eCD7SA+P/+o4eCD8iA+P/+o4eCD9yA+P/+o4eCD/CA+P/+o4eCEASA+P/+o56BEAsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IQGID4//6jh4IQLID4//6jh4IQQID4//6jh4IQVID4//6jh4IQaID4//6jnoEQbwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghB8gPj//qOHghCQgPj//qOHghCkgPj//qOHghC4gPj//qOHghDMgPj//qOegRDTANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEOCA+P/+o4eCEPSA+P/+o4eCEQiA+P/+o56BETcA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IRQ4D4//6jh4IRV4D4//6jh4IRa4D4//6jh4IRf4D4//6jh4IRk4D4//6jnoERmwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghGngPj//qOHghG7gPj//qOHghHPgPj//qOHghHjgPj//qOHghH3gPj//qOegRH/ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEguA+P/+o4eCEh+A+P/+o4eCEjOA+P/+o4eCEkeA+P/+o4eCEluA+P/+o56BEmMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4ISb4D4//6jh4ISg4D4//6jh4ISl4D4//6jh4ISq4D4//6jh4ISv4D4//6jnoESxwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghLTgPj//qOHghLngPj//qOHghL7gPj//qOHghMPgPj//qOHghMjgPj//qOegRMrANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEzeA+P/+o4eCE0uA+P/+o4eCE1+A+P/+o4eCE3OA+P/+oAEAAAAAAAAPoYeCE4cA+P/+daKDB/KBHFO7a5G7j7OBB7eK94EB8YIDX/CBDA=="),this._addSourceToVideo(this.noSleepVideo,"mp4","data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACORtZGF03gIATGF2YzU4LjM1LjEwMAACMEAOAAACcQYF//9t3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2MSByMzAyNyA0MTIxMjc3IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTAgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTcgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0wIHdlaWdodHA9MCBrZXlpbnQ9MjUwIGtleWludF9taW49MTAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAADvZYiED/JigADD7JycnJycnJycnJycnJycnJycnJ11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111114BGCAHARggBwEYIAcBGCAHARggBwAAAAdBmjgf4BLYARggBwEYIAcBGCAHARggBwAAAAdBmlQH+AS2ARggBwEYIAcBGCAHARggBwAAAAdBmmA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZqAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZrAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0Ga4D/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbAD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbID/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBm0A/wCWwARggBwEYIAcBGCAHAAAAB0GbYD/AJbABGCAHARggBwEYIAcAAAAHQZuAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GboD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbwD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0Gb4D/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBmgA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmiA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmkA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZpgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqgP8AlsAEYIAcBGCAHARggBwAAAAdBmsA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmuA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmwA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZsgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtgP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GbgD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GboD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbwD/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdB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"),Object.assign(this.noSleepVideo.style,{position:"absolute",left:"-100%",top:"-100%"}),document.querySelector("body").append(this.noSleepVideo),this.handleNoSleepVideoTimeUpdate=()=>{this.noSleepVideo&&this.noSleepVideo.currentTime>4&&(this.noSleepVideo.currentTime=1)},this.noSleepVideo.addEventListener("timeupdate",this.handleNoSleepVideoTimeUpdate))}destroy(){if(this._wakeLock&&(this._wakeLock.release(),this._wakeLock=null),this.noSleepVideo){this.handleNoSleepVideoTimeUpdate&&this.noSleepVideo.removeEventListener("timeupdate",this.handleNoSleepVideoTimeUpdate);try{this.noSleepVideo.parentNode&&this.noSleepVideo.parentNode.removeChild(this.noSleepVideo)}catch(e){this.player.debugWarn("NoSleep","Failed to remove noSleepVideo element.")}this.noSleepVideo=null}this.handleVisibilityChange&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange))}_addSourceToVideo(e,t,i){var s=document.createElement("source");s.src=i,s.type=`video/${t}`,e.appendChild(s)}get isEnabled(){return this.enabled}enable(){if(At())return navigator.wakeLock.request("screen").then((e=>{this._wakeLock=e,this.enabled=!0,this.player.debugLog("wakeLock","Wake Lock active."),this._wakeLock.addEventListener("release",(()=>{this.player.debugLog("wakeLock","Wake Lock released.")}))})).catch((e=>{throw this.enabled=!1,this.player.debugWarn("wakeLock",`${e.name}, ${e.message}`),e}));return this.noSleepVideo.play().then((e=>(this.player.debugLog("wakeLock","noSleepVideo Wake Lock active."),this.enabled=!0,e))).catch((e=>{throw this.player.debugWarn("wakeLock",`noSleepVideo ${e.name}, ${e.message}`),this.enabled=!1,e}))}disable(){At()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):this.noSleepVideo&&this.noSleepVideo.pause(),this.enabled=!1,this.player.debugLog("wakeLock","Disabling wake lock.")}}class nt{constructor(e){this.player=e,this.TAG_NAME="decoderAudioWorker",this.destroyResolve=null,this.workerClearTimeout=null,this.workerUrl=null;let t=this.player._opt.decoder;if(this.decoderWorkerCloseTimeout=null,0===t.indexOf("http")&&this.player._opt.isDecoderUseCDN){const e=new Blob([`importScripts("${t}")`],{type:"application/javascript"});t=window.URL.createObjectURL(e),this.workerUrl=t,this.workerClearTimeout=setTimeout((()=>{window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null,this.workerClearTimeout=null}),B)}this.decoderWorker=new Worker(t),this._initDecoderWorker(),e.debugLog(this.TAG_NAME,`init and decoder url is ${t}`)}destroy(){return new Promise(((e,t)=>{this.player.loaded?(this.player.debugLog(this.TAG_NAME,"has loaded and post message to destroy"),this.decoderWorker?(this.decoderWorker.postMessage({cmd:N}),this.destroyResolve=e,this.decoderWorkerCloseTimeout=setTimeout((()=>{this.player.debugWarn(this.TAG_NAME,"send close but not response and destroy directly"),this._destroy(),setTimeout((()=>{e()}),0)}),2e3)):(this.player.debugWarn(this.TAG_NAME,"has loaded but decoderWorker is null and destroy directly"),this._destroy(),setTimeout((()=>{e()}),0))):(this.player.debugLog(this.TAG_NAME,"has not loaded and destroy directly"),this._destroy(),setTimeout((()=>{e()}),0))}))}_destroy(){this.decoderWorkerCloseTimeout&&(clearTimeout(this.decoderWorkerCloseTimeout),this.decoderWorkerCloseTimeout=null),this.workerUrl&&(window.URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.workerClearTimeout&&(clearTimeout(this.workerClearTimeout),this.workerClearTimeout=null),this.decoderWorker&&(this.decoderWorker.terminate(),this.decoderWorker.onerror=null,this.decoderWorker.onmessageerror=null,this.decoderWorker.onmessage=null,this.decoderWorker=null),this.player.debugLog(this.TAG_NAME,"destroy"),this.destroyResolve&&(this.destroyResolve(),this.destroyResolve=null)}_initDecoderWorker(){this.player,this.decoderWorker.onerror=e=>{const t=e.filename||"",i=e.message||"",s=t&&(-1!==t.indexOf(".wasm")||-1!==t.indexOf("wasm://"));s&&-1!==i.indexOf(ne)?this.player.debugLog("decoderWorker",`onerror and ignore filename: ${t},message: ${i}`,e):(this.player.debugError("decoderWorker",`onerror filename: ${t},message: ${i}`,e),s?this.player.emitError(z.decoderWorkerWasmError,`filename: ${t},message: ${i}`):this.player.emitError(z.decoderWorkerInitError,`filename: ${t},message: ${i}`))},this.decoderWorker.onmessageerror=e=>{this.player.debugError(this.TAG_NAME,"onmessageerror",e)},this.decoderWorker.onmessage=e=>{const t=e.data;switch(t.cmd){case S:this.player.debugLog(this.TAG_NAME,"onmessage:",S),this.decoderWorker&&this._initWork(),this.player.loaded||this.player.emit(Y.load),this.player.emit(Y.decoderWorkerInit);break;case T:this.player.debugLog(this.TAG_NAME,"onmessage:",T,t.code),this.player.audio&&this.player.audio.updateAudioInfo({encTypeCode:t.code});break;case v:if(this.player.debugLog(this.TAG_NAME,"onmessage:",v,`channels:${t.channels},sampleRate:${t.sampleRate}`),t.channels>2)return this.player.emit(Y.error,z.audioChannelError),void this.player.emit(z.audioChannelError,`audio channel is ${t.channels}, max is 2`);this.player.audio&&(this.player.audio.updateAudioInfo(t),this.player.audio.initScriptNode());break;case _:if(!this.player.audio)return void this.player.debugWarn(this.TAG_NAME,"onmessage playAudio but audio is null");this.player.handleRender(),this.player.updateStats({ts:t.ts,buf:t.delay}),this.player.audio.play(t.buffer,t.ts);break;case I:t.type===Y.streamSuccess?this.player.stream?this.player.stream.emit(Y.streamSuccess):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response stream success but stream is null"):t.type===Y.streamRate?this.player.emit(Y.kBps,(t.value/1024).toFixed(2)):t.type===Y.streamEnd?this.player?(t.value===u&&this.player.emit(Y.websocketClose,t.msg),this.player.stream?this.player.stream.emit(Y.streamEnd,t.msg):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response stream end but player.stream is null")):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response stream end but player is null"):t.type===z.websocketError?(this.player&&this.player.stream?this.player.stream.emit(z.websocketError,t.value):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response websocket error but stream is null"),this.player&&this.player.emit(Y.error,z.websocketError)):t.type===z.fetchError?(this.player&&this.player.stream?this.player.stream.emit(z.fetchError,t.value):this.player.debugWarn(this.TAG_NAME,"onmessage and workerFetch response fetch error but stream is null"),this.player&&this.player.emit(Y.error,z.fetchError)):t.type===Y.streamAbps&&this.player.updateStats({abps:t.value});break;case R:this.player.debugLog(this.TAG_NAME,"onmessage:",R),this.player.destroy(),console.error("Jb pro 体验结束,请刷新页面再次体验(wasm内部会暂停解码)，如需要购买商业授权，可以联系微信：bosswancheng"),alert("Jb pro 体验结束,请刷新页面再次体验，如需要购买商业授权，可以联系微信：bosswancheng"),window.location.reload();break;case P:this.player.debugLog(this.TAG_NAME,"onmessage:",P),this._destroy();break;default:this.player.debugWarn(this.TAG_NAME,"onmessage:",`unknown msg.cmd:${t.cmd}`)}}}_initWork(){const e={debug:this.player._opt.debug,debugLevel:this.player._opt.debugLevel,sampleRate:this.player.audio&&this.player.audio.audioContext&&this.player.audio.audioContext.sampleRate||0,audioBufferSize:this.player.audio&&this.player.audio.getAudioBufferSize()||1024,videoBuffer:this.player._opt.videoBuffer,isChrome:Ee()};this.decoderWorker.postMessage({cmd:L,opt:JSON.stringify(e)})}updateWorkConfig(e){this.decoderWorker&&this.decoderWorker.postMessage({cmd:W,key:e.key,value:e.value})}workerFetchStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{_opt:i}=this.player;let s=[];t.protocols&&(s=t.protocols,delete t.protocols);const r={protocol:i.protocol,isFlv:i.isFlv,isG711a:i.isG711a,isG711u:i.isG711u};this.decoderWorker.postMessage({cmd:D,url:e,protocols:s,opt:JSON.stringify(r)})}workerSendMessage(e){this.decoderWorker.postMessage({cmd:M,message:e})}}var ht,lt="application/json, text/javascript",ut="text/html",dt=/^(?:text|application)\/xml/i,ct=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,pt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,gt=/^\s*$/,mt={},yt={},ft="",bt={type:"GET",beforeSend:wt,success:wt,error:wt,complete:wt,context:null,xhr:function(){return new window.XMLHttpRequest},accepts:{json:lt,xml:"application/xml, text/xml",html:ut,text:"text/plain","*":"*/".concat("*")},crossDomain:!1,timeout:0,username:null,password:null,processData:!0,promise:wt,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};function wt(){}var Et=function(e,t){"object"==typeof e&&(t=e,e=void 0);var i=It({},t=t||{});for(var s in bt)void 0===i[s]&&(i[s]=bt[s]);try{var r={},o=new Promise((function(e,t){r.resolve=e,r.reject=t}));o.resolve=r.resolve,o.reject=r.reject,i.promise=o}catch(e){i.promise={resolve:wt,reject:wt}}var A=pt.exec(window.location.href.toLowerCase())||[];i.url=((e||i.url||window.location.href)+"").replace(/#.*$/,"").replace(/^\/\//,A[1]+"//");var a=i.url;i.crossDomain||(i.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(i.url)&&RegExp.$2!==window.location.href);var n=i.dataType;if("jsonp"===n){if(!/=\?/.test(i.url)){var h=(i.jsonp||"callback")+"=?";i.url=_t(i.url,h)}return function(e){var t,i=e.jsonpCallback||"jsonp"+Lt(),s=window.document.createElement("script"),r={abort:function(){i in window&&(window[i]=wt)}},o=window.document.getElementsByTagName("head")[0]||window.document.documentElement;function A(i){window.clearTimeout(t),r.abort(),Bt(i.type,r,i.type,e),a()}s.onerror=function(e){A(e)},window[i]=function(i){window.clearTimeout(t),Ct(i,r,e),a()},vt(e),s.src=e.url.replace(/=\?/,"="+i),s.src=_t(s.src,"_="+(new Date).getTime()),s.async=!0,e.scriptCharset&&(s.charset=e.scriptCharset);o.insertBefore(s,o.firstChild),e.timeout>0&&(t=window.setTimeout((function(){r.abort(),Bt("timeout",r,"timeout",e),a()}),e.timeout));function a(){s.clearAttributes?s.clearAttributes():s.onload=s.onreadystatechange=s.onerror=null,s.parentNode&&s.parentNode.removeChild(s),s=null,delete window[i]}return e.promise.abort=function(){r.abort()},e.promise.xhr=r,e.promise}(i)}vt(i);var l=i.accepts[n]||i.accepts["*"],u={};/^([\w-]+:)\/\//.test(i.url)?RegExp.$1:window.location.protocol;var d,c=bt.xhr();i.crossDomain||u["X-Requested-With"]||(u["X-Requested-With"]="XMLHttpRequest"),i.ifModified&&(mt[a]&&(u["If-Modified-Since"]=mt[a]),yt[a]&&(u["If-None-Match"]=yt[a])),l&&(u.Accept=l,l.indexOf(",")>-1&&(l=l.split(",",2)[0]),c.overrideMimeType&&c.overrideMimeType(l));var p=!/^(?:GET|HEAD)$/.test(i.type.toUpperCase());if((i.data&&p&&!1!==i.contentType||t.contentType)&&(u["Content-Type"]=i.contentType),!1===i.cache&&!p){var g=/([?&])_=[^&]*/;i.url=g.test(a)?a.replace(g,"$1_="+Lt()):a+(/\?/.test(a)?"&":"?")+"_="+Lt()}i.headers=It(u,i.headers||{}),c.onreadystatechange=function(){if(4===c.readyState){var e;clearTimeout(d);var t=!1;if(c.status>=200&&c.status<300||304===c.status){if(ft=c.getAllResponseHeaders(),i.ifModified){var s=St("Last-Modified");s&&(mt[a]=s),(s=St("etag"))&&(yt[a]=s)}n=n||function(e){return e&&(e===ut?"html":e===lt?"json":dt.test(e)&&"xml")||"text"}(c.getResponseHeader("content-type")),e=c.responseText;try{"xml"===n?e=c.responseXML:"json"===n&&(e=gt.test(e)?null:JSON.parse(e))}catch(e){t=e}t?Bt(t,"parseerror",c,i):Ct(e,c,i)}else Bt(null,"error",c,i)}};var m=!("async"in i)||i.async;if(c.open(i.type,i.url,m,i.username,i.password),i.xhrFields)for(var y in i.xhrFields)c[y]=i.xhrFields[y];for(var y in i.mimeType&&c.overrideMimeType&&c.overrideMimeType(i.mimeType),i.headers)void 0!==i.headers[y]&&c.setRequestHeader(y,i.headers[y]+"");return!1===function(e,t){var i=t.context;if(!1===t.beforeSend.call(i,e,t))return!1}(c,i)?(c.abort(),!1):(i.timeout>0&&(d=window.setTimeout((function(){c.onreadystatechange=wt,c.abort(),Bt(null,"timeout",c,i)}),i.timeout)),c.send(i.data?i.data:null),i.promise.abort=function(){c.abort()},i.promise)};function Ct(e,t,i){var s=i.context,r="success";i.success.call(s,e,r,t),i.promise.resolve(e,r,t),kt(r,t,i)}function kt(e,t,i){var s=i.context;i.complete.call(s,t,e)}function Bt(e,t,i,s){var r=s.context;s.error.call(r,i,t,e),s.promise.reject(i,t,e),kt(t,i,s)}function St(e){var t;if(!ht){for(ht={};t=ct.exec(ft);)ht[t[1].toLowerCase()]=t[2];t=ht[e.toLowerCase()]}return null===t?null:t}function _t(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function vt(e){!Rt(e)||e.data instanceof FormData||!e.processData||(e.data=function(e,t){var i=[];return i.add=function(e,t){this.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},Tt(i,e,t),i.join("&").replace("%20","+")}(e.data)),!e.data||e.type&&"GET"!==e.type.toUpperCase()||(e.url=_t(e.url,e.data))}function Tt(e,t,i,s){var r=function(e){return"[object Array]"===Object.prototype.toString.call(e)}(t);for(var o in t){var A=t[o];s&&(o=i?s:s+"["+(r?"":o)+"]"),!s&&r?e.add(A.name,A.value):(i?r(A):Rt(A))?Tt(e,A,i,o):e.add(o,A)}}function It(e){for(var t=Array.prototype.slice,i=t.call(arguments,1),s=0,r=i.length;s<r;s++){var o=i[s]||{};for(var A in o)o.hasOwnProperty(A)&&void 0!==o[A]&&(e[A]=o[A])}return e}function Rt(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function Pt(e){return"function"==typeof e}function Lt(){return(new Date).getTime()}Et.get=function(e,t,i,s){return Pt(t)&&(s=s||i,i=t,t=void 0),Et({url:e,data:t,success:i,dataType:s})},Et.post=function(e,t,i,s){return Pt(t)&&(s=s||i,i=t,t=void 0),Et({type:"POST",url:e,data:t,success:i,dataType:s})},Et.getJSON=function(e,t,i){return Pt(t)&&(i=t,t=void 0),Et({url:e,data:t,success:i,dataType:"json"})},Et.ajaxSetup=function(e,t){return t?It(It(e,bt),t):It(bt,e)};class Nt extends t{constructor(e){super(),this.player=e,this.TAG_NAME="CommonAudioWebrtc",this.rtcPeerConnection=null,this.rtcPeerConnectionDataChannel=null,this.videoStream=null,this.isDisconnected=!1,this.eventsDestroy=[],this.isInitInfo=!1,this.bandwidthEstimateInterval=null,this.rtcPeerTrackAudioReceiver=null,this.prevWebrtcAudioStats={},this.currentWebrtcStats={},this.isDestroyed=!1,this._initRtcPeerConnection()}destroy(){this.isDestroyed=!0,this.isDisconnected=!1,this.isInitInfo=!1,this.prevWebrtcVideoStats={},this.currentWebrtcStats={},this.rtcPeerTrackAudioReceiver=null,this._stopBandwidthEstimateInterval(),this.eventsDestroy.length&&(this.eventsDestroy.forEach((e=>e())),this.eventsDestroy=[]),this.videoStream&&(this.videoStream.getTracks().forEach((e=>{e.stop()})),this.videoStream=null),this.rtcPeerConnectionDataChannel&&(this.rtcPeerConnectionDataChannel.onopen=ue,this.rtcPeerConnectionDataChannel.onclose=ue,this.rtcPeerConnectionDataChannel.onmessage=ue,this.rtcPeerConnectionDataChannel.close(),this.rtcPeerConnectionDataChannel=null),this.rtcPeerConnection&&(this.rtcPeerConnection.onicecandidate=ue,this.rtcPeerConnection.ontrack=ue,this.rtcPeerConnection.onconnectionstatechange=ue,this.rtcPeerConnection.ondatachannel=ue,this.rtcPeerConnection.close(),this.rtcPeerConnection=null)}_initRtcPeerConnection(){const e=new RTCPeerConnection,t=this.player;e.addTransceiver("audio",{direction:"recvonly"}),e.onsignalingstatechange=e=>{this.player.debugLog(this.TAG_NAME,"onsignalingstatechange[本地端的信号状态]",e)},e.onicegatheringstatechange=t=>{this.player.debugLog(this.TAG_NAME,"onicegatheringstatechange[ICE收集状态]",t,e.iceGatheringState)},e.onnegotiationneeded=e=>{this.player.debugLog(this.TAG_NAME,"onnegotiationneeded[通信环境发生变化]",e)},e.oniceconnectionstatechange=i=>{this.player.debugLog(this.TAG_NAME,"oniceconnectionstatechange",e.iceConnectionState);const s=e.iceConnectionState;switch(this.player.emit(Y.webrtcOnIceConnectionStateChange,s),this.isDisconnected="disconnected"===s,e.iceConnectionState){case"new":break;case"checking":t.emit(Y.webrtcChecking);break;case"closed":case"closed":t.emit(Y.webrtcClosed);break;case"failed":t.emit(Y.webrtcFailed);break;case"disconnected":t.emit(Y.webrtcDisconnect);break;case"connected":t.emit(Y.webrtcConnected);break;case"completed":t.emit(Y.webrtcCompleted)}},e.onicecandidate=e=>{this.player.debugLog(this.TAG_NAME,"onicecandidate",e),e.candidate&&this.player.debugLog(this.TAG_NAME,"Remote ICE candidate: ",e.candidate.candidate)},e.ontrack=t=>{if(this.player.debugLog(this.TAG_NAME,"ontrack",t),"video"===t.track.kind);else if("audio"===t.track.kind){this.player.debugLog(this.TAG_NAME,"ontrack audio"),this.rtcPeerTrackAudioReceiver=e.getReceivers().find((function(e){return e.track===t.track})),this.rtcPeerTrackAudioReceiver&&this._startBandwidthEstimateInterval();let i=t.streams[0];this.videoStream=i,this.player.audio.bindStream(i)}},e.onicecandidateerror=e=>{this.player.debugLog(this.TAG_NAME,"onicecandidateerrorr[candidate错误]",e),this.player.emitError(z.webrtcIceCandidateError,e)},e.onconnectionstatechange=i=>{switch(this.player.debugLog(this.TAG_NAME,"onconnectionstatechange[所有ICE 状态总览]",i),this.player.emit(Y.webrtcOnConnectionStateChange,e.connectionState),e.connectionState){case"new":case"connecting":case"connected":case"disconnected":break;case"failed":this.isDisconnected&&t.emit(Y.webrtcFailed)}},this.rtcPeerConnection=e}_startBandwidthEstimateInterval(){this.player.debugLog(this.TAG_NAME,"_startBandwidthEstimateInterval"),this._stopBandwidthEstimateInterval(),this.bandwidthEstimateInterval=setInterval((()=>{this.rtcPeerTrackAudioReceiver&&this.rtcPeerTrackAudioReceiver.getStats().then((e=>{let t=0;const i={};e.forEach((e=>{if(e&&e.type===he){this.currentWebrtcStats.lastTimeStamp=e.timestamp;const s=((e.timestamp||0)-(this.prevWebrtcAudioStats.timestamp||0))/1e3,r=Number(e.bytesReceived||0)-Number(this.prevWebrtcAudioStats.bytesReceived||0),o=Math.floor(r/s);t+=o,i.abps=o,this.prevWebrtcAudioStats=e}})),this.player.updateStats(i),this.player.emit(Y.kBps,(t/1024).toFixed(2))}))}),1e3)}_stopBandwidthEstimateInterval(){this.player.debugLog(this.TAG_NAME,"_stopBandwidthEstimateInterval"),this.bandwidthEstimateInterval&&(clearInterval(this.bandwidthEstimateInterval),this.bandwidthEstimateInterval=null)}async loadSource(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this.rtcPeerConnection;try{const s=await i.createOffer();await i.setLocalDescription(s);const r=await this.getWebRtcRemoteSdpByPost(e,s.sdp,t);await i.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:r}))}catch(e){return this.player.debugError(this.TAG_NAME,`loadSource error ${e.toString()}`,e),{code:400,message:"getWebRtcRemoteSdp response error:"+e.toString()}}return!0}async getWebRtcRemoteSdpByPost(e,t,i){return!0}}class Wt extends Nt{constructor(e){super(e),this.TAG_NAME="WebRTCForZlmAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,i){const s=await function(e,t){return Et({url:e,type:"POST",data:t,contentType:"text/plain;charset=utf-8",processData:!1,dataType:"json"})}(e,t);if(0!==s.code)throw new Error(s.msg);if(s.sdp)return s.sdp;throw new Error("sdp is null")}}class Dt extends Nt{constructor(e){super(e),this.TAG_NAME="WebRTCForOtherAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,i){const s=await function(e,t){return fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/sdp"},body:t})}(e,t),r=await s.text();try{let e=JSON.parse(r);if(this.player.debugLog(this.TAG_NAME,"this is json sdp response"),0!=e.code)throw this.player.debugError(this.TAG_NAME,`response json code ${e.code}`),new Error(`response sdp json code: ${e.code}`);return e.sdp}catch(e){this.player.debugLog(this.TAG_NAME,"this is raw sdp response")}return r}}class Mt extends Nt{constructor(e){super(e),this.TAG_NAME="WebRTCForM7sAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,i){const s=await function(e,t,i){let s={"Content-Type":"application/sdp"};return i.username&&i.password&&(s.Authorization="Basic "+btoa(i.username+":"+i.password)),fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:s,body:t})}(e,t,i);return await s.text()}}class Gt extends Nt{constructor(e){super(e),this.TAG_NAME="WebRTCForSRSAudio",this.player.debugLog(this.TAG_NAME,"init")}async destroy(){return super.destroy(),this.player.debugLog(this.TAG_NAME,"destroy"),!0}async getWebRtcRemoteSdpByPost(e,t,i){const s=await function(e,t){return fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/sdp"},body:t})}(e,t);if(0!==s.code)throw new Error(s.msg);if(s)return s;throw new Error("sdp is null")}}class Ot extends t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._opt={},this.TAG_NAME="AudioPlayer";const t=ve();this._opt=Object.assign({},t,e),this.debug=new le(this),this.debugLog(this.TAG_NAME,"init and version is",me),this._loading=!1,this._playing=!1,this._hasLoaded=!1,this._destroyed=!1,this._closed=!1,this._checkHeartTimeout=null,this._checkLoadingTimeout=null,this._checkStatsInterval=null,this._startBpsTime=null,this._stats={abps:0,ts:0,buf:0,audioBufferTs:0},this._audioTimestamp=0,this.stream=null,this._lastVolume=null,this._historyAbpsList=[],this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},this._tempWorkerStats=null,/(iphone|ipad|ipod|ios|android)/i.test(window.navigator.userAgent.toLowerCase())&&Ie(this._opt.supportLockScreenPlayAudio&&ye())&&(this.keepScreenOn=new at(this)),Pe(this),this.stream=null,this.webrtc=null,this.events=new Re(this),this.decoderWorker=null,this.audio=null;try{this.debugLog(this.TAG_NAME,"_opt",JSON.stringify(this._opt))}catch(e){this.debugLog(this.TAG_NAME,"_opt",this._opt)}}async destroy(){this._destroyed=!0,this.emit("destroy"),this.off(),this.events&&(this.events.destroy(),this.events=null),this.clearCheckHeartTimeout(),this.clearCheckLoadingTimeout(),this.clearStatsInterval(),this.decoderWorker&&(await this.decoderWorker.destroy(),this.decoderWorker=null),await this._destroy()}async _destroy(){this._loading=!1,this._playing=!1,this._hasLoaded=!1,this._destroyed=!1,this._checkHeartTimeout=null,this._checkLoadingTimeout=null,this._checkStatsInterval=null,this._resetStats(),this._audioTimestamp=0,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},this._tempWorkerStats=null,this.audio&&(await this.audio.destroy(),this.audio=null),this.webrtc&&(await this.webrtc.destroy(),this.webrtc=null),this.stream&&(await this.stream.destroy(),this.stream=null),this.debugLog(this.TAG_NAME,"destroy end"),this._opt=ve()}_resetStats(){this._startBpsTime=null,this._playingStartTimestamp=null,this._historyAbpsList=[],this._stats={abps:0,ts:0,buf:0,audioBufferTs:0}}set loaded(e){this._hasLoaded=e}get loaded(){return this._hasLoaded}set playing(e){e&&(this.loading=!1),this.playing!==e&&(this._playing=e,this.emit(Y.playing,e),this.emit(Y.volumechange,this.volume),e?this.emit(Y.play):this.emit(Y.pause))}get playing(){return this._playing}get volume(){return this.audio&&this.audio.volume||0}set volume(e){e!==this.volume&&(this.audio?(this.audio.setVolume(e),this._lastVolume=this.volume):this.debugWarn(this.TAG_NAME,"set volume error, audio is null"))}get lastVolume(){return this._lastVolume}set loading(e){this.loading!==e&&(this._loading=e,this.emit(Y.loading,this._loading))}get loading(){return this._loading}set audioTimestamp(e){null!==e&&(this._audioTimestamp=e)}get audioTimestamp(){return this._audioTimestamp}get isDebug(){return Te(this._opt.debug)}isDestroyed(){return this._destroyed}updateOption(e){this._opt=Object.assign({},this._opt,e)}init(){return new Promise(((e,t)=>{this.audio||(this.audio=new ot(this)),this.stream||(this.stream=new Qe(this)),this.isWebrtc()?(this.webrtc||(this._opt.isWebrtcForZLM?this.webrtc=new Wt(this):this._opt.isWebrtcForSRS?this.webrtc=new Gt(this):this._opt.isWebrtcForOthers?this.webrtc=new Dt(this):this.webrtc=new Mt(this),this.loaded=!0),e()):this.decoderWorker?this.loaded?e():this.once(Y.decoderWorkerInit,(()=>{this.loaded=!0,e()})):(this.decoderWorker=new nt(this),this.once(Y.decoderWorkerInit,(()=>{this.loaded=!0,e()})))}))}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,s)=>{if(!e&&!this._opt.url)return s("url is empty");this.loading=!0,this.playing=!1,this._closed=!1,this._times.playInitStart=de(),e||(e=this._opt.url),this._opt.url=e,this.clearCheckHeartTimeout(),this.init().then((()=>{this._times.playStart=de(),this._opt.isNotMute&&this.mute(!1),this.checkLoadingTimeout(),this.stream&&(this.stream.once(z.fetchError,(e=>{this.emitError(z.fetchError,e)})),this.stream.once(z.websocketError,(e=>{this.emitError(z.websocketError,e)})),this.stream.once(Y.streamEnd,(e=>{this.emit(Y.streamEnd,e)})),this.stream.once(Y.streamSuccess,(()=>{i(),this._times.streamResponse=de(),this.checkStatsInterval(),this.debugLog(this.TAG_NAME,"stream success and start play")})),this.stream.fetchStream(e,t))})).catch((()=>{s()}))}))}checkLoadingTimeout(){this._checkLoadingTimeout=setTimeout((()=>{this.playing?this.debugWarn(this.TAG_NAME,`checkLoadingTimeout but loading is ${this.loading} and playing is ${this.playing}`):this.isDestroyed()?this.debug&&this.debugWarn(this.TAG_NAME,"checkLoadingTimeout but player is destroyed"):(this.debugWarn(this.TAG_NAME,"checkLoadingTimeout and pause and emit loadingTimeout event"),this.emit(Y.timeout,Y.loadingTimeout),this.emit(Y.loadingTimeout))}),1e3*this._opt.loadingTimeout)}clearCheckLoadingTimeout(){this._checkLoadingTimeout&&(this.debugLog(this.TAG_NAME,"clearCheckLoadingTimeout"),clearTimeout(this._checkLoadingTimeout),this._checkLoadingTimeout=null)}checkStatsInterval(){this.debugLog(this.TAG_NAME,"checkStatsInterval"),this._checkStatsInterval=setInterval((()=>{this.updateStats()}),1e3)}clearCheckHeartTimeout(){this.debugLog(this.TAG_NAME,"clearCheckHeartTimeout"),this._checkHeartTimeout&&(clearTimeout(this._checkHeartTimeout),this._checkHeartTimeout=null)}clearStatsInterval(){this.debugLog(this.TAG_NAME,"clearStatsInterval"),this._checkStatsInterval&&(clearInterval(this._checkStatsInterval),this._checkStatsInterval=null)}updateStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._startBpsTime||(this._startBpsTime=de()),be(e.ts)&&(this._stats.ts=e.ts,null===this._playingStartTimestamp&&e.ts>0&&(this._playingStartTimestamp=e.ts)),be(e.buf)&&(this._stats.buf=e.buf);const t=de(),i=t-this._startBpsTime;if(e.abps&&(this._stats.abps+=e.abps),i<1e3)return;let s=0,r=0;this.audio&&this.audio.bufferList&&(s=this.audio.bufferList.length,r=s*this.audio.oneBufferDuration),this._stats.audioBufferTs=parseInt(r,10),this.emit(Y.stats,this._stats),this.emit(Y.timeUpdate,this._stats.ts),this.updateHistoryAbpsList(this._stats.abps),this._stats.abps=0,this._startBpsTime=t}enableWakeLock(){this._opt.keepScreenOn&&this.keepScreenOn&&this.keepScreenOn.enable()}releaseWakeLock(){this._opt.keepScreenOn&&this.keepScreenOn&&this.keepScreenOn.disable()}pause(){return new Promise(((e,t)=>{this._closed=!0;const i=()=>{this.stream&&(this.stream.destroy(),this.stream=null),this.off(),this.clearCheckHeartTimeout(),this.clearCheckLoadingTimeout(),this.clearStatsInterval(),this.releaseWakeLock(),this._resetStats(),this.loading=!1,this.playing=!1,this.audio&&this.audio.pause(),this._audioTimestamp=0,this._hasLoaded=!1,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},Pe(this)};this.decoderWorker?this.decoderWorker.destroy().then((()=>{this.decoderWorker=null,i(),e()})).catch((e=>{this.debugError(this.TAG_NAME,"pause() decoderWorker destroy error",e),t(e)})):(i(),setTimeout((()=>{e()}),0))}))}handleRender(){this.isDestroyed()?this.debug&&this.debugWarn("player","handleRender but player is destroyed"):(this.loading&&(this.clearCheckLoadingTimeout(),this.emit(Y.start),this.loading=!1),this.playing||(this.playing=!0))}updateHistoryAbpsList(e){this._historyAbpsList.length>this._opt.heartTimeout&&this._historyAbpsList.shift(),this._historyAbpsList.push(e),this.isHistoryAbpsListAllZero()&&this.checkHeartTimeout$2()}isHistoryAbpsListAllZero(){let e=!0;if(this._historyAbpsList.length<this._opt.heartTimeout&&(e=!1),e)for(let t=0;t<this._historyAbpsList.length;t++)if(this._historyAbpsList[t]>0){e=!1;break}return e}checkHeartTimeout$2(){if(this.playing){if(this.isDestroyed())return void(this.debug&&this.debugWarn("player","checkHeartTimeout$2 but player is destroyed"));if(Ie(this.isHistoryAbpsListAllZero()))return void(this.debug&&this.debugWarn("player","checkHeartTimeout$2 but fps is not all zero"));if(Ie(this.visibility)&&0!==this._stats.abps)return void(this.debug&&this.debugWarn("player",`checkHeartTimeout$2 but page is not visibility and vbps is ${this._stats.vbps}`));const e=this._historyAbpsList.join(",");this.debugWarn("player",`checkHeartTimeout$2 and\n                pause and emit delayTimeout event and\n                current abps is ${this._stats.abps} and\n                history abpsList is ${e} and\n                current visibility is ${this.visibility} and`),this.emit(Y.timeout,Y.delayTimeout),this.emit(Y.delayTimeout)}else this.debugLog("player",`checkHeartTimeout$2()  playing is ${this.playing}`)}getOption(){return this._opt}getDemuxType(){let e="";return e=this.getOption().demuxType,e}getAudioEngineType(){let e="";return this.audio&&(e=this.audio.getEngineType()),e}mute(e){this.audio&&this.audio.mute(e)}isAudioMute(){let e=!0;return this.audio&&(e=this.audio.isMute),e}isAudioNotMute(){return!this.isAudioMute()}getPlayType(){return this._opt.playType}emitError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.emit(e,t),this.emit(Y.error,e,t)}openSyncAudioAndVideo(){return!1}isDestroyedOrClosed(){return this.isDestroyed()||this.isClosed()}isClosed(){return this._closed}isWebrtc(){return Te(this._opt.isWebrtc)}isWebrtcForM7S(){return Ie(this._opt.isWebrtcForZLM)&&Ie(this._opt.isWebrtcForSRS)&&Ie(this._opt.isWebrtcForOthers)}debugLog(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.debug.log(e,...i)}}debugWarn(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.debug.warn(e,...i)}}debugError(e){if(this.debug){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.debug.error(e,...i)}}}class xt extends t{constructor(e){super(),this.player=e,this.TAG_NAME="Network",this.online=this.isOnline(),this.prevOnline=this.online,this.interval=null,this._initListener(),this.player.debugLog(this.TAG_NAME,"init")}destroy(){this.off(),this._stopCheck(),window.removeEventListener("online",this._updateOnlineStatus),window.removeEventListener("offline",this._updateOfflineStatus),this.player.debugLog(this.TAG_NAME,"destroy")}_initListener(){window.addEventListener("online",this._updateOnlineStatus.bind(this)),window.addEventListener("offline",this._updateOfflineStatus.bind(this))}_stopCheck(){this.interval&&(clearInterval(this.interval),this.interval=null)}_startCheck(){this.interval=setInterval((()=>{this.isOnline()!==this.prevOnline&&(this.isOnline()?this._updateOnlineStatus():this._updateOfflineStatus())}),1e3)}_updateOnlineStatus(){this.prevOnline=this.online,this.online=!0,this.logStatus(),this.emit("online")}_updateOfflineStatus(){this.prevOnline=this.online,this.online=!1,this.logStatus(),this.emit("offline")}logStatus(){const e=this.prevOnline?"online":"offline",t=this.online?"online":"offline";this.player.debugLog(this.TAG_NAME,`prevOnline: ${this.prevOnline}, online: ${this.online}, status: ${e} -> ${t}`)}isOnline(){return void 0===navigator.onLine||navigator.onLine}isOffline(){return!this.isOnline()}}class Qt extends t{constructor(e){super(),this._opt={},this.TAG_NAME="JbProAudio",Object.keys(e).forEach((t=>{if(void 0===e[t])throw new Error(`JbPro option "${t}" can not be undefined`)}));const t=ve();let i=Object.assign({},t,e);be(i.videoBuffer)&&(i.videoBuffer=1e3*Number(i.videoBuffer)),be(i.videoBufferDelay)&&(i.videoBufferDelay=1e3*Number(i.videoBufferDelay)),be(i.videoBufferMax)&&(i.videoBufferMax=1e3*Number(i.videoBufferMax)),be(i.timeout)&&(fe(i.loadingTimeout)&&(i.loadingTimeout=i.timeout),fe(i.heartTimeout)&&(i.heartTimeout=i.timeout)),this._opt=i,this._destroyed=!1,this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0,this._isNetworkOfflinePaused=!1,this._isNetworkOfflinePausedAndNextPlayConfig={},this._streamErrorReplayTimes=0,this.debug=new le(this),this.events=new Re(this),this.network=new xt(this),this._initAudioPlayer(),this._initNetwork(),this.debugLog(this.TAG_NAME,'init success and version is "7-29-2024"'),console.log('JbProAudio version is "7-29-2024"')}destroy(){return new Promise(((e,t)=>{this.debugLog(this.TAG_NAME,"destroy()"),this._destroyed=!0,this.off(),this.player?this.player.destroy().then((()=>{this.player=null,this._destroy(),e()})).catch((()=>{t()})):(this._destroy(),e())}))}_destroy(){this.events&&(this.events.destroy(),this.events=null),this.debugLog("JbPro","destroy end"),this._resetOpt(),this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0,this._isNetworkOfflinePaused=!1,this._isNetworkOfflinePausedAndNextPlayConfig={},this._streamErrorReplayTimes=0}_initAudioPlayer(){this.player=new Ot(this._opt),this.debugLog(this.TAG_NAME,"_initPlayer",this.player.getOption()),this._bindEvents()}_initNetwork(){this.network.on(Y.online,(()=>{if(this.emit(Y.networkState,Y.online),this.isDestroyed())this.debugLog(this.TAG_NAME,"network online but player is destroyed");else if(this._isNetworkOfflinePaused&&this._isNetworkOfflinePausedAndNextPlayConfig&&this._isNetworkOfflinePausedAndNextPlayConfig.url){const e=this._isNetworkOfflinePausedAndNextPlayConfig.url;this._streamErrorReplayTimes++;const t=this._isNetworkOfflinePausedAndNextPlayConfig.type||"unknown";this._isNetworkOfflinePaused=!1,this._isNetworkOfflinePausedAndNextPlayConfig={},this.debugLog(this.TAG_NAME,`${t} and network online and _streamErrorReplayTimes is ${this._streamErrorReplayTimes} and reset player and play`),this.play(e).then((()=>{this.debugLog(this.TAG_NAME,`${t} and network online and play success`)})).catch((e=>{this.emit(Y.playFailedAndPaused,z.fetchError,{},e),this.debugError(this.TAG_NAME,`${t} and network online and play error`,e.toString(),e)}))}})),this.network.on(Y.offline,(()=>{this.emit(Y.networkState,Y.offline)}))}_resetOpt(){this._opt=ve()}_bindEvents(){Object.keys($).forEach((e=>{this.player.on($[e],(t=>{this.emit(e,t)}))}))}_play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return new Promise(((r,A)=>{const a=e.split("?")[0],h=a.startsWith("http://")||a.startsWith("https://"),l=a.startsWith("ws://")||a.startsWith("wss://"),u=a.startsWith("webrtc://"),d=h||l,c=-1!==e.indexOf(".flv"),p=d&&(a.endsWith(".g711a")||a.endsWith(".g711u")),g=p&&a.endsWith(".g711a"),m=p&&a.endsWith(".g711u");let y=this._opt.isWebrtcForZLM||!1,f=this._opt.isWebrtcForSRS||!1,C=this._opt.isWebrtcForOthers||!1;u&&(-1!==e.indexOf("/index/api/webrtc")?(y=!0,f=!1,C=!1):-1!==e.indexOf("/rtc/v1/play/")&&(f=!0,y=!1,C=!1));let k=null,B=null;if(h?k=s:u?k=o:l&&(k=i),c&&!this._opt.isFlv?this._opt.isFlv=!0:!p||this._opt.isG711a||this._opt.isG711u||(this._opt.isG711a=g,this._opt.isG711u=m),this._opt.isFlv?B=b:u?B=E:l&&(B=w),!k||!B)return A(`play protocol is ${k}, demuxType is ${B}`);this.debugLog(this.TAG_NAME,`play protocol is ${n[k]}, demuxType is ${B}`);const S=()=>{this.player.once(z.fetchError,this._handleFetchError.bind(this)),this.player.once(Y.streamEnd,this._handleStreamEnd.bind(this)),this.player.once(z.websocketError,this._handleWebsocketError.bind(this)),this.player.once(z.decoderWorkerInitError,this._handleDecoderWorkerInitError.bind(this)),this.player.once(z.decoderWorkerWasmError,this._handleDecoderWorkerWasmError.bind(this)),this.player.on(Y.delayTimeout,this._handleDelayTimeout.bind(this)),this.player.on(Y.loadingTimeout,this._handleLoadingTimeout.bind(this)),this.player.play(e,t).then((()=>{r()})).catch((e=>{this.debugError(this.TAG_NAME,"hasLoaded and play error",e),this.emit(Y.crashLog,this._getCrashLog("hasLoaded and play error",e)),this.player.pause().then((()=>{A(e)})).catch((e=>{this.debugError(this.TAG_NAME,"hasLoaded and play error and next pause error",e)}))}))};u&&Ie(this._opt.isWebrtcH265)?this._resetPlayer({protocol:k,demuxType:B,isWebrtc:u,isWebrtcForZLM:y,isWebrtcForSRS:f,isWebrtcForOthers:C}).then((()=>{S()})).catch((e=>{A("reset player error",e)})):(this.player.updateOption({protocol:k,demuxType:B,isFlv:this._opt.isFlv,isWebrtc:u}),S())}))}isDestroyed(){return this._destroyed}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,s)=>{if(this.isDestroyed())return s("JbPro is destroyed");if(!this.player)return s("player is null");try{this.debugLog(this.TAG_NAME,`play() ${e}`,JSON.stringify(t))}catch(i){this.debugLog(this.TAG_NAME,`play() ${e}`,t)}if(!e&&!this._opt.url)return this.emit(Y.error,z.playError),void s("url is null and this._opt.url is null");if(e){if(e=(""+e).trim(),-1===e.indexOf("http:")&&-1===e.indexOf("https:")&&-1===e.indexOf("webrtc:")&&-1===e.indexOf("ws:")&&-1===e.indexOf("wss:"))return s(`url ${e} must be "http:" or "https:" or "webrtc:" or "ws:" or "wss：" protocol`);this._opt.url=e}this.player.playing||this.player.loading?(this.debugWarn(this.TAG_NAME,`play() and player is playing ${this.player.playing} or loading ${this.player.loading} and pause to play`),this.player.pause().then((()=>{this._play(this._opt.url).then((()=>{i()})).catch((e=>{s(e)}))}))):this._play(this._opt.url,t).then((()=>{i()})).catch((e=>{s(e)}))}))}mute(){this.debugLog(this.TAG_NAME,"mute()"),this.player&&this.player.mute(!0)}cancelMute(){this.debugLog(this.TAG_NAME,"cancelMute()"),this.player&&this.player.mute(!1)}pause(){return new Promise(((e,t)=>{this.debugLog(this.TAG_NAME,"pause()"),this.player?this.player.pause().then((t=>{this._bindEvents(),e(t)})).catch((e=>{t(e)})):t("player is null")}))}setVolume(e){this.debugLog(this.TAG_NAME,`setVolume() ${e}`),this.player&&(this.player.volume=e)}getVolume(){let e=null;return this.player&&(e=this.player.volume,e=parseFloat(e).toFixed(2)),e}setTimeout(e){this.debugLog(this.TAG_NAME,`setTimeout() ${e}`),e=Number(e),this.player&&this.player.updateOption({timeout:e,loadingTimeout:e,heartTimeout:e})}audioResume(){this.debugLog(this.TAG_NAME,"audioResume()"),this.player&&this.player.audio?this.player.audio.audioEnabled(!0):this.debugWarn(this.TAG_NAME,"audioResume() player is not init")}setDebug(e){this.debugLog(this.TAG_NAME,`setDebug() ${e}`),this.player?this.player.updateOption({debug:!!e}):this.debugWarn(this.TAG_NAME,"setDebug() player is not init")}_getCrashLog(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.player)return;const i=this.player;let s={url:this._opt.url,playType:y,demuxType:i.getDemuxType(),audioInfo:{encType:"",sampleRate:"",channels:""},audioEngine:i.getAudioEngineType(),timestamp:de(),type:e,error:_e(t)||e};if(i.audio){const e=i.audio.audioInfo||{};s.audioInfo={encType:e.encType||"",sampleRate:e.sampleRate||"",channels:e.channels||""}}return s}_isNeedNetworkDisconnectReplay(){return this._opt.networkDisconnectReplay&&this.network.isOffline()}_handleFetchError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleFetchError but player is destroyed"):(this.emit(Y.crashLog,this._getCrashLog(z.fetchError,e)),this.debugLog(this.TAG_NAME,"fetch error and reset player"),this.pause().then((()=>{if(this._isNeedNetworkDisconnectReplay())return this.debugLog(this.TAG_NAME,"fetch error and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:_url,type:z.fetchError});this.emit(Y.playFailedAndPaused,z.fetchError)})).catch((e=>{this.debugError(this.TAG_NAME,"fetch error and pause",e)})))}_handleStreamEnd(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleStreamEnd but player is destroyed"):(this.emit(Y.crashLog,this._getCrashLog(Y.streamEnd,e)),this.debugLog(this.TAG_NAME,"streamEnd and reset player"),this.pause().then((()=>{if(this._isNeedNetworkDisconnectReplay())return this.debugLog(this.TAG_NAME,"stream End and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:_url,type:Y.streamEnd});this.emit(Y.playFailedAndPaused,Y.streamEnd)})).catch((e=>{this.emit(Y.playFailedAndPaused,z.streamEnd),this.debugError(this.TAG_NAME,"streamEnd and pause",e)})))}_handleWebsocketError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleWebsocketError but player is destroyed"):(this.emit(Y.crashLog,this._getCrashLog(z.websocketError,e)),this.debugLog(this.TAG_NAME,"websocketError and reset player"),this.pause().then((()=>{if(this._isNeedNetworkDisconnectReplay())return this.debugLog(this.TAG_NAME,"websocket Error and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:_url,type:z.websocketError});this.emit(Y.playFailedAndPaused,z.websocketError)})).catch((e=>{this.emit(Y.playFailedAndPaused,z.websocketError),this.debugError(this.TAG_NAME,"websocketError and pause",e)})))}_handleDecoderWorkerInitError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleDecoderWorkerInitError but player is destroyed"):(this.emit(Y.crashLog,this.getCrashLog(z.decoderWorkerInitError,e)),this.debugLog(this.TAG_NAME,"decoderWorkerInitError and pause player"),this._pause().then((()=>{this.emit(Y.playFailedAndPaused,z.decoderWorkerInitError)})).catch((e=>{this.emit(Y.playFailedAndPaused,z.decoderWorkerInitError),this.debugError(this.TAG_NAME,"decoderWorkerInitError and pause",e)})))}_handleDecoderWorkerWasmError(e){this.isDestroyed()?this.debugLog(this.TAG_NAME,"_handleDecoderWorkerWasmError but player is destroyed"):(this.emit(Y.crashLog,this.getCrashLog(z.decoderWorkerWasmError,e)),this.debugLog(this.TAG_NAME,"decoderWorkerWasmError and pause player"),this._pause().then((()=>{this.emit(Y.playFailedAndPaused,z.decoderWorkerWasmError)})).catch((e=>{this.emit(Y.playFailedAndPaused,z.decoderWorkerWasmError),this.debugError(this.TAG_NAME,"decoderWorkerWasmError and pause",e)})))}_handleDelayTimeout(e){this.emit(Y.crashLog,this._getCrashLog(Y.delayTimeout,e)),this.isDestroyed()?this.debugLog(this.TAG_NAME,"delay timeout but player is destroyed"):this.pause().then((()=>{if(this.player&&this.player._opt.heartTimeoutReplay&&(this._heartTimeoutReplayTimes<this.player._opt.heartTimeoutReplayTimes||-1===this.player._opt.heartTimeoutReplayTimes)){if(this.debugLog(this.TAG_NAME,`delay timeout and\n                        replay time is ${this._heartTimeoutReplayTimes} and\n                        heartTimeoutReplayTimes is ${this.player._opt.heartTimeoutReplayTimes}`),this.isDestroyed())return void this.debugWarn(this.TAG_NAME,"delay timeout replay but player is destroyed");this._heartTimeoutReplayTimes+=1;const e=this._opt.url;if(this._isNeedNetworkDisconnectReplay())return this.debugLog("JbPro","delayTimeout and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:e,type:Y.delayTimeout});this.play(e).then((()=>{})).catch((e=>{this.debugError(this.TAG_NAME,"delay timeout replay error",e)}))}else this.emit(Y.playFailedAndPaused,Y.delayTimeout),this.emit(Y.delayTimeoutRetryEnd),this.debugWarn(this.TAG_NAME,`delayTimeoutRetryEnd and\n                            opt.heartTimeout is ${this.player&&this.player._opt.heartTimeout} and\n                            opt.heartTimeoutReplay is ${this.player&&this.player._opt.heartTimeoutReplay} and\n                            opt.heartTimeoutReplayTimes is ${this.player&&this.player._opt.heartTimeoutReplayTimes},and\n                            local._heartTimeoutReplayTimes is ${this._heartTimeoutReplayTimes}`)})).catch((e=>{this.emit(Y.playFailedAndPaused,Y.delayTimeout),this.debugError(this.TAG_NAME,"delay timeout and pause error",e)}))}_handleLoadingTimeout(t){this.emit(Y.crashLog,this._getCrashLog(Y.loadingTimeout,t)),this.isDestroyed()?this.debugLog(this.TAG_NAME,"loading timeout but player is destroyed"):this.pause().then((()=>{if(this.player&&this.player._opt.loadingTimeoutReplay&&(this._loadingTimeoutReplayTimes<this.player._opt.loadingTimeoutReplayTimes||-1===this.player._opt.loadingTimeoutReplayTimes)){if(this.debugLog(this.TAG_NAME,`loading timeout and\n                             replay time is ${this._loadingTimeoutReplayTimes} and\n                             loadingTimeoutReplayTimes is ${this.player._opt.loadingTimeoutReplayTimes}`),this.isDestroyed())return void this.debugWarn(this.TAG_NAME,"loading timeout replay but player is destroyed");this._loadingTimeoutReplayTimes+=1;const t=this._opt.url;if(this._isNeedNetworkDisconnectReplay())return this.debugLog("JbPro","loadingTimeout and network is offline and wait network online to play , so return"),this._isNetworkOfflinePaused=!0,void(this._isNetworkOfflinePausedAndNextPlayConfig={url:t,type:Y.loadingTimeout});this.play(t).then((()=>{})).catch((()=>{this.debugError(this.TAG_NAME,"loading timeout replay error",e)}))}else this.emit(Y.loadingTimeoutRetryEnd),this.emit(Y.playFailedAndPaused,Y.loadingTimeoutRetryEnd)})).catch((e=>{this.emit(Y.playFailedAndPaused,Y.loadingTimeoutRetryEnd),this.debugError(this.TAG_NAME,"loading timeout and pause error",e)}))}debugLog(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.debug.log(e,...i)}}debugWarn(e){if(this._opt.debug&&this.debug){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.debug.warn(e,...i)}}debugError(e){if(this.debug){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.debug.error(e,...i)}}}return window.JessibucaProAudio=Qt,window.JbProAudio=Qt,window.WebPlayerProAudio=Qt,Qt}));
